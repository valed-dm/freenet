function mdTablesInit(e,t){$().mdTables&&(t.mdTables(),e.$on("$destroy",function(){t.data("mdTables")&&t.data("mdTables").destroy()}))}var app=angular.module("app-services",[]);app.factory("AuthInterceptor",["$injector","$log",function(e,t){var n={request:function(n){var a=angular.isDefined(n.flush)?n.flush!==!1:!0,r=e.get("AuthService2");return"GET"!==n.method&&a&&(t.debug("AuthInterceptor flushing"),r.flushContractDetails()),n}};return n}]),app.factory("nboInterceptor",["$injector","$log",function(e,t){var n={request:function(n){var a=angular.isDefined(n.flush)?n.flush!==!1:!0,r=e.get("AuthService2"),i=r.getUser();return"GET"!==n.method&&i.nboId&&a&&(t.debug("nboInterceptor sending special header"),angular.isDefined(n.headers)?n.headers["X-NBO-ID"]=i.nboId:n.headers={"X-NBO-ID":i.nboId},delete i.nboId),n}};return n}]);var app=angular.module("md",["ngRoute","mgo-angular-wizard","app-services","angularModalService","angularFileUpload","ngIdle","chw-uberfilter","oc.lazyLoad","rzModule","ngBrowserUpdate"]);app.value("ENVIRONMENT",{oidcUrl:"https://identity.freenet-mobilfunk.de/v2/oidc/",auth0Url:"https://id.freenet-mobilfunk.de/",oidcRedirectUrl:"/online-service/preload/",oidcIframeRedirectUrl:"/online-service/login/",Auth0RedirectUrl:"/online-service/#/preload",Auth0RedirectUrlDashboard:"https://www.freenet-mobilfunk.de/onlineservice/dashboard",Auth0IframeRedirectUrl:"/online-service/login",apiUrl:"https://api.md.de",xApiKeyOidc:"8b121bbc-6f75-4f38-a2ac-2dcb64a25a30",xApiKeyAuth0:"cKNNz7OwQ9WGfWUV7j2YhIxZDwCk7OVQ",mlpOidc:"https://identity.freenet-mobilfunk.de/login",mlpAuth0:"https://id.freenet-mobilfunk.de/login",auth0Logout:"https://www.freenet-mobilfunk.de/onlineservice/logout",tokenExchange:"https://token-exchange.freenet-mobilfunk.services/v1/",env:"PROD"}),app.controller("AccountDeleteCtrl",["$scope","$location","$log","WizardHandler","ErrorService","AuthService2","accountDeleteService",function(e,t,n,a,r,i,o){window.location.href=window.location.protocol+"//"+window.location.host+"/onlineservice/meine-daten/onlinekonto-loeschen",e.setBreadcrumb([{url:"#/meine-daten",title:"Meine Daten"},{url:"#/meine-daten/benutzerkonto-loeschen",title:"Benutzerkonto löschen"}]),e.isLoading=!1,e.username=i.getUser().username,e.accountDelete=function(){e.isLoading=!0,o.accountDelete().then(function(t){delete e.errorMessage,202===t.status?(e.success=!0,i.logout("accountDelete","Ihr Benutzerkonto wurde gelöscht.")):(e.isLoading=!1,a.wizard().previous(),e.errorMessage="Leider trat ein Fehler beim Löschen Ihres Accounts auf.")},function(t){e.isLoading=!1,a.wizard().previous(),e.errorMessage=r.getMessage(t.data.code)})}}]),app.factory("accountDeleteService",["RequestService",function(e){function t(){return e.del("accountDelete")}return{accountDelete:t}}]),app.controller("AddContractCtrl",["$scope","$http","$q","$location","$log","$timeout","api","LocalStorage","ValueStorage","addContractService","marketingService","WizardHandler","ErrorService","AuthService2",function(e,t,n,a,r,i,o,s,c,l,d,u,g,p){e.isLoading=!1,e.contractFlow=!0,e.firstResponse=!1,e.requiredData=!1,e.customerNumber=!1,e.phoneNumber=!1,e.roleOptions=!1,e.productOwner=!1,e.productUser=!1,e.customerAccountAdmin=!1,e.roleChoise=!1,e.roleChoosen=!1,e.requires=!0,e.noIdentification=!1,e.personalContact=!1,e.identification=!1,e.requiresPerson=!1,e.requiresMarketingPermit=!1,e.requiresIban=!1,e.requiresZipCode=!1,e.requiresIbanOrZipCode=!1,e.requiresMarketingPermit=!1,e.migrateSignin=!1,e.adminData=!1,e.emailConfirm=!1,e.hasIdentificationCode=!1,e.sendSMS=!1,e.sendEmail=!1,e.sendLetter=!1,e.checkIban=!1,e.msisdnSelect=!1,e.smsConfirm=!1,e.emailConfirm=!1,e.letterConfirm=!1,e.doMigrateSignin=!0,e.privateUser=!1,e.businessUser=!1,e.contractdata={},e.additionalData={},e.permitdata={},e.identifybysms={},e.identifybyemail={},e.identifybyiban={},e.setBreadcrumb([{url:"#/datenvervollstaendigung",title:"Datenvervollständigung"}]),e.privateUserFunc=function(){e.privateUser=!0},e.businessUserFunc=function(){e.businessUser=!0},e.existingAccountFunc=function(){p.logout("addContract")},e.newAccountFunc=function(){e.newAccount=!0,e.doMigrateSignin=!1},e.wayfinder=function(){newBusinessAccount===!0?e.businessLogin():(delete e.errorMessage,u.wizard().next())},e.callAddContract=function(t){e.addContract(t,e.businessUser,e.requires,e.msisdnSelect,e.sendEmail,e.sendLetter,e.checkIban,e.smsConfirm,e.sendSMS,e.hasIdentificationCode,e.requiresIbanOrZipCode)},e.getRoleOptions=function(){e.isLoading=!0,e.privateUser&&(e.contractdata.identifier=e.contractdata.firstIdentifier?e.contractdata.firstIdentifier:e.contractdata.identifier),delete e.errorMessage,e.roleOptions||e.contractId?(e.isLoading=!1,"undefined"!=typeof e.contractdata.userRole?(e.userRole=e.contractdata.userRole,"ProductUser"===e.contractdata.userRole?(e.privateUserFunc(),e.contractdata.invoiceMsisdn&&(e.msisdn=e.contractdata.invoiceMsisdn),e.msisdn&&(e.roleChoosen=!0,e.callAddContract(e.contractdata.identifier))):"CustomerAccountAdmin"===e.contractdata.userRole&&(e.businessUserFunc(),e.msisdn?e.contractdata.invoiceMsisdn=e.msisdn:e.contractdata.identifier=e.customerId,"undefined"!=typeof e.contractdata.identifier&&"undefined"!=typeof e.contractdata.invoiceMsisdn&&(e.roleChoosen=!0,e.callAddContract(e.contractdata.identifier)))):(e.privateUserFunc(),e.callAddContract(e.contractdata.identifier))):(r.debug("getRoleOptions",e),l.getRoleOptions(e).then(function(t){if(e.isLoading=!1,t){var n=t.data;n.roles&&(n.roles.length>0?(e.roleOptions=!0,-1!==n.roles.indexOf("CUSTOMERACCOUNT_ADMIN")&&(e.roleChoise=!0),angular.forEach(n.roles,function(t){"PRODUCT_OWNER"===t?e.productOwner=!0:"PRODUCTUSER"===t?e.productUser=!0:"CUSTOMERACCOUNT_ADMIN"===t&&(e.customerAccountAdmin=!0)})):e.roleOptions=!1),n.requires&&"contractId"===n.requires&&!e.contractdata.contractId&&(e.requiredData=!0),n.givenData&&(n.givenData.msisdn&&(e.msisdn=n.givenData.msisdn,e.neededData="Kundennummer"),n.givenData.customerId&&(e.customerId=n.givenData.customerId,e.neededData="Rufnummer"),n.givenData.contractId&&(e.requiredData=!1,e.contractId=n.givenData.contractId),(-1===n.roles.indexOf("CUSTOMERACCOUNT_ADMIN")&&2===n.roles.length||e.productUser&&1===n.roles.length&&!e.requiredData)&&(e.contractdata.identifier=e.contractdata.firstIdentifier,e.privateUserFunc(),e.callAddContract(e.contractdata.identifier)))}},function(t){e.isLoading=!1,t.data&&t.data.code?e.errorMessage=g.getMessage(t.data.code):e.errorMessage=g.getMessage(503)}))},e.addContract=function(t,n,a,r,i,o,s,c,d,p,f){e.isLoading=!0,!a||r||i||o||s||c||d||p||f?!r&&!f||c?i&&f?(e.isLoading=!1,e.emailConfirm=!0):(!a||o||s||c||i&&!f)&&!e.hasIdentificationCode?(e.isLoading=!1,delete e.errorMessage,u.wizard().next()):d&&p&&(e.isLoading=!1,delete e.errorMessage,e.smsConfirm=!0,u.wizard().next()):(e.isLoading=!1,l.identifyBySMS(e,e.additionalData.msisdn).then(function(t){"sms"===t.data.channel&&(e.smsConfirm=!0,$.fancybox({href:"#tokensent",title:"Aktivierungs-Code wurde versendet!",type:"inline"})),t.data.error&&(400===t.data.error.code?e.errorMessage=g.getMessage(503):e.errorMessage=g.getMessage(t.data.error.code),e.roleOptions=!1)})):l.addContract(e).then(function(t){var n=t.data;switch(n.invoiceMsisdn=e.contractdata.invoiceMsisdn,e.isLoading=!1,e.firstResponse=!0,e.contractdata=n,e.errorMessage="",n.hasIdentificationCode&&(e.hasIdentificationCode=!0),n.requiresMarketingPermit&&(e.requiresMarketingPermit=!0),e.identificationBy=n.identificationBy,n.requires){case"":e.requires=!1,u.wizard().next();break;case"personalContact":e.personalContact=g.getMessage("personalContact","info"),$(".progressbar li:nth-child(1), .progressbar li:nth-child(2)").addClass("is-finished"),u.wizard().goTo(2);break;case"identification":e.identification=!0;break;case"caAdminData":e.adminData=!0}switch(n.requiresPerson&&(e.requiresPerson=!0),n.requiresMarketingPermit&&(e.requiresMarketingPermit=!0),n.requiresIban&&(e.requiresIban=!0),n.requiresZipCode&&(e.requiresZipCode=!0),n.migrateSignin?e.migrateSignin=!0:e.doMigrateSignin=!1,n.identificationBy){case"":e.noIdentification=!0;break;case"email":e.sendEmail=!0;break;case"iban":e.checkIban=!0;break;case"letter":e.sendLetter=!0}e.identification&&("sms"!==n.identificationBy||e.checkIban||(e.sendSMS=!0,e.hasIdentificationCode||(n.possibleMsisdns.length>1?e.msisdnSelect=!0:(e.additionalData.msisdn=n.possibleMsisdns[0],e.isLoading=!1,e.requiresZipCode||e.requiresIban?e.requiresIbanOrZipCode=!0:(identifybysms=l.identifyBySMS(e,e.additionalData.msisdn),identifybysms.then(function(t){"sms"===t.data.channel&&(e.smsConfirm=!0,$.fancybox({href:"#tokensent",title:"Aktivierungs-Code wurde versendet!",type:"inline"})),t.data.error&&(e.roleOptions=!1,e.errorMessage=g.getMessage(503))}))))),"email"!==n.identificationBy||e.requiresMarketingPermit||e.hasIdentificationCode||(e.isLoading=!1,delete e.errorMessage,u.wizard().next()))},function(t){e.isLoading=!1,"404"===t.data.code?e.errorMessage="Es konnten keine Kundendaten gefunden werden.":(e.errorMessage=g.getMessage(t.data.code),u.wizard().goTo(0)),n||(e.roleOptions=!1)})},e.confirm=function(t,n,a,r,i,o,s,c){if(i||a||!(!n||r||o&&c||s&&c||!s&&!c))s&&!c?l.identifyByLetter(e.contractdata.identifier,e.contractdata.invoiceMsisdn,e.additionalData.zipCode,e.additionalData.iban).then(function(t){"letter"===t.data.channel&&(e.letterConfirm=!0,u.wizard().next())},function(t){e.errorMessage=g.getMessage(t.data.code)}):(a||i)&&(l.identifyByEmail(e).then(function(t){var n=t.data;"email"===n.channel&&(e.emailConfirm=!0,e.emailAddress=n.emailAddress,u.wizard().next())},function(t){e.errorMessage=g.getMessage(t.data.code)}),u.wizard().next());else{e.isLoading=!0;var d=t.identifier?t.identifier:e.msisdn?e.msisdn:e.customerId;l.confirm(d,e.additionalData).then(function(t){if(delete e.errorMessage,e.isLoading=!1,t.data.length>0){var n=p.getUser();n.isNewUser=!1,n.partyIds=t.data,e.contractsAdded=!0,e.isLoading=!1}$(".progressbar li:nth-child(1), .progressbar li:nth-child(2)").addClass("is-finished"),u.wizard().next()},function(t){e.isLoading=!1,10027===t.data.code?e.requiresPerson=!0:e.errorMessage=g.getMessage(t.data.code),u.wizard().goTo(0)}),e.additionalData.msisdn=!1}},e.logout=function(e){p.logout(e)},e.delErrMsg=function(){delete e.errorMessage}}]),app.filter("activationCodeDelivery",function(){return function(e){switch(e){case"email":return"E-Mail";case"sms":return"SMS";case"letter":return"Brief"}}}),app.factory("addContractService",["$http","$log","$filter","RequestService",function(e,t,n,a){function r(e,n){return e||t.debug("::confirm => no identifier is is set"),a.post(["newUserConfirm",e],n,{flush:!1})}t=t.getInstance("addContractService");var i={};return{getRoleOptions:function(e){var t={},n="undefined"!=typeof e.contractdata.firstIdentifier?e.contractdata.firstIdentifier:e.contractdata.identifier,r=e.contractdata.contractId;return t.secondIdentifier=e.contractId?"":r,a.get(["getRoleOptions",n],t)},addContract:function(e){var t,n={},r="",i="",o=e.contractdata.invoiceMsisdn;return r=e.businessUser?e.msisdn?e.contractdata.identifier:e.customerId:e.msisdn?e.msisdn:e.customerId,-1!==r.indexOf(".")?(t=e.contractdata.identifier.split("."),i=t[1]):i=r,(e.businessUser||e.productUser&&!e.customerAccountAdmin&&!e.productOwner)&&(n.invoiceMsisdn=o),a.get(["addContract",i],n)},identifyBySMS:function(e,t){return i=e.businessUser===!0?{msisdn:t,invoiceMsisdn:e.contractdata.invoiceMsisdn,zipCode:e.additionalData.zipCode,iban:n("uppercase")(e.additionalData.iban)}:{msisdn:t},a.post(["identifyBySMS",e.contractdata.identifier],i)},identifyByEmail:function(e){return t.debug("scope",e),i=e.businessUser===!0?{invoiceMsisdn:e.contractdata.invoiceMsisdn,zipCode:e.additionalData.zipCode,iban:n("uppercase")(e.additionalData.iban)}:{},t.debug("_identifyData",i),a.post(["identifyByEmail",e.contractdata.identifier],i)},identifyByLetter:function(e,t,r,o){return i={invoiceMsisdn:t,zipCode:r,iban:n("uppercase")(o)},a.post(["identifyByLetter",e],i)},confirm:r}}]),app.controller("AddProspectCtrl",["$scope","$location","$log","WizardHandler","ErrorService","AuthService2","addProspectService","marketingService",function(e,t,n,a,r,i,o,s){e.isLoading=!1,e.prospectdata={},e.setBreadcrumb([{url:"#/datenvervollstaendigung-interessent",title:"Datenvervollständigung"}]),e.addProspect=function(){e.isLoading=!0,delete e.errorMessage,n.debug("addProspect",e),o.addProspect(e.prospectdata).then(function(t){var a=t.data;e.isLoading=!1,n.debug("Daten erfolgreich vervollständigt.",a);var r=i.getUser();r.isNewUser=!1,r.partyIds=a,i.fetchContracts(r).then(function(){e.prospectdata.hasMarketingPermit&&s.setMarketingInfo().then(function(e){n.debug("marketing",e)})})},function(t){var i=t.data;switch(e.isLoading=!1,n.error("Daten konnten nicht vervollständigt werden.",i),i.code){case 20600:e.errorMessage=r.getMessage(20503);break;case 3e3:e.errorMessage=r.getMessage(20503);break;default:e.errorMessage=r.getMessage(i.code)}a.wizard().goTo(0)})},e.goToDashboard=function(){t.path("/dashboard")}}]),app.factory("addProspectService",["$log","RequestService",function(e,t){return{addProspect:function(n){return e.debug("saving prospect data",n),t.post("addProspect",{person:{salutation:n.salutation,firstName:n.firstName,lastName:n.lastName,dateOfBirth:n.dateOfBirth}})}}}]),app.controller("AddressCtrl",["$scope","$log","$location","addressService","AuthService2","RequestService",function(e,t,n,a,r,i){function o(n){e.addressFormOriginal=n,e.addressForm=angular.copy(n),angular.isDefined(n.address.postalCode)&&angular.isDefined(n.address.city)?d(n.address.postalCode,n.address.city):t.error("Incomplete Address Data"),e.isLoading=!1}function s(t){var n=(t.data.address,e.addressFormOriginal.address);delete n.country,e.compare=angular.equals(t.data.address,e.addressFormOriginal.address)}function c(n){t.error(n),e.isLoading=!1}function l(e){t.error(e)}function d(t,n){a.checkTowns(t).then(function(t){e.townList=t}),n&&u(t,n)}function u(n,r){e.streetListError=!1,e.streetList=[],a.checkStreets(n,r).then(function(t){e.streetList=t},function(n){t.debug("addressService::checkStreets returned error",n),e.streetListError=!0})}window.location.href=window.location.protocol+"//"+window.location.host+"/onlineservice/meine-daten/kontaktadresse-aendern",e.isLoading=!0,e.compare=!1,e.addressForm={},e.setBreadcrumb([{url:"#/meine-daten",title:"Meine Daten"},{url:"#/meine-daten/adresse-aendern",title:"Adresse ändern"}]),r.getCurrentContractDetails().then(function(t){e.contract=t}),a.getAddress().then(o,c),a.getInvoiceAddress().then(s,l),e.hasFormChanged=function(){return angular.isObject(e.addressFormOriginal)?!angular.equals(e.addressFormOriginal,e.addressForm):!1},e.zipChange=function(t){e.addressForm.address.city="",e.addressForm.address.street="",e.addressForm.address.streetNr="",d(t)},e.townChange=function(e,t){u(e,t)},e.saveAddress=function(){e.errorCode="";var n=a.saveAddress(e.addressForm,e.addressFormOriginal),r={success:function(n,a){t.info("success",n,a);try{e[a+"Code"]=n.data.taskId||n.data[a].success}catch(r){e[a+"Code"]="erfolgreich"}},error:function(n,a){t.error("error",n),e[a+"Code"]=n.data.code?n.data.code:"",e[a+"Fault"]=!0},notify:function(t){e[t+"Changed"]=!0},fail:function(e){t.error("fail:",e)}};i.handlePromises(n,r)},e.backToStart=function(){n.path("/meine-daten")}}]),app.directive("appMdAddress",function(){return{restrict:"A",template:'<p>{{data.name.salutation}} <span ng-show="data.name.title != \'-\'">{{data.name.title}}</span><br>{{data.name.firstName}} {{data.name.lastName}} {{data.name.nameAffix}}<br>{{data.name.companyName}} {{data.name.companyNameAppendix}}</p><p>{{data.address.street}} {{data.address.streetNr}}<span ng-show="data.address.prefix">, {{data.address.prefix}}</span><br>{{data.address.postalCode}} {{data.address.city}}</p><p ng-show="phone || fax">Telefon: {{phone}}<br>Fax: {{fax}}</p>',scope:{data:"=appMdAddress",phone:"=phone",fax:"=fax"}}}),app.factory("addressService",["$q","$log","invoiceService","RequestService","AuthService2",function(e,t,n,a,r){function i(){return r.getCustomerData()}function o(){return n.getInvoiceAddress()}function s(e){var n=c(e.address.street);t.debug("parsed street "+e.address.street+" into",n),n.streetNr&&(e.address.street=n.street,e.address.streetNr=n.streetNr)}function c(e){var t={},n=e.match(/(.+?)(\s+(\d+\S*))?$/);return n&&n.length>1&&(t.street=n[1],angular.isDefined(n[3])&&(t.streetNr=n[3])),t}function l(e,n){var r,i=d(e),o={};return t.info(e.address,n.address),angular.equals(e.address,n.address)||(r=n.getLink("changeAddress"),e.invoice&&(r+="?updateInvoiceAddress=true"),o.address=a.put(r,i)),n.phone!==e.phone&&(r=n.getLink("changePhone"),e.phone?o.phone=a.put(r,{phone:e.phone}):o.phone=a.del(r)),n.fax!==e.fax&&(r=n.getLink("changeFax"),e.fax?o.fax=a.put(r,{fax:e.fax}):o.fax=a.del(r)),o}function d(e){return{street:e.address.street+" "+e.address.streetNr,postalCode:e.address.postalCode,prefix:e.address.prefix,city:e.address.city}}return t=t.getInstance("addressService"),{convertAddress:s,getAddress:i,saveAddress:l,getInvoiceAddress:o,checkTowns:function(t){var n=e.defer();return/^[0-9]{1,5}$/.test(t)?a.get("checkTowns",{zip:t}).then(function(e){n.resolve(e.data)},n.reject):n.reject("Invalid Postalcode"),n.promise},checkStreets:function(t,n){var r=e.defer();return/^[0-9]{4,5}$/.test(t)?a.get("checkStreets",{zip:t,town:n}).then(function(e){e&&e.data&&Array.isArray(e.data)?r.resolve(e.data):r.reject("No streets found for postal code")},r.reject):r.reject("Invalid Postalcode"),r.promise}}}]),app.config(["$provide","$compileProvider","$routeProvider","$httpProvider","$locationProvider","$logProvider","IdleProvider","$ocLazyLoadProvider","$parseProvider","$qProvider",function(e,t,n,a,r,i,o,s,c,l){function d(e){var t={};return t[e]=["$ocLazyLoad",function(t){return t.load(e)}],t}function u(e,t,n,a,r){var i=e.defer();if(n.isLoggedIn()){var o=n.isNewUser(r)||n.isInkasso(r);o?(t.debug("isAuthenticated: is new user or is inkasso"),i.reject({needsRedirect:!0,path:o})):i.resolve()}else t.debug("isAuthenticated: user is not logged in"),i.reject({needsAuthentication:!0});return i.promise}function g(e,t,n,a,r,i,o){var s=o.search(),c=e.defer(),l=i.get(r.taninfo);if(n.isLoggedIn()||n.isSoftLoggedIn()||s.tan||l||s.q){var d=n.isNewUser(a);d?c.reject({needsRedirect:!0,path:d}):c.resolve()}else c.reject({needsAuthentication:!0,needsSoftLogin:!0});return c.promise}function p(e,t,n,a,r,i){var o=e.defer();if(t.isLoggedIn())o.resolve();else{var s=a.get(n.prolongationInfo),c=r.search(),l=a.get(n.taninfo);c.tan||l||c.q?l?o.resolve():i.tanAuthorization().then(o.resolve,function(){o.reject({needsAuthentication:!0})}):"SOFT"===s?o.resolve():"HARD"===s?o.reject({needsAuthentication:!0}):o.reject({needsAuthentication:!0})}return o.promise}r.hashPrefix(""),l.errorOnUnhandledRejections(!1),o.idle(1500),o.timeout(60),a.defaults.withCredentials=!0,a.interceptors.push(["$q","$location","$rootScope",function(e,t,n){return{request:function(e){return e.timeout||(e.timeout=9e4),e},responseError:function(t){return t&&401===t.status&&0!==t.config.url.indexOf("https")&&n.$broadcast("401",t.config.url),e.reject(t)}}}]),a.interceptors.push("AuthInterceptor"),a.interceptors.push("nboInterceptor"),r.html5Mode(!1),i.debugEnabled($.cookie?!!$.cookie("debug"):!1),s.config({debug:!1,modules:[{name:"prolongation",files:["/inc/scripts/components/prolongation.html","/inc/scripts/components/prolongation.js","/inc/styles/pages/vvl.css"]},{name:"esim",files:["/inc/scripts/components/sim.min.js"]}]}),n.whenAuthenticated=function(e,t){return t.resolve=t.resolve||{},angular.extend(t.resolve,{isLoggedIn:["$q","$log","AuthService2","$location",function(t,n,a,r){return u(t,n,a,r,e)}]}),n.when(e,t)},n.whenSoftAuthenticated=function(e,t){return t.resolve=t.resolve||{},angular.extend(t.resolve,{isLoggedIn:["$q","$log","AuthService2","$location",function(t,n,a,r){return g(t,n,a,e,r)}]}),n.when(e,t)},n.whenVVLPossible=function(e,t){return t.resolve=t.resolve||{},angular.extend(t.resolve,{isLoggedIn:["$q","$log","AuthService2","ValueStorage","LocalStorage","$location","OidcService",function(t,n,a,r,i,o,s){return g(t,n,a,e,r,i,o).then(function(){return p(t,a,r,i,o,s)})}]}),n.when(e,t)},n.when("/meine-daten/aktivierung-benutzername/:id/:verificationCode",{templateUrl:"../partials/verification-username.html",controller:"VerificationUsernameCtrl"}).whenAuthenticated("/meine-daten/passwort-aendern",{templateUrl:"../partials/password.html",resolve:d("/inc/scripts/components/password.min.js"),controller:"PasswordCtrl"}).whenAuthenticated("/meine-daten/einwilligung",{templateUrl:"../partials/advt-consent.html",controller:"MarketingCtrl"}).whenAuthenticated("/meine-rechnungen/musterrechnung",{templateUrl:"../partials/bill-sample.html",controller:["$scope",function(e){e.setBreadcrumb([{url:"#/meine-rechnungen",title:"Meine Rechnungen"},{url:"#/meine-rechnungen/musterrechnung",title:"Musterrechnung"}])}]}).whenAuthenticated("/meine-rechnungen/rechnungserlaeuterung/musterrechnung-mit-guthaben",{templateUrl:"../partials/bill-with-credit.html",controller:["$scope",function(e){e.setBreadcrumb([{url:"#/meine-rechnungen",title:"Meine Rechnungen"},{url:"#/meine-rechnungen/rechnungserlaeuterung",title:"Rechnungserläuterung"},{url:"#/meine-rechnungen/rechnungserlaeuterung/musterrechnung-mit-guthaben",title:"Musterrechnung mit Guthaben"}])}]}).whenAuthenticated("/meine-rechnungen/rechnungserlaeuterung/musterrechnung-mit-offenen-posten",{templateUrl:"../partials/bill-with-open-positions.html",controller:["$scope",function(e){e.setBreadcrumb([{url:"#/meine-rechnungen",title:"Meine Rechnungen"},{url:"#/meine-rechnungen/rechnungserlaeuterung",title:"Rechnungserläuterung"},{url:"#/meine-rechnungen/rechnungserlaeuterung/musterrechnung-mit-offenen-posten",title:"Musterrechnung mit offenen Posten"}])}]}).whenAuthenticated("/meine-rechnungen/rechnungserlaeuterung/musterrechnung-mit-sepa",{templateUrl:"../partials/bill-sample-sepa.html",controller:["$scope",function(e){e.setBreadcrumb([{url:"#/meine-rechnungen",title:"Meine Rechnungen"},{url:"#/meine-rechnungen/rechnungserlaeuterung",title:"Rechnungserläuterung"},{url:"#/meine-rechnungen/rechnungserlaeuterung/musterrechnung-mit-sepa",title:"Musterrechnung mit SEPA"}])}]}).whenAuthenticated("/meine-rechnungen/rechnungsbenachrichtigung",{templateUrl:"../partials/bill-notification.html",resolve:d("/inc/scripts/components/bill-notification.min.js"),controller:"NotificationCtrl"}).whenAuthenticated("/meine-rechnungen/rechnung-online",{templateUrl:"../partials/bill-online.html",controller:"BillOnlineCtrl"}).whenAuthenticated("/meine-rechnungen/kostencheck/kostencheck-per-sms",{templateUrl:"../partials/usages-per-sms.html",controller:["$scope",function(e){e.setBreadcrumb([{url:"#/meine-rechnungen",title:"Meine Rechnungen"},{url:"#/meine-rechnungen/kostencheck",title:"Kostencheck"},{url:"#/meine-rechnungen/kostencheck-per-sms",title:"Kostencheck per SMS"}])}]}).whenAuthenticated("/meine-rechnungen/zielnetzabfrage",{templateUrl:"../partials/request-targetnet.html",resolve:d("/inc/scripts/components/request-targetnet.min.js"),controller:"TargetNetCtrl"}).whenAuthenticated("/meine-vertraege",{templateUrl:"../partials/contracts.html",controller:"ContractsCtrl"}).whenAuthenticated("/meine-vertraege/vertragsdetails",{templateUrl:"../partials/contract-detail.html",controller:"ContractDetailCtrl"}).whenAuthenticated("/meine-vertraege/vertragsdetails/produktinformationen",{templateUrl:"/partials/contractinfos.html",controller:"contractinfosCtrl"}).whenAuthenticated("/meine-vertraege/vertragsdetails/vertragsverlaengerung/geraet-waehlen/tarif-waehlen",{redirectTo:"/meine-vertraege/vertragsdetails/vertragsverlaengerung"}).whenAuthenticated("/meine-vertraege/vertragsdetails/vertragsverlaengerung/geraet-waehlen/tarif-waehlen/option-waehlen",{redirectTo:"/meine-vertraege/vertragsdetails/vertragsverlaengerung"}).whenAuthenticated("/meine-vertraege/vertragsdetails/vertragsverlaengerung/geraet-waehlen/tarif-waehlen/uebersicht",{redirectTo:"/meine-vertraege/vertragsdetails/vertragsverlaengerung"}).whenAuthenticated("/meine-vertraege/vertragsdetails/vertragsverlaengerung/tarif-waehlen/geraet-waehlen",{redirectTo:"/meine-vertraege/vertragsdetails/vertragsverlaengerung"}).whenAuthenticated("/meine-vertraege/vertragsdetails/vertragsverlaengerung/tarif-waehlen/geraet-waehlen/option-waehlen",{redirectTo:"/meine-vertraege/vertragsdetails/vertragsverlaengerung"}).whenAuthenticated("/meine-vertraege/vertragsdetails/vertragsverlaengerung/tarif-waehlen/geraet-waehlen/uebersicht",{redirectTo:"/meine-vertraege/vertragsdetails/vertragsverlaengerung"}).whenVVLPossible("/meine-vertraege/vertragsdetails/vertragsverlaengerung",{templateUrl:"../partials/prolongation/relaunch_home.html",resolve:d("prolongation"),controller:"VvlHomeCtrl"}).whenVVLPossible("/meine-vertraege/vertragsdetails/vertragsverlaengerung/geraet-waehlen",{templateUrl:"../partials/prolongation/relaunch_geraet.html",resolve:d("prolongation"),controller:"VvlRelaunchDeviceCtrl",controllerAs:"vm"}).whenVVLPossible("/meine-vertraege/vertragsdetails/vertragsverlaengerung/gutschrift",{templateUrl:"../partials/prolongation/relaunch_gutschrift.html",resolve:d("prolongation"),controller:"VvlRelaunchBonusCtrl",controllerAs:"vm"}).whenVVLPossible("/meine-vertraege/vertragsdetails/vertragsverlaengerung/treue-deal",{templateUrl:"../partials/prolongation/treue-deal.html",resolve:d("prolongation"),controller:"VvlRelaunchBonusCtrl",controllerAs:"vm"}).whenVVLPossible("/meine-vertraege/vertragsdetails/vertragsverlaengerung/warenkorb",{templateUrl:"../partials/prolongation/relaunch_warenkorb.html",resolve:d("prolongation"),controller:"VvlRelaunchCartCtrl",controllerAs:"vm"}).whenVVLPossible("/meine-vertraege/vertragsdetails/vertragsverlaengerung/bestaetigung",{templateUrl:"../partials/prolongation/confirmation.html",resolve:d("prolongation"),controller:"VvlConfirmationCtrl"}).whenAuthenticated("/meine-vertraege/vertragsdetails/vertragsverlaengerung/hotline",{templateUrl:"../partials/prolongation/hotline.html",resolve:d("prolongation"),controller:"VvlHotlineCtrl"}).whenAuthenticated("/meine-vertraege/vertragsdetails/vertragsverlaengerung/reminder",{templateUrl:"../partials/prolongation/reminder.html",resolve:d("prolongation"),controller:"VvlReminderCtrl"}).whenAuthenticated("/meine-vertraege/vertragsdetails/zusatzoptionen",{controller:"optionsCtrl",templateUrl:"/partials/options.html"}).whenAuthenticated("/meine-vertraege/vertragsdetails/zusatzoptionen/:group",{controller:"optionsCtrl",templateUrl:"/partials/options.html"}).whenAuthenticated("/meine-vertraege/vertragsdetails/zusatzoptionen/:group/:option",{controller:"optionsCtrl",templateUrl:"/partials/options.html"}).whenAuthenticated("/meine-vertraege/vertragsdetails/handyversicherung",{controller:"InsurancesCtrl",templateUrl:"/partials/ewp.html"}).whenAuthenticated("/meine-vertraege/vertragsdetails/partnercard/angebot",{templateUrl:"../partials/partnercard/angebot.html",resolve:d("/inc/scripts/components/partnercard.min.js"),controller:"PartnercardCtrl"}).whenAuthenticated("/meine-vertraege/vertragsdetails/partnercard/bestellung",{templateUrl:"../partials/partnercard/bestellung.html",resolve:d("/inc/scripts/components/partnercard.min.js"),controller:"PartnercardCtrl"}).whenAuthenticated("/meine-vertraege/vertragsdetails/partnercard/bestellbestaetigung",{templateUrl:"../partials/partnercard/bestellbestaetigung.html",resolve:d("/inc/scripts/components/partnercard.min.js"),controller:"PartnercardOrderCtrl"}).whenAuthenticated("/dashboard",{templateUrl:"../partials/dashboard.html",controller:"DashboardCtrl"}).when("/passwort-vergessen",{templateUrl:"../partials/password-forgotten.html",controller:"PasswordForgottenCtrl"}).when("/passwort-erstellen/:pwtoken",{templateUrl:"../partials/password-set-email.html",controller:"PasswordForgottenCtrl"}).whenAuthenticated("/prepaidcash",{templateUrl:"../partials/prepaidcash.html",controller:"PrepaidCtrl"}).whenAuthenticated("/prepaid/tarife",{templateUrl:"../partials/prepaid-tariffs.html",controller:["$scope",function(e){e.setBreadcrumb([{url:"#/meine-vertraege",title:"Meine Verträge"},{url:"#/meine-vertraege/vertragsdetails",title:"Vertragsdetails"},{url:"#/prepaid/tarife",title:"Tarifübersicht"}])}]}).whenAuthenticated("/prepaid/vertrag",{templateUrl:"../partials/prepaid-contract.html",controller:["$scope",function(e){e.setBreadcrumb([{url:"#/meine-vertraege",title:"Meine Verträge"},{url:"#/meine-vertraege/vertragsdetails",title:"Vertragsdetails"},{url:"#/prepaid/vertrag",title:"Wechsel auf Vertrag"}])}]}).whenAuthenticated("/prepaid/optionen",{templateUrl:"../partials/prepaid-options.html",controller:["$scope",function(e){e.setBreadcrumb([{url:"#/meine-vertraege",title:"Meine Verträge"},{url:"#/meine-vertraege/vertragsdetails",title:"Vertragsdetails"},{url:"#/prepaid/optionen",title:"Tarifoptionen"}])}]}).whenAuthenticated("/gewinnspiel",{templateUrl:"../partials/ps-gewinnspiel.html",controller:"PsGameCtrl"}).when("/erstanmeldung",{templateUrl:"../partials/register.html",controller:"RegistrationCtrl"}).when("/aktivierung/:uuid/:verificationCode",{templateUrl:"../partials/verification.html",controller:"VerificationCtrl"}).whenAuthenticated("/datenvervollstaendigung",{templateUrl:"../partials/add-contract-data.html",controller:"AddContractCtrl"}).whenAuthenticated("/vertragsinhaber-aktivierung/:identifyer/:verificationCode",{templateUrl:"../partials/verification-newuser.html",controller:"VerificationNewUserCtrl"}).whenAuthenticated("/vertragsinhaber-aktivierung/:identifyer/:msisdn/:verificationCode",{templateUrl:"../partials/verification-newuser.html",controller:"VerificationNewUserCtrl"}).whenAuthenticated("/aktivierung-brief",{templateUrl:"../partials/verification-letter.html",controller:"AddContractCtrl"}).when("/aktivierung-email/:verificationCode",{templateUrl:"../partials/verification-email-msisdn.html",controller:"VerificationEmailCtrl"}).when("/aktivierung-msisdn",{templateUrl:"../partials/verification-msisdn.html",controller:"VerificationMsisdnCtrl"}).whenAuthenticated("/datenvervollstaendigung-interessent",{templateUrl:"../partials/add-prospect-data.html",controller:"AddProspectCtrl"}).whenAuthenticated("/prepaid-monatlich",{templateUrl:"../partials/prepaid-monthly.html",controller:"MonthlyCtrl"}).whenAuthenticated("/prepaid-guthaben",{templateUrl:"../partials/prepaid-creditbalance.html",controller:"ByCreditBalanceCtrl"}).whenAuthenticated("/partner-angebot-d1",{templateUrl:"../partials/partner-angebot-d1.html",controller:"partnerofferCtrl"}).whenAuthenticated("/partner-angebot-d2",{templateUrl:"../partials/partner-angebot-d2.html",controller:"partnerofferCtrl"}).when("/login/cct/:token/:sessionid",{controller:"AuthCtrl",controllerAs:"auth"}).when("/login",{templateUrl:"../partials/login.html",controller:"AuthCtrl",controllerAs:"auth"}).when("/login/:type",{templateUrl:"../partials/login.html",controller:"AuthCtrl",controllerAs:"auth"}).when("/login-vvl",{templateUrl:"../partials/login-vvl.html",controller:"AuthCtrl",controllerAs:"auth"}).when("/login-vvl-app/",{templateUrl:"../partials/login-vvl-app.html",controller:"AuthCtrl",controllerAs:"auth"}).when("/login-vvl-retention/",{templateUrl:"../partials/login-vvl-retention.php",controller:"AuthCtrl",controllerAs:"auth"}).when("/logout",{templateUrl:"../partials/logout.html",resolve:d("/inc/scripts/components/logout.min.js"),controller:"LogoutCtrl"}).when("/login-mlp",{templateUrl:"../partials/login/login-mlp.html",controller:["$scope",function(e){e.setBreadcrumb([{url:"#/login-mlp",title:"Master Login Testseite"}])}]}).when("/preload",{templateUrl:"../partials/login-preload.html",controller:"PreloadCtrl",controllerAs:"vm"}).whenSoftAuthenticated("/soft",{templateUrl:"../partials/login/login-soft.html",controller:["$scope",function(e){e.setBreadcrumb([{url:"#/soft",title:"Master Login Softtest"}])}]}).when("/debug",{templateUrl:"../partials/dashboard.html",
controller:function(){$.cookie("debug",$.cookie("debug")?"":!0,{path:"/",expires:7})}}).when("/book-an-appointment",{templateUrl:"../partials/book-an-appointment/test.html"}).otherwise({template:"",controller:"MainCtrl",controllerAs:"main"})}]),app.config(["$provide",function(e){e.decorator("$q",["$delegate",function(e){var t=e;return t.allSettled=function(e){var n=_.reduce(e,function(e,t,n){return angular.isUndefined(t)||!angular.isFunction(t.then)||(e[n]=t.then(function(e){return{resolved:!0,value:e}},function(e){return{resolved:!1,reason:e}})),e},{});return t.all(n)},t}])}]),app.config(["$provide",function(e){function t(e){var t=function(e){return{log:e.log,info:e.info,warn:e.warn,debug:e.debug,error:e.error}}(e),n=function(e,t){var n=function(){var n=Array.prototype.slice.call(arguments);angular.isString(n[0])?n[0]=(t?t:"")+n[0]:""!==t&&n.unshift(t),e.apply(null,n)};return n},a=function(e){return e=void 0!==e?e+"::":"",{log:n(t.log,e),info:n(t.info,e),warn:n(t.warn,e),debug:n(t.debug,e),error:n(t.error,e)}};return e.log=n(e.log),e.info=n(e.info),e.warn=n(e.warn),e.debug=n(e.debug),e.error=n(e.error),e.getInstance=a,e}e.decorator("$log",["$delegate",function(e){return t(e),e}])}]),angular.isDefinedDeep=function(e,t){return angular.isObject(e)&&angular.isString(t)?(t=t.split("."),_.every(t,function(t){return _.has(e,t)?(e=e[t],!0):!1})):!1},angular.getDeep=function(e,t){var n;if(angular.isObject(e)&&angular.isString(t))return t=t.split("."),angular.forEach(t,function(a,r){_.has(e,a)&&(e=e[a]),r===t.length-1&&(n=e)}),n},app.controller("AuthCtrl",["$q","$log","$route","$location","$scope","$rootScope","$timeout","$templateCache","$http","$compile","AuthService2","ErrorService","UrlService","OidcService","LocalStorage","ValueStorage","CryptService","ENVIRONMENT",function(e,t,n,a,r,i,o,s,c,l,d,u,g,p,f,m,h,v){function b(){var e="Mein Konto";w.title=w.isLoggedIn?w.user.username?w.user.username:"Hallo":e}t=t.getInstance("AuthCtrl"),t.debug("activecontract",f.get("userdata"));var w=this,y="Login";r.isLoggingIn=!0;var k=p.getLoginPromise();k["finally"](function(){r.isLoggingIn=!1}),i.loginLayer=!1,r.buttonText=y,r.$root.siteTitle="Online Service",r.envMlp=v.mlp,r.env=v.env;var C=localStorage.getItem("idProvider"),S="oidc"===C?!0:!1;r.oidcLogin=S,this.isLoggedIn=d.isLoggedIn(),this.showLayer=!1,this.forceLayer=!1,this.user=d.getUser(),this.login={username:this.user.username,password:void 0},this.activeContract=d.getContract(),this.logout=d.logout,this.mopapiStatus=f.get(m.mopapiStatus),r.isLoading=!1,this.user&&this.user.username&&(this.loginHint=h.encrypt(h.passwordDerivedKey(navigator.userAgent),this.user.username)),w.isLoggedIn&&-1!==a.path().indexOf("login")&&a.path("/dashboard");var A=function(){t.debug("_checkRouteParams",n);sessionStorage.getItem("accessToken");if(n.current.params){var e,a=n.current.params;if(a.type)r.loginType=a.type,u.hasMessage(a.type,"login")&&(e=u.getMessage(a.type,"login"),angular.isObject(e)||(e={message:e,type:"error"}),"error"===e.type?r.errorMessage=e.message:"info"===e.type&&(r.showHint=e.message)),"newUsername"===a.type&&f.rm(m.oidcData);else if(a.token){t.debug("AuthCtrl::$on.$routeChangeSuccess AuthService2.loginCc firing token"),f.rm(m.oidcData),p.toggleLoginOverlay(!0);f.get(m.oidcData);d.loginCc(a.token,"oidc")}}};A();var M=sessionStorage.getItem("accessToken")?sessionStorage.getItem("accessToken"):!1,I=M?M.split("."):!1;if(I){var L=JSON.parse(atob(I[1]));M=L.user_type.includes("Agent")?!0:!1}if(M){console.log("AuthCtrl::$on.$routeChangeSuccess AuthService2.loginCc firing"),p.toggleLoginOverlay(!0);var T=f.get(m.oidcData);d.loginCc(T.access_token,"auth0")}r.$on("$routeChangeSuccess",A),r.$watch(d.isLoggedIn,function(e){w.isLoggedIn=e,w.user=d.getUser(),w.activeContract=w.user.getContract(),e?(delete r.errorMessage,delete r.showHint):i.$broadcast("navLayer","close"),b()}),r.$watch(d.getUser,function(e){t.debug("user state changed, updating user",e.activeContract),w.user=e,w.activeContract=w.user.getContract(),b()},!0),r.$watch("loginForm",function(){$("input[ng-model], select[ng-model]",$('form[name="loginForm"]')).each(function(){angular.element(this).controller("ngModel").$setViewValue($(this).val())})}),r.$on("navLayer",function(e,t){"user"!==t&&(w.showLayer=!1,w.forceLayer=!1,i.loginLayer=!1)}),r.$root.$on("401",function(e,t){var n=[g.getUrl("login"),g.getUrl("logout")];-1===n.indexOf(t)&&(d.logout("auto",{force:!0}),w.login.password="")}),r.goToLoginPageUrl=function(){window.location.href=p.createPckeRequest(!0,!1,!1,"dashboard")},r.setActiveContract=function(e){r.isLoading=!0,i.setActiveContract(e,!0)["finally"](function(){r.isLoading=!1})},this.anonymize=function(){d.anonymize().then(function(){})},this.submit=function(){$("input[ng-model], select[ng-model]").each(function(){try{var e=angular.element(this).controller("ngModel").$modelValue;e||angular.element(this).controller("ngModel").$setViewValue($(this).val())}catch(t){}}),r.buttonText="Bitte warten...",r.hasErrors=!1,r.isPromise=!0,r.errorMessage="",o(function(){d.login(w.login,"service").then(function(){r.hasErrors=!1,r.isPromise=!1,r.buttonText=y,w.login.password=""},function(e){e.error&&(r.hasErrors=!0,r.isPromise=!1,r.buttonText=y,r.errorMessage=e.error)})})},this.toggle=function(e){w.showLayer=e||w.forceLayer||!w.showLayer,i.loginLayer=e||w.forceLayer||!w.showLayer,i.$broadcast("navLayer","user"),"ontouchstart"in window&&w.showLayer&&w.click()},$("#loginBlock").bind("touchstart",function(e){"A"===e.target.nodeName?e.stopPropagation():("SPAN"===e.target.nodeName&&"loginBlock"===$(e.target).parent().attr("id")||"I"===e.target.nodeName&&"loginBlock"===$(e.target).parent().parent().attr("id"))&&r.$apply(function(){w.toggle(!1)})}).hover(function(){($(window).width()>700||$("html").hasClass("no-touch"))&&r.$apply(function(){w.toggle(!0)})},function(){($(window).width()>700||$("html").hasClass("no-touch"))&&r.$apply(function(){w.toggle(!1)})}).on("keyup",function(e){const t=e.key;("Enter"===t||" "===t)&&r.$apply(function(){w.toggle(!1)})}).find(".md-header__top-bar-nav-icon-text").on("focus",function(){r.$apply(function(){i.$broadcast("navLayer","user")})}),this.setForceLayer=function(){w.forceLayer=!0},this.click=function(){window.location.href=d.isLoggedIn()?"/onlineservice/dashboard":p.createPckeRequest(!0,!1,!1,"dashboard")}}]),app.controller("LoginCtrl",["$log","$location","ENVIRONMENT","AuthService2",function(e,t,n,a){e.info("LoginCtrl");var r="/logout"===t.path();r?(e.info("Logge aus..."),a.logout(!1)):t.path("/login")}]),app.controller("MainCtrl",["$log","$location","$rootScope","OidcService","ENVIRONMENT","AuthService2",function(e,t,n,a,r,i){i.loginRequired()?(e.debug("MainCtrl => ab zum Login"),t.path("/login")):i.isOnlineService()?window.location.href="/onlineservice/dashboard":$("nav.nav .nav-list > li > a").removeClass("is-current"),this.logout=function(){i.logout()}}]),angular.module("md").factory("abTestService",["$log",function(e){e=e.getInstance("abTestService");var t=null,n=!1,a=-1,r=7,i=function(n,a){e.debug("abTestService::init"),a=a||[],t={name:n,cookieName:md5(n).substr(0,8),variants:a}},o=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},s=function(){return $.cookie(t.cookieName)},c=function(){$.cookie(t.cookieName,a,{path:"/",expires:r})},l=function(){return e.debug("abTestService::generateVariant"),t?s()?(e.debug("we already have a cookie"),a=parseInt(s(),10),n=t.variants[a],a):(e.debug("we have to set a cookie"),a=o(0,t.variants.length-1),n=t.variants[a],c(),n):""},d=function(){return l(),a},u=function(){return e.debug("getVariantname"),n||l(),n.name},g=function(e){var a=e===!0?" View":"";return{event:"ABTest",testName:t.name,testVariant:n.name+a}};return{init:i,getVariant:d,getVariantName:u,getAnalyticsCode:g}}]),app.factory("api",["$http",function(e){function t(t){t=t||"cU85a0dkUDczcWxUNERJTUZLdTUzM1BRQVRHV1ZyUkk6UFgySGVnMlM2dTZQa21TNg==",e.defaults.headers.common.Authorization="Bearer "+t}function n(t,n){t&&n&&(e.defaults.headers.common[t]=n,e.defaults.headers.common["Content-Type"]="application/json")}return{init:t,initBookAnAppointment:n}}]),app.service("ApiFormValidationService",function(){function e(e,r){var i=r.data;return e.$api||n(e),i?(i.code&&(e.$api.$error[i.code]=!0,a(e)),void angular.forEach(i.fieldErrors,t.bind(null,e))):(e.$api.$error.systemError=!0,void a(e))}function t(e,t){var r,i=t.code,o=t.field;e.$api||n(e),r=e.$api,e[o]&&e[o].$registerApiError?e[o].$registerApiError(i):(r.$error[i]||(r.$error[i]=[]),r.$error[i].push(o),a(e))}function n(e){e.$api={$error:{},$invalid:!1,$valid:!1}}function a(e){e.$api||n(e),e.$api.$invalid=!0,e.$api.$valid=!1}function r(e){e.$api||n(e),e.$api.$invalid=!1,e.$api.$valid=!0}return{applyErrors:e,applyError:t,reset:n,setInvalid:a,setValid:r}}),app.factory("Application",["$q","$log","$document","$window","$location","$rootScope","$route","$templateCache","api","eCare","AuthService2","contractsService","ErrorService","ValueStorage","LocalStorage","OidcService","DataLayerService","ENVIRONMENT",function(e,t,n,a,r,i,o,s,c,l,d,u,g,p,f,m,h,v){function b(){t.debug("onRouteChangeDefaultAuthenticationHandler");var e,n=r.search(),a=r.absUrl();if(e=n.tan?n.tan:n.q?n.q:f.get(p.taninfo),!r.$$path.match(/(vertragsverlaengerung)/i)||r.$$path.match(/(reminder)/i)||e)e&&r.search(""),r.path("/login");else if(t.debug("onRouteChangeDefaultAuthenticationHandler - vertragsverlaengerung"),angular.isDefined(n.utm_campaign)&&n.utm_campaign.indexOf("HVC")>-1||a.indexOf("HVC")>-1)r.path("/login-vvl-retention");else if(angular.isDefined(n.utm_campaign)&&n.utm_campaign.indexOf("Kundenapp VVL")>-1||a.indexOf("Kundenapp%20VVL")>-1)r.path("/login-vvl-app");else{var i=a.replace("#/meine-vertraege/vertragsdetails/vertragsverlaengerung?","&");i=i.split("?"),f.set("mlpRedirect",r.absUrl()),f.rm(p.pckeData),m.createPckeRequest(!1,!1,!0)}}function w(e,n,i,s){t.debug("$on.$routeChangeError",arguments);r.search();if(s&&s.needsAuthentication===!0){if($.cookie("loginRedirect")&&""!==$.cookie("loginRedirect"))var c={redirectUrl:"https://"+location.host+$.cookie("loginRedirect")};else var c={redirectUrl:a.location.href};if(console.log("SET LOGIN DATA",c),f.set(p.loginData,c),r.search().impersonation?(console.log("SET LOGIN DATA",r.search()),f.set(p.redirectUrl,"https://"+location.host+"/onlineservice/dashboard")):-1!==c.redirectUrl.indexOf("online-service")&&-1===c.redirectUrl.indexOf("vertragsverlaengerung")&&($.cookie("loginRedirect")&&""!==$.cookie("loginRedirect")?f.set(p.redirectUrl,"https://"+location.host+$.cookie("loginRedirect")):f.set(p.redirectUrl,a.location.href)),s.needsSoftLogin)return void m.getLoginPromise().then(function(){o.reload()},b);b()}else s&&s.needsRedirect===!0?(t.debug("$on.$routeChangeError -> needsRedirecto to ",s.path),s.path!==r.path()&&(d.isInkasso()?a.location.href="https://"+window.location.host+"/onlineservice/meine-rechnungen":r.path(s.path))):t.debug("$on.$routeChangeError",arguments)}function y(){var e;angular.forEach(jqCustom.Config.breakpoints,function(t,n){(window.matchMedia&&window.matchMedia("(max-width: "+t+"px)").matches||t>$(window).width())&&(e=n)}),i.$apply(function(){i.screenSize=e||"desktop"})}t=t.getInstance("Application");var k=(v.mlp,function(){f.init(),d.status()||(t.debug("AuthService2.status returned false"),-1===r.path().indexOf("login/cct")&&(t.debug("AuthService2.status",r.path()),m.initializeBackgroundLogin()),c.init());try{l.init()}catch(e){t.debug("eCare.init threw ",e)}g.getCodes().then(d.watchIdle),i._=_,y()});$.removeCookie("euconsent-v2");try{var C="utm_medium";(jqCustom&&jqCustom.getURIParameter(C)&&"e-mail"===jqCustom.getURIParameter(C).toLowerCase()||r.search()[C]&&"e-mail"===r.search()[C].toLowerCase())&&$.cookie("hotline","e-mail",{expires:30,path:"/"})}catch(S){t.debug(S)}r.search().fbcrm&&$.cookie("fbcampaign",!0,{path:"/"}),i.$on("$routeChangeStart",function(e,t,n){$(".modal").hasClass("is-visible")&&jqCustom.Modal.hide();try{jqCustom.PushMenu.closePushMenu()}catch(a){}angular.isDefined(n)&&angular.isUndefined(window.preventScopeVars)&&(i.footnotes=[],i.breadcrumb=[]),/Online Service/.test(r.url())&&(i.siteTitle="Online Service")}),i.$on("$routeChangeError",w),i.$on("$viewContentLoaded",function(){try{$("body, html").animate({scrollTop:0},500)}catch(e){}}),i.footnotes=[],i.breadcrumb=null,i.addFootNote=function(e,n){function a(e){var t=0;return angular.forEach(i.footnotes,function(n){angular.isString(n.key)&&-1!==n.key.indexOf(e)&&t++}),t}n=n||"number";var r,o=!1,s=1,c={},l=0;return angular.isString(e)?(angular.forEach(i.footnotes,function(t,n){t.text===e&&(o=t.key,s=n+1),angular.isNumber(t.key)?l=t.key:c[t.key.substr(0,1)]=!0}),o===!1?(r="number"===n?l+1:n in c?Array(a(n)+2).join(n):n,i.footnotes.push({key:r,text:e}),s=i.footnotes.length):r="number"===n?o:n,{key:r,index:s}):(t.debug("addFootNote: adding invalid footnote",e),null)},i.setBreadcrumb=function(e){Array.isArray(e)?(i.breadcrumb=e,i.siteTitle=e[e.length-1].title,$("nav.nav .nav-list > li > a").removeClass("is-current").filter('[href="/online-service/'+e[0].url+'"]').addClass("is-current")):i.siteTitle="Online Service"},i.setActiveContract=function(n,a){return t.debug("rootScope.setActiveContract",n,a),a=!!a,n===d.getContract()?e.reject("Contract is already active."):d.setCurrentContract(n,a)},i.showError=function(e){t.error(e);var n=$('<div class="inner-wrapper is-invalid"><div class="error tooltip"><div class="message">Entschuldigung, dieser Service steht aktuell leider nicht zur Verfügung. Bitte versuchen Sie es später noch einmal.</div></div></div>');$(".view-frame h1:eq(0)").after(n),$("body, html").animate({scrollTop:0},500)},n.on("click",function(e){$(e.target).closest(".header .blue-nav").length||$(e.target).closest(".md-header__top-bar").length||$(e.target).closest(".psnav-block").length||$(e.target).closest(".fancybox-wrap").length||(i.$broadcast("navLayer","close"),i.$digest())}),i.$on("IdleTimeout",function(){t.debug("idle timeout reached"),d.logout("auto")});try{jqCustom.ResizeHandler.addListener(y)}catch(S){}return s.put("loadingAnimation.html",'<div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>'),{init:k}}]),app.factory("CryptService",function(){function e(e,t){var n=a(e,Array.from(t).map(function(e){return e.charCodeAt(0)<128?i(e.charCodeAt(0)):encodeURIComponent(e).replace(/\%/g,"").toLowerCase()}).join(""));return""+o+n+s}function t(e,t){if(!t.startsWith(o)||!t.endsWith(s))throw new Error("not encrypted");return t=t.substring(o.length,t.length-s.length),decodeURIComponent("%"+a(e,t).match(/.{1,2}/g).join("%"))}function n(e,t,n,a){void 0===t&&(t="567dsgdfdftds2343yct54gdfghft"),void 0===n&&(n=8),void 0===a&&(a=256),a=Math.ceil(a/8);for(var i="";i.length<a;){for(var o=0,s=t,c="";n>o;){c=r(e+s);for(var l="",d=0;d<s.length;d++)l+=(s.charCodeAt(d)^c.charCodeAt(Math.floor(d%c.length))).toString(36);s=l,o++}i+=c}return i.substring(0,a)}function a(e,t){return t.match(/.{1,2}/g).map(function(t,n){return i(parseInt(t,16)^e.charCodeAt(Math.floor(n%e.length)))}).join("")}function r(e){for(var t=4641154056,n=0;n<e.length;n++)t=Math.imul(t+e.charCodeAt(n)|0,2654435761);return t=(t^t>>>17)>>>0,t.toString(36)}function i(e){var t=e.toString(16);return t.length<2?"0"+t:t}var o="x",s="y";return{encrypt:e,decrypt:t,passwordDerivedKey:n}}),app.factory("DataLayerService",["$log","$location","$rootScope","$injector","$window",function(e,t,n,a,r){e=e.getInstance("DataLayerService"),n.routeChange=!1;var i,o,s=r.dataLayer,c=["userId","kunde","vvl","vertragsstatus","netz"];o||(o=a.get("AuthService2"));var l=function(t,n){if(e.debug("_handleUserLogin",n),i=n,angular.isFunction(i.getPartyId)){var a={userId:r.md5(i.getPartyId()).substr(0,12)};s.push(a)}},d=function(){e.debug("_handleUserLogout"),i=null;var t={};c.forEach(function(e){t[e]=void 0}),s.push(t)},u=function(e,t){t.isProlongationPossible()&&(t.contractEndDate?s.push({event:"VVL_possible_retention"}):s.push({event:"VVL_possible_prevention"})),"contract:loaded"===e.name&&2===o.getUser().authState?o.getTrackingObject("storage"):o.getTrackingObject("changeContract"),n.contractEndDate=t.contractEndDate,n.contractStartDate=t.contractStartDate,n.netCode=t.netCode},g=function(){e.debug("_handleProlongationFinished",arguments)},p=function(){e.debug("_handleRouteChange",arguments),n.routeChange=!0,o||(o=a.get("AuthService2"));var r=t.url().split("?");if(r[1]&&""!==r[1]&&void 0!==r[1]){""!==window.location.search?"&":"?"}o.isOnlineService()&&o.isLoggedIn()&&-1===window.location.hash.indexOf("vertragsverlaengerung/geraet-waehlen")&&-1===window.location.hash.indexOf("vertragsinhaber-aktivierung")?(s.push({event:"virtual_page_view",virtualPageURL:window.location.pathname+window.location.hash.replace("#/","")+window.location.search}),e.debug("_handleRouteChange:loggedIn",o.isLoggedIn())):o.isOnlineService()&&!o.isLoggedIn()&&(window.location.hash.indexOf("login")>=0||window.location.hash.indexOf("logout")>=0||window.location.hash.indexOf("erstanmeldung")>=0||window.location.hash.indexOf("passwort-vergessen")>=0||window.location.hash.indexOf("passwort-erstellen")>=0||window.location.hash.indexOf("datenvervollstaendigung")>=0||"#/meine-vertraege/vertragsdetails/vertragsverlaengerung"==window.location.hash)&&(s.push({event:"virtual_page_view",virtualPageURL:window.location.pathname+window.location.hash.replace("#/","")+window.location.search}),e.debug("_handleRouteChange:notLoggedIn",o.isLoggedIn()))},f=function(){e.debug("_handleSearchChange",arguments),s.push({event:"VirtualPageViewSearch",virtualPageURL:"suche"+decodeURIComponent(t.url()),virtualPageTitle:"Suche"})};return n.$on("user:login",l),n.$on("user:logout",d),n.$on("contract:loaded",u),n.$on("contract:changed",u),n.$on("prolongation:finished",g),n.$on("$routeChangeSuccess",p),n.$on("search:submit",f),{}}]),app.factory("DateService",function(){function e(e){var t=e.split(".");return(Date.UTC(parseInt(t[2],10),parseInt(t[1],10)-1,parseInt(t[0],10))/1e3).toString()}return{dateToTimestamp:e}}),app.factory("eCare",["$q","$log","$document","$window","$location","$rootScope","api","AuthService2","OidcService",function(e,t,n,a,r,i,o,s,c){t=t.getInstance("eCare");var l=function(){document.addEventListener("oidc:login",d)},d=function(){};return{init:l}}]),app.factory("ErrorService",["$q","$log","$http","$rootScope","LocalStorage","UrlService","ModalService",function(e,t,n,a,r,i,o){"use strict";function s(){var t=e.defer();return(p=r.get("errorCodes"))?(a.errorCodes=p.forms,t.resolve(),t.promise):n.get(i.getUrl("errorCodes")).then(d)["catch"](console.log("load error codes failed"))}function c(e,t){return p&&p[t]&&p[t][e]}function l(e,t){return t=t||"codes",p?c(e,t)?p[t][e]:p["default"]:"Unbekannter Fehler"}function d(e){p=e.data,t.debug("errorcodes from remote:",p),r.set("errorCodes",p,!0),a.errorCodes=p.forms}function u(e){t.debug(e);var n;return n=l(e instanceof Error?"503":angular.isDefinedDeep(e,"data.code")?e.data.code:angular.isDefinedDeep(e,"data.error.code")?e.data.error.code:e.status),{message:n,status:e.status||503}}function g(e,n,a){o.showModal({templateUrl:e,controller:["$scope",function(e){e.error=n,e.data=a}]}).then(function(e){jqCustom.Modal.show(e.element),e.close.then(jqCustom.Modal.hide)},t.error)}var p;return a.getFormError=function(){return t.info(".getFormError is deprecated"),"deprecated"},{hasMessage:c,getMessage:l,getCodes:s,modalError:g,parseResponseError:u}}]),app.factory("LocalStorage",["$log","ValueStorage",function(e,t){var n=function(){function n(){try{s.setItem("isPrivateSurfing","false")}catch(t){e.debug("LocalStorage: Quota exceeded!"),l=!0}}function a(e){for(var t,n={},a=0,i=e?e.length:0;i>a;a+=1)n[e[a]]=r(e[a]);s.clear(),c.clear();for(t in n)n.hasOwnProperty(t)&&o(t,n[t])}function r(t){var n=c.getItem(t);if(n){var a=new Date,r="geheim!"+a.toISOString().substring(0,10);if("userdata"===t){e.debug("start decode for "+t),e.debug("using "+r);var i=CryptoJS.AES.decrypt(n,r);try{JSON.parse(i.toString(CryptoJS.enc.Utf8));return JSON.parse(i.toString(CryptoJS.enc.Utf8))}catch(o){return console.log(o),e.debug("failed decode for "+t),c.removeItem(t),null}return JSON.parse(i.toString(CryptoJS.enc.Utf8))}return e.debug("skip decode for "+t),JSON.parse(n)}return l&&-1<t.indexOf(d)&&"function"==typeof $.cookie&&$.cookie(u+t)?JSON.parse($.cookie(u+t)):null}function i(e,t){t=!0,l&&-1<e.indexOf(d)&&"function"==typeof $.removeCookie?$.removeCookie(u+e,{path:"/"}):c.removeItem(e)}function o(t,n,a){a=!0;var r=JSON.stringify(n);if(l&&-1<t.indexOf(d)&&"function"==typeof $.cookie)return $.cookie(u+t,r,{path:"/"}),null;var i=new Date,o="geheim!"+i.toISOString().substring(0,10);if("userdata"===t){e.debug("start encode for "+t),e.debug("using "+o);var s=CryptoJS.AES.encrypt(r,o);c.setItem(t,s)}else e.debug("skip encode for "+t),c.setItem(t,r)}var s=window.localStorage||localStorage,c=window.sessionStorage||sessionStorage,l=!1,d=[t.userData],u="lsf_";return{flush:a,init:n,get:r,rm:i,set:o}}();return n}]),app.factory("ModelFactory",["$log","$injector","UrlService",function(e,t,n){function a(e,a){var r=t.get(a+"Model"),i=new r({apiPrefix:n.getApiPrefix()});return angular.extend(i,e),angular.isFunction(i.init)&&i.init(),i}function r(e,t){if(Array.isArray(e)){var n=[];return angular.forEach(e,function(e){n.push(a(e,t))}),n}return a(e,t)}return{transform:r}}]),app.factory("RequestService",["$q","$log","$http","$injector","UrlService",function(e,t,n,a,r){function i(e,t,n){var a,i=u(e);return n=n||{},n.params=t||{},angular.isDefined(i.url)&&(a=r.getUrl(i.url,i.params))?p(a,n):g("Invalid GET Request",e,t)}function o(t,n,a){var r=e.defer(),o=function(e){r.resolve(e)},s=i(t,n,_.extend(a,{timeout:r.promise}));return{promise:s,cancel:o}}function s(e,t,a){var i,o=u(e);return angular.isDefined(o.url)&&(i=r.getUrl(o.url,o.params))?n.post(i,t,a):g("Invalid POST Request",e,t)}function c(e,t,a){var i,o=u(e);return angular.isDefined(o.url)&&(i=r.getUrl(o.url,o.params))?n.put(i,t,a):g("Invalid PUT Request",e,t,a)}function l(e,t){var a,i=u(e);return t=_.extend({method:"DELETE",url:null},t),angular.isDefined(i.url)&&(a=r.getUrl(i.url,i.params))?(t.url=a,n(t)):g("Invalid DELETE Request",e,t)}function d(t,n){return angular.isObject(t)&&angular.isObject(n)?(angular.forEach(t,function(e,t){(angular.isFunction(n.notify)||angular.isFunction(n[t+"Notify"]))&&e["finally"](function(){angular.isFunction(n.notify)&&n.notify(t),angular.isFunction(n[t+"Notify"])&&n[t+"Notify"](t)})}),e.allSettled(t).then(function(e){angular.forEach(e,function(e,t){e.resolved===!0?angular.isFunction(n[t+"Success"])?n[t+"Success"](e.value):angular.isFunction(n.then)&&n.then(e.value,t):angular.isFunction(n[t+"Error"])?n[t+"Error"](e.reason):angular.isFunction(n["catch"])&&n["catch"](e.reason,t),angular.isFunction(n[t+"Always"])&&n[t+"Always"](e.value||e.reason)}),angular.isFunction(n.always)&&n.always(e);var t=_.where(e,{resolved:!1}).length;t===_.size(e)&&angular.isFunction(n.fail)&&n.fail(e),0===t&&angular.isFunction(n.done)&&n.done(e)}),!0):!1}function u(e){var t,n;return angular.isString(e)?t=e:Array.isArray(e)?(t=e.shift(),n=e):angular.isObject(e)&&(t=e.url,n=e.params),{url:t,params:n}}function g(){var t=e.defer(),n={data:{code:4711,message:Array.prototype.slice.call(arguments)},status:204};return t.reject(n),t.promise}function p(e,t){var a=f(e,t);return a?a:(a=n.get(e,angular.copy(t)),a.then(function(){m(a)},function(){m(a)}),h.push({url:e,config:t,request:a}),a)}function f(e,t){var n=!1;return angular.forEach(h,function(a){a.url===e&&_.isEqual(a.config,t)&&(n=a.request)}),n}function m(e){return angular.forEach(h,function(t,n){t.request===e&&h.splice(n,1)}),!0}var h=[];return{get:i,getCancellable:o,post:s,put:c,del:l,handlePromises:d,getRejectedPromise:g}}]),app.factory("TeaserEngine",["$log","$compile","contractsService","RequestService",function(e,t,n,a){function r(e,t){var n=b+e+"&"+$.param(t);window.loadJS(n,function(){$.each(t,function(e){var t=v[e];$(h[e])[t]()})})}function i(e,t){var n=b+t.page+"&clips="+t.amount;f("showClips",n,e,t)}function o(e,t){var n=b+t.page+"&bar="+t.amount;f("showBar",n,e,t)}function s(e,t,n){var a=t.start?parseInt(t.amount,10)+(parseInt(t.start,10)-1):t.amount,r=b+t.page+"&boxes="+a;f("showBoxes",r,e,t,n)}function c(e,t,n){var a=b+t.page+"&menuboxes="+t.amount;f("showMenuBoxes",a,e,t,n)}function l(e,t){var n=b+t.page+"&hp-intros="+t.amount;f("showHpIntros",n,e,t)}function d(e,t){var n=b+t.page+"&lp-intros="+t.amount;f("showLpIntros",n,e,t)}function u(e,t){var n=b+t.page+"&intros="+t.amount;f("showIntros",n,e,t)}function g(e,t){var n=b+t.page+"&powerlayer=1";f("showPowerlayer",n,e,t)}function p(e,t){var n=b+t.page+"&shopclips="+t.amount;f("showShopClips",n,e,t)}function f(e,a,r,i,o){n.getDetails()["finally"](function(){window.loadJS(a,function(){if(r[e]){r[e](),r.html(t(r.html())(i));try{jqCustom.polyFill.init()}catch(n){}}"function"==typeof o&&o.call()})})}function m(e){return a.get("teaserTransaction",{transaction:e})}var h={intros:"#intro-container",clips:".teaser-container.teaser-clips"},v={intros:"showIntros",clips:"showClips"},b="/ext/teaser/engine.js.php?page=";return{loadTeasers:r,loadClips:i,loadBar:o,loadBoxes:s,loadMenuBoxes:c,loadHpIntros:l,loadLpIntros:d,loadIntros:u,loadPowerlayer:g,loadShopClips:p,trackTransaction:m}}]),app.factory("UrlService",["$injector","$log","$location","$rootScope","LocalStorage","ValueStorage","ENVIRONMENT",function(e,t,n,a,r,i,o){function s(n,a){var r=p[n]||null;return u||(u=e.get("AuthService2")),r?c(r,a):0===n.indexOf("/")||0===n.indexOf("http")?n:(t.debug("no url found for key:",n),null)}function c(e,n){for(var a,r=/%%([^%]*)%%/gi,i=0,o=r.exec(e);null!==o;)angular.isDefined(n)?angular.isString(n)?e=e.replace(o[0],n):Array.isArray(n)?e=e.replace(o[0],n[i]):angular.isObject(n)&&(angular.isDefined(n[o[1]])?e=e.replace(o[0],n[o[1]]):t.debug("UrlService: No replacement defined for key ",o[1])):(a=l(o[1]),angular.isString(a)&&(e=e.replace(o[0],a))),o=r.exec(e),i++;return g&&-1===window.location.href.indexOf("databox.kochan.de")&&(e=e.replace("/api","/mock-api")),r.test(e)?(t.debug("Request for URL caused a problem. Computed url is ",e),!1):e}function l(e){var t=n.search(),a=t.q?atob(t.q).split(":"):[],s=t.contract?atob(t.contract):a[2],c=s?s:r.get(i.taninfo)?atob(r.get(i.taninfo)):"";switch(e){case"contractId":case"contract":return!u.isLoggedIn()&&c&&""!==c?c:u.getContract();case"contracts":return u.getContracts().toString();case"partyid":case"party":return u.getPartyId().toString();case"API":return o.apiUrl;case"EMAIL":return u.getUser().username;default:return!1}}function d(){return g?"/mock-api":"/api"}console.log("UrlService"),a.iab_purposes=!1,$.cookie("iab_purposes")&&(a.iab_purposes=!0);var u,g=!1,p={errorCodes:"/config/error-codes.php",loginSSO:"/api/ps/external/login",login:"/api/ps/auth/login",loginCc:"/api/ps/auth/mcis/validation",logout:"/api/ps/auth/logout",contracts:"/api/ps/customers/%%partyid%%/contracts",getRoleOptions:"/api/ps/identifications/%%identifier%%/roles",addContract:"/api/ps/identifications/%%identifier%%/options",identifyBySMS:"/api/ps/identifications/%%identifier%%/sms",identifyByEmail:"/api/ps/identifications/%%identifier%%/email",identifyByLetter:"/api/ps/identifications/%%identifier%%/letter",newUserConfirm:"/api/ps/identifications/%%identifier%%/confirmation",newConfirmation:"%%API%%/v2/user/identifications/%%identifier%%/confirmation",addProspect:"/api/ps/customers",bankAccount:"/api/ps/contracts/%%contract%%/bank-account",checkIban:"/api/ps/validations/ibans/%%iban%%",checkTowns:"/api/ps/validations/addresses/possibletownnames",checkStreets:"/api/ps/validations/addresses/possiblestreetnames",getIban:"/api/ps/ibans?bankCode=%%code%%&accountNumber=%%number%%",setInvoiceAddress:"/api/ps/contracts/%%contract%%/invoice-address",costCheck:"/api/ps/contracts/%%contract%%/usages/summary?format=short",deviceDetails:"/pdb/devices?deviceIds=%%deviceId%%",getESimStatus:"/api/ps2/contracts/%%contract%%/detailed-sims-orders",getESimDetails:"/api/ps2/contracts/%%contract%%/esims/%%iccid%%/details",getESimQR:"/api/ps2/contracts/%%contract%%/esims/%%iccid%%/activation-qr-code?size=%%size%%",requestESimTan:"/api/ps2/contracts/%%contract%%/esim-orders/%%iccid%%/tan/initial",postESimTan:"/api/ps2/contracts/%%contract%%/sims-orders/%%taskid%%?status=active",getESimTanTimeout:"/api/ps2/contracts/%%contract%%/esim-orders/%%orderId%%/tan/sms",getESimTanStatus:"/api/ps2/contracts/%%contract%%/esim-orders/%%orderId%%/tan/information",sendESimTanTimeout:"/api/ps2/contracts/%%contract%%/esim-orders/%%orderId%%/tan/missing",getESimRoles:"/api/ps2/contracts/%%contract%%/esim-orders/%%orderId%%/tan/information",getSimProfiles:"/api/ps2/contracts/%%contract%%/sims",getSimsOrders:"/api/ps2/contracts/%%contract%%/sims-orders",getSimsTask:"/api/ps2/contracts/%%contract%%/sims-orders/%%taskid%%",simLock:"/api/ps/contracts/%%contract%%/barring",getMultiSim:"/api/ps/contracts/%%contract%%/multi-sims",targetNet:"/api/ps/networks?msisdn=%%msisdn%%",billNotification:"/api/ps/contracts/%%contract%%/invoice-notification",billExplanation:"/api/ps/contracts/%%contract%%/invoices/%%invoice%%/details",bills:"/api/ps/contracts/%%contract%%/invoices?invoiceStartDate=&invoiceEndDate=&monthsIntervall=40",downloadCollection:"/api/ps/documents/zipped",contractOverview:"/api/ps/contracts/%%contract%%/details",contractDetails:"/api/ps/contracts/%%contractId%%/details?withoutContractSelection=true",contractSwitch:"/api/ps/contracts/%%contractId%%/details",transparencyRegulation:"/api/ps/contracts/%%contractId%%/tvoinformations",dsp:"/api/ps/contracts/%%contract%%/codeword",invoiceAddress:"/api/ps/contracts/%%contract%%/invoice-address",partnerTariffs:"/api/ps/contracts/%%contract%%/partner-tariffs",partnerCard:"/api/ps/contracts/%%contract%%/partnercard-order",pinpuk:"/api/ps/contracts/%%contract%%/pinpuk",pinpukPrice:"/api/ps/contracts/%%contract%%/pinpuk/price",costCheckOverview:"/api/ps/contracts/%%contract%%/usages/summary?format=long",costCheckEVN:"/api/ps/contracts/%%contract%%/usages/details",register:"%%API%%/v2/user/register",verify:"%%API%%/v2/user/activate",otpLogin:"/api/ps2/auth/otplogin",vvlGetDetails:"/api/ps/contracts/%%contract%%/prolongation/details",vvlGetReminder:"/api/ps/contracts/%%contract%%/prolongation/reminder",vvlPutReminder:"/api/ps/contracts/%%contract%%/prolongation/reminder",vvlInfo:"/api/ps2/prolongation/info",vvlPostProlongation:"/api/ps/contracts/%%contract%%/prolongation",vvlGetBonus:"/api/ps/contracts/%%contract%%/prolongation/online-bonus",vvlOnlineBonus:"/api/ps2/contracts/%%contract%%/online-bonus",vvlGetTariffs:"/api/ps/contracts/%%contract%%/prolongation/tariffs",vvlGetTariffsSimOnly:"/api/ps/contracts/%%contract%%/prolongation/tariffs?filter=SIMONLY",vvlGetTariffDetails:"/api/ps/contracts/%%contract%%/prolongation/tariffdetails",vvlGetDevices:"/api/ps/contracts/%%contract%%/prolongation/devices",vvlGetSummary:"/api/ps/contracts/%%contract%%/prolongation/summary?prolongationRef=%%ref%%",vvlGetOptions:"/api/ps/contracts/%%contract%%/prolongation/options?prolongationRef=%%ref%%",vvlDeeplink:"/api/ps/contracts/%%contract%%/prolongation/devices/%%device%%/references",vvlTopSeller:"/ext/shop/topseller.php",devices:"/pdb/devices",vendors:"/pdb/vendors",tariffs:"/pdb/tariffs",accountDelete:"%%API%%/v2/user/users/%%EMAIL%%",setUsername:"/api/ps/user/name",password:"/api/ps/user/password",resetPassword:"%%API%%/v2/user/resetPassword",passwordSetEmail:"/api/ps/user/password/reset/email",passwordSetSms:"/api/ps/user/password/reset/sms",contactFileUpload:"/api/ps2/forms/upload",customerService:"/api/ps2/forms/customer-service",contact:"/api/ps/callbacks/%%dptmt%%",agbVerification:"/api/ps/verifications/agb",contactInfo:"/ajax/contact.php",callbackService:"/api/ps/forms/callback",preSearchSuggest:"/ajax/search/auto_suggest.php",searchAutocomplete:"/ajax/search/autocomplete.php",searchSuggest:"/ajax/search/suggester.php",searchResults:"/ajax/search/result.php",
getOptions:"/api/ps/contracts/%%contract%%/options",getOptionsSummary:"/api/ps/contracts/%%contract%%/options/order-summary",getTariffs:"/api/ps/contracts/%%contract%%/tariffs",getPreContractualInformation:"/api/ps/contracts/%%contract%%/tariffs/%%tariffid%%/pre-contractual-information",newsletter:"/ajax/newsletter.php",gameRegister:"/ajax/kampagnen/game-register.php",gameResult:"/ajax/kampagnen/game-result.php",emailVerification:"/api/ps/verifications/emails",msisdnVerification:"/api/ps/verifications/msisdns/%%msisdn%%",properties:"/api/ps/contracts/%%contract%%/properties",dataTariffAdvisor:"/ajax/datentarifberater.php",invoiceEmail:"/api/ps/contracts/%%contract%%/invoice-notification",dTNetsByPlanGroup:"/dp/plan-group/%%planGroup%%/nets",dTNets:"/pdb/nets",dTPlanGroups:"/dp/plan-group",dTDevices:"/dp/devices",dTPlanGroupsByDevice:"/dp/devices/%%device%%/plan-groups",dTDevicesByPlanGroup:"/dp/plan-group/%%planGroup%%/devices",dTBundles:"/dp/plan-group/5/devices/%%deviceId%%/bundles",getPrepaidCharge:"/api/ps/contracts/%%contract%%/charge/%%chargingType%%",setPrepaidCharge:"/api/ps/contracts/%%contract%%/charge",insurances:"/api/ps/products/insurances",insuranceOrder:"/api/ps/contracts/%%contract%%/insurance-order",mnpInfo:"/api/ps/contracts/%%contract%%/mnp/info",chatClient:"/iframes/chatclient/start.html",chatStatus:"/customer/chat/status/%%type%%",chatSubjects:"/customer/chat/subjects/%%type%%",chatStart:"/cim/customer/chats",chatStartAuth:"/api/ps/auth/chat/v2",postMessages:"/cim/customer/chats/%%chatId%%",getMessages:"/cim/customer/chats/%%chatId%%/messages",chatKza:"/cim/customer/chats/kza",teaserTransaction:"/ext/teaser/tracking.gif.php",minicart:"/shop/cart/minicart/rollover",getThemes:"/cim/appointments/reasons",getShops:"%%API%%/v1/retail/salesPartners/%%dealer%%?filter=APPOINTMENT,shop&expand=all&limit=1000",getDates:"/cim/appointments/slots/dealers/%%dealer%%",getTimes:"/cim/appointments/slots/dealers/%%dealer%%/date/%%date%%?reason=%%reason%%",bookAppointment:"/cim/appointments/slots/book",getPrepaidBalance:"/api/ps/contracts/%%prepaidContract%%/prepaidBalance",mlpIframeUrl:"@mlpIframeUrl",getCustomerData:"/api/ps/contracts/%%contract%%/teaser",getTrackingObject:"%%API%%/v1/customer/trackings?contractNo=%%contract%%"};return{getUrl:s,getApiPrefix:d}}]),angular.module("md").filter("unique",function(){return function(e,t){if(t===!1)return e;if((t||angular.isUndefined(t))&&Array.isArray(e)){var n=[],a=function(e){return angular.isObject(e)&&angular.isString(t)?e[t]:e};angular.forEach(e,function(e){for(var t=!1,r=0;r<n.length;r++)if(angular.equals(a(n[r]),a(e))){t=!0;break}t||n.push(e)}),e=n}return e}}),angular.module("md").filter("price",function(){return function(e){var t=splitPrice(e/100);return e=t.euro+","+t.cent}}),angular.module("md").filter("net2provider",function(){return function(e){switch(e){case"d1":return"Telekom";case"d2":return"Vodafone";case"e-plus":return"E-Plus";case"o2":return"o2";default:return"unknown"}}}),angular.module("md").filter("tariffnetimage",function(){return function(e,t){if(!e||angular.isUndefined(e.network)&&angular.isUndefined(e.netCode))return"";var n="",a="",r=e.network||e.netCode;switch(e.info&&angular.isDefined(e.info.isSimOnly)&&e.info.isSimOnly===!1&&(a="_plushandy"),r){case"D1":n="telekom";break;case"D2":n="vodafone";break;case"O2":case"o2":n="o2";break;case"E+":case"EP":n="eplus"}return"big"===t?"/img/tarife/sim_links_"+n+".png":"/img/tarife/144_tarif_"+n+a+".png"}}),angular.module("md").filter("encodeURI",function(){return window.encodeURIComponent}),angular.module("md").filter("truncate",function(){return function(e,t,n){return angular.isString(e)?(isNaN(t)&&(t=10),void 0===n&&(n="…"),e.length<=t||e.length-n.length<=t?e:String(e).substring(0,t-n.length)+n):void 0}}),angular.module("md").filter("orderObjectBy",function(){return function(e,t,n){if(!angular.isObject(e))return e;var a=_.sortBy(e,function(e){return-1===t.indexOf(".")?e[t]:angular.getDeep(e,t)});return n?_.reverse(a):a}}),angular.module("md").filter("toArray",function(){return function(e){var t=[];return angular.forEach(e,function(e){t.push(e)}),t}}),app.filter("nl2br",["$sce",function(e){return function(t){return t?e.trustAsHtml(t.replace(/\n/g,"<br>")):""}}]),app.filter("txt2html",["$sce",function(e){return function(t,n,a){return a=t.match(new RegExp(n,"gi")),a=null!==a?a[0]:"",t?e.trustAsHtml(t.replace(a,"<em>"+a+"</em>")):""}}]),app.filter("contractType",function(){return function(e){switch(e){case"TELCO":return"Mobilfunk";case"DOMCLOUD":return"Cloud";case"SICHERHEIT":return"SmartHome Sicherheit";case"HEIZUNG":return"SmartHome Heizung";case"KAMERA":return"SmartHome Kamera";case"DOM":return"Entertainment-Option";default:return"-"}}}),app.filter("urlify",function(){return function(e){if(e){e=e.toLowerCase().replace(/\s+/g,"-");for(var t="ãàáäâẽèéëêìíïîõòóöôùúüûñç·/_,:;",n="aaaaaeeeeeiiiiooooouuuunc------",a=0,r=t.length;r>a;a++)e=e.replace(new RegExp(t.charAt(a),"g"),n.charAt(a));return e.replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}}}),app.filter("bandwidth",function(){return function(e){var t=parseInt(e,10);return 1024>t?e+" MB":t>=1024?e/1024+" GB":e}}),app.filter("euro",["$filter",function(e){return function(t,n,a){if(!t)return"";var r=t%1>0,i=e("number")(t,r||a?2:0);return"-"===n?i="€ "+i:"+"===n&&(i+=" €"),i}}]),function(){var e=function(e){this.tariffPaymentType="",this.brandName="",this.links={},this.options=e};e.prototype={isTelco:function(){return"TELCO"===this.contractType},isSmartHome:function(){switch(this.contractType){case"HEIZUNG":case"KAMERA":case"SICHERHEIT":case"DOMCLOUD":return!0;default:return!1}},isDom:function(){switch(this.contractType){case"HEIZUNG":case"KAMERA":case"SICHERHEIT":case"DOM":case"DOMCLOUD":return!0;default:return!1}},isPrepaid:function(){return this.isTelco()&&/debit|prepaid/i.test(this.tariffPaymentType)},isCredit:function(){return this.isTelco()&&"CREDIT"===this.tariffPaymentType},isTalkline:function(){return"TALKLINE"===this.brandName},isProlongationPossible:function(){if(angular.isDefined(this.links)){if(angular.isDefined(this.links.retentionDevices))return!0;if(angular.isDefined(this.links.retentionTariffs))return!0}return!1},isReminderPossible:function(){return angular.isDefinedDeep(this,"links.prolongationReminder")},hasPermission:function(e){return this.links&&this.links[e]},getPermission:function(e,t){var n;return this.hasPermission(e)?n=this.options.apiPrefix+this.links[e]:t&&(n=this.getPermission(t)),n},getCustomerNo:function(){var e="";return this.customerId&&(e=this.customerId.split(".")[1]),e},getBrand:function(){var e="";return this.contractId&&(e=this.contractId.split(".")[0]),e},getContractNo:function(){var e="";return this.contractId&&(e=this.contractId.split(".")[1]),e},getLink:function(e){var t;return this.links&&this.links[e]&&(t=this.options.apiPrefix+this.links[e]),t}},app.value("ContractModel",e)}(),function(){var e=function(e){this.links={},this._options=e};e.prototype={getLink:function(e){var t;return this.links&&this.links[e]&&(t=this._options.apiPrefix+this.links[e]),t}},app.value("CustomerModel",e)}(),function(){var e=function(){this.sapId=-1};e.prototype={isCashCredit:function(){return!1},isSimOnly:function(){return!1},getPrice:function(){return this.isCashCredit()?this.prices.cashCreditPrice:this.prices.devicePrice}},app.value("DeviceModel",e)}(),function(){var e=function(e){this.authState=this.ANONYMOUS,this.activeContract=!1,this.contracts=!1,this.allowedActions={},this.utmData={},this._options=e};e.prototype={ANONYMOUS:0,IDENTIFIED:1,SOFTLOGIN:1.5,AUTHENTICATED:2,init:function(){_.has(this.contracts,"no contract")&&(this.allowedActions=this.contracts["no contract"].allowedActions,this.contracts={}),this.setActiveContract(this.getContract())},getPartyId:function(){return Array.isArray(this.partyIds)?this.partyIds[0]:""},getContract:function(){return angular.isString(this.activeContract)&&angular.isDefined(this.contracts[this.activeContract])?this.activeContract:angular.isDefined(this.defaultContracts)&&angular.isDefined(this.defaultContracts.TELCO)&&""!==this.defaultContracts.TELCO?this.defaultContracts.TELCO:angular.isObject(this.contracts)&&Object.keys(this.contracts).length?Object.keys(this.contracts)[0]:!1},getContracts:function(){return this.getContractIds()},getContractIds:function(){var e=[];return angular.forEach(this.contracts,function(t,n){e.push(n)}),e},getMandant:function(){return this.activeContract?this.activeContract.split(/\./)[0]:""},setActiveContract:function(e){if(this.activeContract=e,e&&_.has(this.contracts,e)){var t=this.contracts[e];this.allowedActions=t.allowedActions,angular.isObject(this.defaultContracts)&&t.contractType&&this.defaultContracts[t.contractType]&&(this.defaultContracts[t.contractType]=e)}},isLoggedIn:function(){return this.authState===this.AUTHENTICATED},isIdentified:function(){return this.authState===this.IDENTIFIED},isSoftLoggedIn:function(){return this.authState===this.SOFTLOGIN},isAnonymous:function(){return this.authState===this.ANONYMOUS},isAdmin:function(){return angular.isObject(this.contracts)&&angular.isObject(this.contracts[this.activeContract])&&angular.isDefined(this.contracts[this.activeContract].isAdmin)?this.contracts[this.activeContract].isAdmin:!1},isProspect:function(){return!this.contracts||!_.size(this.contracts)||this.contracts["no contract"]},hasContracts:function(){return!this.isProspect()},hasTelcoContract:function(){var e=!1;return angular.forEach(this.contracts,function(t){"TELCO"===t.contractType&&(e=!0)}),e},hasPermission:function(e){return this.allowedActions&&this.allowedActions[e]},getAllowedAction:function(e,t){var n;return this.hasPermission(e)?n=this._options.apiPrefix+this.allowedActions[e]:t&&(n=this.getAllowedAction(t)),n},getContractLink:function(e,t){var n;return this.contracts&&this.contracts[e]&&this.contracts[e].allowedActions&&this.contracts[e].allowedActions[t]&&(n=this._options.apiPrefix+this.contracts[e].allowedActions[t]),n},getCustomerLink:function(e){var t;return this.customer&&this.customer.links&&this.customer.links[e]&&(t=this._options.apiPrefix+this.customer.links[e]),t},getPagination:function(){return this.pagination}},app.value("UserModel",e)}(),app.run(["Application",function(e){e.init()}]);var date=new Date,m=date.getMonth()+1,y=date.getFullYear(),price=m>=7&&2020==y?4.83:4.95;app.value("valShippingCost",price).value("valSalutations",["-","Herr","Frau","Firma","Familie","Frau und Herr","mobilcom Shop","Autohaus"]).value("ValueStorage",{chatCounter:"chat.counter",chatUsers:"chat.users",chatId:"chat.id",chatOptions:"chat.options",chatSession:"chat.session",chatStatus:"chat.status",chatSubjects:"chat.subjects",userData:"userdata",loginData:"logindata",redirectUrl:"redirectUrl",pckeData:"pckedata",oidcData:"oidcdata",bookingData:"bookingdata",confirmation:"confirmation",prolongationInfo:"prolongationInfo",hasReminder:"hasReminder",mopapiStatus:"mopapiStatus",taninfo:"taninfo"}).value("Events",{changeBookingData:"booking.change",chatStatus:"chat.status",userHasChange:"user.haschanged"}),angular.module("md").controller("appleCtrl",["$scope","$http","$log","$window","$timeout","AppleService","AuthService2",function(e,t,n,a,r,i,o){var s,c,l,d,u=this,g=[];u.isLoading=!0,u.deviceGroup=null,u.deviceError=!1,u.selectedDevice=null,u.selectedDeviceGroup=null,u.selectedColor=null,u.selectedMemory=null,u.withTariff=!1,u.selectedNet="all",u.nets={d1:{name:"Telekom",available:!1},d2:{name:"Vodafone",available:!1},o2:{name:"o2",available:!1},tf:{name:"Telefonica",available:!1},"e-plus":{name:"eplus",available:!1}},u.volumes={1:{available:!1},2:{available:!1},"-2":{available:!1},3:{available:!1},"4+":{available:!1},"5+":{available:!1},6:{available:!1},"2-4":{available:!1},"2-6":{available:!1},"10+":{available:!1}},u.selectedVolume="all",u.selectedBundle=null,u.selectedBundleId=null,u.bundles=[],u.hasBundles=!1,u.cheapestDevicePrice=null,u.isMultiDeviceView=!1,u.selectedTariffGroup=!1;var p=function(e){if(n.debug("received data",e),angular.isObject(e)){var t=Object.keys(e);c=e,u.isMultiDeviceView=t.length>1,u.selectedDeviceGroup=t[0],u.deviceGroup=e[u.selectedDeviceGroup],u.isMultiDeviceView&&(u.deviceGroupList=[],t.forEach(function(e){u.deviceGroupList.push(e)})),v(),P(),A(),z(),q(),f("withTariff")&&u.showTariffs(!0)}else u.deviceError=!0;u.isLoading=!1};i.get(a.sapIds).then(p,n.error),u.selectDeviceGroup=function(e){L(!0),angular.isDefined(c)&&c[e]&&(u.selectedDeviceGroup=e,u.deviceGroup=c[u.selectedDeviceGroup],v(),w()?A():n.debug("Combination of color and memory does not exist"),m())},u.switchColor=function(e){L(!0),l="color",u.selectedColor=e,w()?D():n.debug("Combination of color and memory does not exist"),_(),O(),N(),m()},u.switchMemory=function(e){L(!0),l="memory",angular.isDefined(u.memories[e])&&(u.selectedMemory=e,w()?D():n.debug("Combination of color and memory does not exist"),_()),m()},u.selectVolume=function(e){L(!0),u.selectedVolume=e,u.selectedNet===!1&&u.selectNet("all"),H(a.matchMedia&&a.matchMedia("(max-width: "+jqCustom.Config.breakpoints.phone+"px)").matches||$(window).width()<=jqCustom.Config.breakpoints.phone?$(".tariff-select-list"):$("#apple-tariff-filters")),T()},u.selectNet=function(e){L(!0),u.selectedNet=e,null===u.selectedVolume?u.selectVolume("all"):T(),Array.isArray(u.bundles)&&0===u.bundles.length&&angular.forEach(u.volumes,function(e,t){e.available===!0&&u.selectVolume(t)})},u.selectBundle=function(e){u.selectedBundle=e,u.selectedBundleId=e.bundle_id,d=e.tarif_id},u.showTariffs=function(e,t){angular.isUndefined(t)&&(t=!0),e?(u.withTariff=!0,r(function(){a.matchMedia&&a.matchMedia("(max-width: "+jqCustom.Config.breakpoints.phone+"px)").matches||$(window).width()<=jqCustom.Config.breakpoints.phone?t&&H($("#apple-tariff-filters")):t&&H($("#apple-with-tariff"))},10)):(L(),u.withTariff=!1)},u.addToCompare=function(e){-1===g.indexOf(e)?g.push(e):g.splice(g.indexOf(e),1)},u.getCompareLink=function(e){return"/iframes/tarif/vergleich.php?tariff_comparison[]="+e+"&tariff_comparison[]="+g[0]+"&iphone="+u.deviceGroup.name},u.showCompareCheckBox=function(e){return g.length?0===g.indexOf(e):!0},u.showSticky=function(){return u.withTariff===!1&&u.selectedDevicePrice<0?!1:!0},u.getBundleOrderLink=function(){if(u.selectedBundle){var e=u.selectedBundle.orderLink,t=u.selectedBundle.tariff.doubleBandWidthOption;if(u.selectedBundle.tariff.additionalOptions||t){var n="",r=encodeURIComponent(a.location.origin+a.location.pathname);angular.forEach(u.selectedBundle.tariff.additionalOptions,function(e){n+=","+e+"::"+r}),t&&(n+=",P-"+t+"::"+r),e=e.replace(")",n+")")}return e}return""},u.getCartButtonText=function(){if(u.selectedDevice){var e=a.sapIds[u.selectedDevice];if(e.presale)return"Jetzt vorbestellen"}return"In den Warenkorb"};var f=function(e){var t=a.sapIds[u.selectedDevice];return t[e]?t[e]:!1},m=function(){n.debug("_fixFancyBox"),r(function(){$(".fancybox-img").fancybox({type:"image",nextEffect:"fade"})})},h=function(){n.debug("checkUrlParams");var e=a.jqCustom.getURIParameter("tariff"),t=a.jqCustom.getURIParameter("color"),i=a.jqCustom.getURIParameter("memory"),o=a.jqCustom.getURIParameter("bundle");o?r(function(){u.showTariffs(!0,!1),u.selectNet("all")}):e&&t&&i&&(t="#"+t,angular.isDefined(u.colors[t])?(u.selectedColor=t,angular.isDefined(u.memories[i])&&u.memories[i].available===!0?(u.selectedMemory=i,w()?u.hasBundles===!0?r(function(){u.showTariffs(!0),u.selectNet("all"),angular.forEach(u.bundles,function(t){t.tarif_id===parseInt(e,10)&&u.selectBundle(t)})}):n.debug("checkUrlParams: no bundles"):n.debug("cannot find variant for combination of color & memory")):n.debug("urlParameter memory "+i+" is invalid")):n.debug("urlParameter color "+t+" is invalid"))},v=function(){var e=i.parse(u.deviceGroup);u.colors=e.colors,u.memories=e.memories,b()},b=function(){if(a.defaultVariant&&(u.deviceGroup.defaultVariant=a.defaultVariant),!angular.isDefined(u.deviceGroup.variants[u.deviceGroup.defaultVariant])){n.debug("defaultVariant does not exist");var e;angular.forEach(u.deviceGroup.variants,function(t){(!e||+t.device_price<e)&&"sofort lieferbar"===t.delivery_time&&(e=+t.device_price)});var t=!1;angular.forEach(u.deviceGroup.variants,function(n,a){t||+n.device_price!==e||"sofort lieferbar"!==n.delivery_time||(u.deviceGroup.defaultVariant=a,t=!0)}),t||(angular.forEach(u.deviceGroup.variants,function(n,a){t||+n.device_price!==e||"sofort lieferbar"===n.delivery_time||(u.deviceGroup.defaultVariant=a,t=!0)}),t||(u.deviceGroup.defaultVariant=Object.keys(u.deviceGroup.variants)[0]))}u.selectedDevice=u.deviceGroup.defaultVariant,u.selectedColor=u.deviceGroup.variants[u.deviceGroup.defaultVariant].color,u.selectedMemory=u.deviceGroup.variants[u.deviceGroup.defaultVariant].memory;var r=a.sapIds[u.selectedDevice];r.video?u.deviceVideo=r.video:u.deviceVideo=!1,r.vvlid?u.deviceProlongationId=r.vvlid:u.deviceProlongationId=!1,s&&D(),C(),_(),O(),N()},w=function(){var e=!1;if(angular.forEach(u.deviceGroup.variants,function(t,n){t.memory===u.selectedMemory&&t.color===u.selectedColor&&(e=!0,y(t,n))}),!e){if(n.debug("Not found any matching device, trying to switch"),"color"===l){var t=k(u.selectedColor);t&&(e=!0,u.selectedMemory=t.variant.memory,y(t.variant,t.key))}else"memory"===l&&angular.forEach(u.deviceGroup.variants,function(t,a){a===u.selectedDevice||t.memory!==u.selectedMemory||e||(n.debug("changing to different color"),e=!0,u.selectedColor=t.color,y(t,a))});e||n.debug("Could not find any device for given selection")}return e},y=function(e,t){u.selectedDevice=t,u.selectedDevicePrice=e.device_price,u.selectedDeviceUvpPrice=e.device_uvp||!1,u.selectedDeviceLink="/shop/cart/add/?qty=1&bundleNo=0&productCodePost=P-"+u.selectedDevice,u.withTariff!==!0||u.hasBundles||(u.withTariff=!1);var n=a.sapIds[u.selectedDevice];n.video?u.deviceVideo=n.video:u.deviceVideo=!1,n.vvlid?u.deviceProlongationId=n.vvlid:u.deviceProlongationId=!1,P(),C()},k=function(e){var t={},n={},a=parseInt(u.selectedMemory,10);angular.forEach(u.deviceGroup.variants,function(t,a){a!==u.selectedDevice&&t.color===e&&(t.memorySize=parseInt(t.memory,10),n[a]=t)});var r=Object.keys(n).sort(function(e,t){return n[e].memorySize-n[t].memorySize}),i=!1;return angular.forEach(r,function(e){n[e].memorySize>=a&&!i&&(i=!0,t.key=e,t.variant=n[e])}),i||(t.key=Object.keys(n)[0],t.variant=n[t.key]),t},C=function(){if(angular.isObject(window.sapIds)&&window.sapIds[u.selectedDevice]){var e=window.sapIds[u.selectedDevice];e.availability&&(u.selectedDeviceAvailability=e.availability),e.tariffgroup?u.selectedTariffGroup=e.tariffgroup:u.selectedTariffGroup=!1}},S=function(){var e=parseInt(a.defaultBundle,10);angular.forEach(u.bundles,function(t){t.tariff.mcbs_tpl===e&&(u.withTariff=!0,u.selectBundle(t),r(function(){$(window).scroll()}))})},A=function(){u.isLoadingBundles=!0,u.cheapestDevicePrice=null,i.getBundles(u.selectedDevice).then(M,I)["finally"](function(){u.isLoadingBundles=!1})},M=function(e){s=e,n.debug("bundleData",s),h(),D(),E(),v(),x(),S()},I=function(e){n.debug("_handleBundleError",e)},L=function(e){d=e&&u.selectedBundle?u.selectedBundle.tarif_id:null,u.selectedBundle=null,u.selectedBundleId=null},T=function(){var e=[],t=!1;s&&s.bundles&&angular.forEach(s.bundles,function(n,a){angular.forEach(n,function(e){Number(u.selectedDevice)===e.device_id&&(t=!0)}),("all"===u.selectedNet||u.selectedNet===a)&&angular.forEach(n,function(t){("all"===u.selectedVolume||null===u.selectedVolume||1===u.selectedVolume&&t.tariff.datenvolumen<=1e3||"4+"!==u.selectedVolume&&"5+"!==u.selectedVolume&&"10+"!==u.selectedVolume&&"2-4"!==u.selectedVolume&&"2-6"!==u.selectedVolume&&"-2"!==u.selectedVolume&&1e3*u.selectedVolume===t.tariff.datenvolumen||"-2"===u.selectedVolume&&t.tariff.datenvolumen<=2e3||"2-4"===u.selectedVolume&&t.tariff.datenvolumen>2e3&&t.tariff.datenvolumen<=4e3||"2-6"===u.selectedVolume&&t.tariff.datenvolumen>2e3&&t.tariff.datenvolumen<=6e3||"4+"===u.selectedVolume&&t.tariff.datenvolumen>=4e3||"5+"===u.selectedVolume&&t.tariff.datenvolumen>=5e3||"10+"===u.selectedVolume&&t.tariff.datenvolumen>=1e4)&&Number(u.selectedDevice)===t.device_id&&(0===g.indexOf(t.id)&&(t.comparison=!0),e.push(t))})}),R(),u.hasBundles=t,u.bundles=i.sortBundles(e),j(),U()},D=function(){var e=!1;angular.forEach(u.volumes,function(e){e.available=!1}),angular.forEach(u.nets,function(e){e.available=!1}),s&&s.bundles&&angular.forEach(s.bundles,function(t,n){angular.forEach(t,function(t){Number(u.selectedDevice)===t.device_id&&(e=!0,t.tariff.datenvolumen<=1e3?u.volumes[1].available=!0:t.tariff.datenvolumen<2001?(u.volumes[-2].available=!0,2e3===t.tariff.datenvolumen&&(u.volumes[2].available=!0)):3e3===t.tariff.datenvolumen?u.volumes[3].available=!0:6e3===t.tariff.datenvolumen?u.volumes[6].available=!0:t.tariff.datenvolumen>=2001&&t.tariff.datenvolumen<=4e3?u.volumes["2-4"].available=!0:t.tariff.datenvolumen>=2001&&t.tariff.datenvolumen<=6e3&&(u.volumes["2-6"].available=!0),t.tariff.datenvolumen>=4e3&&(u.volumes["4+"].available=!0),t.tariff.datenvolumen>=5e3&&(u.volumes["5+"].available=!0),t.tariff.datenvolumen>=1e4&&(u.volumes["10+"].available=!0),u.nets[n].available=!0)})}),u.hasBundles=e;var t;e&&angular.forEach(s.bundles,function(e){angular.forEach(e,function(e){Number(u.selectedDevice)===e.device_id&&(!t||e.price<t)&&(t=e.price)})}),u.cheapestDevicePrice=t,T()},E=function(){angular.forEach(s.bundles,function(e){angular.forEach(e,function(e){angular.forEach(u.deviceGroup.variants,function(t,n){Number(n)===e.device_id&&(null===t.delivery_time&&(t.delivery_time="Bald lieferbar"),t.hasBundle=!0)})})}),angular.forEach(u.deviceGroup.variants,function(e,t){null!==e.delivery_time||e.hasBundle||(n.debug("_checkBundlesAndDevices: deleting variant with id "+t,e),delete u.deviceGroup.variants[t])})},x=function(){var e=Object.keys(c);if(e.length>1){var t=c[e[1]].variants,n=!1;angular.forEach(t,function(e){null!==e.device_price&&null!==e.delivery_time&&(n=!0)}),u.isMultiDeviceView=n}},P=function(){var e=u.deviceGroup.variants[u.selectedDevice].delivery_time;e?u.selectedDeviceAvailability=e.substr(0,1).toUpperCase()+e.substr(1):u.hasBundles?u.selectedDeviceAvailability="Nicht lieferbar":u.selectedDeviceAvailability="Bald lieferbar"},O=function(){u.deviceGroup.variants&&u.deviceGroup.variants[u.selectedDevice]&&(u.selectedDevicePrice=u.deviceGroup.variants[u.selectedDevice].device_price,u.deviceGroup.variants[u.selectedDevice].device_uvp&&(u.selectedDeviceUvpPrice=u.deviceGroup.variants[u.selectedDevice].device_uvp))},N=function(){u.selectedDevice?(u.selectedDeviceLink="/shop/cart/add/?qty=1&bundleNo=0&productCodePost=P-"+u.selectedDevice,u.withTariff=null===u.selectedDevicePrice||u.selectedDevicePrice<=0):u.withTariff=!0},U=function(){if(n.debug("AppleCtrl: _restoreTariffSelection"),d){n.debug("AppleCtrl: trying to select last selected tariff",d);var e=!1;angular.forEach(s.bundles,function(t){angular.forEach(t,function(t){e===!1&&Number(u.selectedDevice)===t.device_id&&t.tarif_id===d&&(u.selectedBundle=t,u.selectedBundleId=t.bundle_id,e=!0)})})}r(m)},_=function(){B(),V(),s&&(R(),j())},j=function(){if("all"===u.selectedNet||u.selectedNet===!1||angular.isDefined(s.bundles[u.selectedNet])&&Array.isArray(s.bundles[u.selectedNet])){angular.forEach(u.volumes,function(e){e.available=!1});var e="all"===u.selectedNet||u.selectedNet===!1?["d1","d2","o2","e-plus"]:[u.selectedNet];angular.forEach(e,function(e){s&&s.bundles&&angular.forEach(s.bundles[e],function(e){e.tariff.datenvolumen<=1e3?u.volumes[1].available=!0:e.tariff.datenvolumen<2001?(u.volumes[-2].available=!0,2e3===e.tariff.datenvolumen&&(u.volumes[2].available=!0)):3e3===e.tariff.datenvolumen?u.volumes[3].available=!0:6e3===e.tariff.datenvolumen&&(u.volumes[6].available=!0),e.tariff.datenvolumen>=2001&&e.tariff.datenvolumen<=4e3&&(u.volumes["2-4"].available=!0),e.tariff.datenvolumen>=2001&&e.tariff.datenvolumen<=6e3&&(u.volumes["2-6"].available=!0),e.tariff.datenvolumen>=4e3&&(u.volumes["4+"].available=!0),e.tariff.datenvolumen>=5e3&&(u.volumes["5+"].available=!0),e.tariff.datenvolumen>=1e4&&(u.volumes["10+"].available=!0)})})}},R=function(){angular.forEach(u.nets,function(e){e.available=!1}),angular.forEach(u.nets,function(e,t){s&&s.bundles&&angular.forEach(s.bundles[t],function(t){("all"===u.selectedVolume||null===u.selectedVolume||1===u.selectedVolume&&t.tariff.datenvolumen<=1e3||"4+"!==u.selectedVolume&&"5+"!==u.selectedVolume&&"10+"!==u.selectedVolume&&"2-4"!==u.selectedVolume&&"2-6"!==u.selectedVolume&&"-2"!==u.selectedVolume&&1e3*u.selectedVolume===t.tariff.datenvolumen||"-2"===u.selectedVolume&&t.tariff.datenvolumen<=2e3||"2-4"===u.selectedVolume&&t.tariff.datenvolumen>2e3&&t.tariff.datenvolumen<=4e3||"2-6"===u.selectedVolume&&t.tariff.datenvolumen>2e3&&t.tariff.datenvolumen<=6e3||"4+"===u.selectedVolume&&t.tariff.datenvolumen>=4e3||"5+"===u.selectedVolume&&t.tariff.datenvolumen>=5e3||"10+"===u.selectedVolume&&t.tariff.datenvolumen>=1e4)&&(e.available=!0)})})},B=function(){angular.forEach(u.colors,function(e){e.available=!1}),angular.forEach(u.deviceGroup.variants,function(e){try{e.memory===u.selectedMemory&&angular.forEach(u.colors,function(t){t.color===e.color&&(t.available=!0)})}catch(t){n.debug(t),n.debug(u.colors,e.color)}})},V=function(){angular.forEach(u.memories,function(e){e.available=!1}),angular.forEach(u.deviceGroup.variants,function(e){e.color===u.selectedColor&&(u.memories[e.memory]?u.memories[e.memory].available=!0:n.debug("_checkAvailableMemories: Memory "+e.memory+" is not in Object"))})},q=function(){o.isLoggedIn()&&o.getCurrentContractDetails().then(function(e){u.isProlongationPossible=e.isProlongationPossible()})},z=function(){$(".content-wrapper").customSwipe({swipeLeft:F,swipeRight:G})},F=function(){window.location.href=$(".qtype-nav li.next a").attr("href")},G=function(){window.location.href=$(".qtype-nav li.prev a").attr("href")},H=function(e){e&&e.length&&$("body,html").animate({scrollTop:e.offset().top-$("header").height()-$(".qtype-nav").outerHeight()},500)}}]),angular.module("md").factory("AppleService",["$q","$log","$http","$location","$window","RequestService",function(e,t,n,a,r,i){var o=function(t){return angular.isObject(t)?i.get("devices",{sapIds:Object.keys(t).join(",")}).then(function(e){return e.data.devices}):e.reject("deviceObj is no Object")},s=function(e){var t=[],n={};return angular.forEach(e.colorCategories,function(n){var a=!1,r="";angular.forEach(e.variants,function(e){e.color_category===n&&(a=!0,r=e.color)}),a&&t.push({color:r,available:!0})}),t=m(t),angular.forEach(e.variants,function(e){if(e.memory){var t=e.memory.replace(" ","");n[t]={value:t,available:!0}}}),c(e),{colors:t,memories:n}},c=function(e){var n,a=["schwarz","grau"],r={};angular.forEach(e.variants,function(e,t){n?e.device_price<n?(n=e.device_price,r={variantKey:e}):e.device_price===n&&(r[t]=e):(n=e.device_price,r[t]=e)});var i=Object.keys(r).length;if(i>1){t.debug("There are more variants with the price",n);var o;angular.forEach(r,function(e,t){-1!==a.indexOf(e.color_category)&&(o=t)}),o?e.defaultVariant=o:e.defaultVariant=Object.keys(r)[0]}else 1===i?(t.debug("There is only one variant with price",n),e.defaultVariant=Object.keys(r)[0]):t.debug("No cheapest device found")},l=function(e){angular.forEach(e.promotion,function(t){t.name.indexOf("AP-frei")>0||t.name.indexOf("Anschlusspreis frei")>0?e.promotions.push("Anschlusspreis frei"):"absolute"===t.calc_type&&"monthly"===t.frequency&&(e.promotionLength=t.multiplier,e.promotionAmount=t.value,e.promotions.push(t.value*t.multiplier+" € Tarifrabatt ("+t.multiplier+" Monate à "+t.value+" €)"))}),new Date<new Date("12/21/2017")&&-1===e.features.indexOf("Weltweite Hotspot Flat")&&e.promotions.push("Weltweite Hotspot Flat 30 Tage kostenlos")},d=function(e,t){return e.promotions=[],0!==e.discount_price&&e.discount_price!==e.main_price?e.real_price=e.discount_price:e.real_price=e.main_price,l(e),"tf"===t&&(e.additionalOptions=["P-3172880"]),e.net=t,e.tariff_id===r.topTariff&&(e.isTopSeller=!0),e},u=function(e,t){var n;if(e.tariff=angular.copy(t[e.tarif_id]),e.promotion&&e.promotion.promotions){var a=e.promotion.promotions[0];e.tariff.promotionLength=a.multiplier,e.tariff.real_price=e.promotion.price,e.tariff.main_price=e.promotion.oldPrice}return(256825===e.tarif_id||377420===e.tarif_id||377454===e.tarif_id)&&(n="Jetzt mit 8 GB statt 4 GB Datenvolumen",angular.isArray(e.tariff.promotions)?-1===e.tariff.promotions.indexOf(n)&&e.tariff.promotions.push(n):e.tariff.promotions=[n]),(263035===e.tarif_id||375337===e.tarif_id||375371===e.tarif_id)&&(n="Jetzt mit 4 GB statt 2 GB Datenvolumen",angular.isArray(e.tariff.promotions)?-1===e.tariff.promotions.indexOf(n)&&e.tariff.promotions.push(n):e.tariff.promotions=[n]),e},g=function(e){var t=e.tarifgruppen,n={},a={};return angular.forEach(t,function(e,t){t=t.toLowerCase(),Array.isArray(e)&&e.length&&angular.forEach(e,function(e){e.tarife&&e.tarife.length&&angular.forEach(e.tarife,function(e){n[e.tariff_id]=d(e,t)}),e.bundles&&e.bundles.length&&angular.forEach(e.bundles,function(r){angular.isDefined(a[t])||(a[t]=[]);var i=u(r,n);i.tariffGroup=e.title,a[t].push(i)})})}),{bundles:a,tariffs:n}},p=function(a){var r=e.defer();return n.get("/ext/pdb/smartphone.php/?sapId="+a).then(function(e){var t=g(e.data,a);r.resolve(t)},function(e){t.debug(e),r.reject(e)}),r.promise},f=function(e){return e.sort(function(e,t){return e.tariff.isTopSeller?-1:t.tariff.isTopSeller?1:e.tariff.real_price-t.tariff.real_price})},m=function(e){return angular.isDefined(r.colorSort)&&Array.isArray(r.colorSort)&&angular.forEach(e,function(e,t){var n=r.colorSort.indexOf(e.color);-1!==n?e.sort=n:e.sort=t}),e};return{get:o,parse:s,getBundles:p,sortBundles:f,getSortedColors:m}}]),angular.module("md").controller("PreloadCtrl",["$location","$log","$scope","$window","$browser","$timeout","AuthService2","OidcService","LocalStorage","ValueStorage","ENVIRONMENT",function(e,t,n,a,r,i,o,s,c,l,d){t=t.getInstance("preloadCtrl");var u=this;u.isLoading=!1,u.error=!1,u.errorMessage=null;var g,p,f=function(){var e=jqCustom.getURIParameter("code");return e?(g=c.get(l.loginData),(p=c.get(l.pckeData))?(u.isLoading=!0,void s.getAccessTokenByAuthorizationCode(e,p.verifier).then(v,b)):h()):m()},m=function(){t.debug("_handleNoCodeError"),u.error=!0,u.errorMessage="The preload route cannot be called directly, it has to be a redirect after a successful MLP Login."},h=function(){t.debug("_handleNoPckeDataError"),u.error=!0,u.errorMessage="No PCKE Data exists in LocalStorage"},v=function(e){t.debug("_handleOidcAccessTokenSuccess",e),s.getUserInfo(e.access_token).then(function(e){o.onMlpUserInfo(e).then(w)},console.error)},b=function(e){t.debug("_handleOidcAccessTokenError",e),u.isLoading=!1,u.error=!0,u.errorMessage=e&&e.data&&e.data.message?e.data.message:"Unknown Error",c.rm(l.pckeData)},w=function(){if(t.debug("_processLoginData"),c.rm(l.loginData),g&&g.redirectUrl){t.debug("Replacing $location with ",g.redirectUrl);var n=g.redirectUrl.indexOf("/online-service/#/");n>-1?e.url(decodeURIComponent(g.redirectUrl.substr(n+18))).replace():a.location.href=g.redirectUrl}else t.debug('Replacing $location with "dashboard"'),window.location.href="/onlineservice/dashboard"};f()}]),app.directive("appMlpFrame",["$sce","$log","$window","$location","$timeout","ValueStorage","LocalStorage",function(e,t,n,a,r,i,o){var s={width:350,height:175};return{restrict:"E",scope:{settings:"@",redirectUrl:"@",redirectAction:"@",force:"@"},template:function(){return'<div><div ng-if="vm.isAlreadyLoggedIn">Sie sind bereits eingeloggt.</div><div ng-if="vm.mopapiError"><p>Leider steht dieser Dienst derzeit nicht zur Verfügung.</p></div><div ng-if="!vm.showIframe && !vm.isAlreadyLoggedIn && !vm.mopapiError" class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div><iframe name="{{vm.settings.theme}}"  ng-if="vm.showIframe" frameborder="0" width="{{vm.settings.width}}" height="{{ vm.settings.height }}" ng-src="{{vm.authorizeUrl}}"></iframe></div>';
},controller:["$scope","$element","$log","OidcService","AuthService2",function(t,c,l,d,u){l.info("MLP FRAME");var g=this;g.settings=$.extend({},s,t.$eval(t.settings)),g.showIframe=!1,g.isAlreadyLoggedIn=!1;var p=d.getLoginPromise();g.settings.force&&r(function(){l.info("resolving"),d.loginFinished()},2e3);var f=function(){p["finally"](m)},m=function(){if(!g.isAlreadyLoggedIn&&g.settings.layer===!0&&g.showIframe===!0&&"dropdown"===g.settings.theme||!g.isAlreadyLoggedIn&&"dropdown"!==g.settings.theme){if(t.redirectUrl){var r={};"self"===t.redirectUrl?r.redirectUrl=a.absUrl():r.redirectUrl=t.redirectUrl,t.redirectAction&&(r.redirectAction=t.redirectAction),o.set(i.loginData,r)}g.authorizeUrl=e.trustAsResourceUrl(d.createPckeRequest(!0,!1,!1,g.settings.theme,g.settings.color)),l.debug("authorizeUrl Directive MLP",u.isLoggedIn())}else{var s=o.get(i.redirectUrl);s&&(n.location.href=s,o.rm(i.redirectUrl))}},h=function(e){l.debug("MLP event",e),e.data&&e.data.height&&"heightChange"===e.data.text&&(g.settings.height=parseInt(e.data.height,10),t.$digest())};p.then(function(e){l.debug("loginPromise",p);var t=o.get(i.mopapiStatus);angular.isObject(t)&&t.isDown&&t.tryAgain>Date.now()?g.mopapiError=!0:e?g.isAlreadyLoggedIn=!0:g.showIframe=!0},function(){g.showIframe=!0})["finally"](function(){}),t.$watch("redirectUrl",f),n.addEventListener("message",h,!1),t.$on("$destroy",function(){n.removeEventListener("message",h)})}],controllerAs:"vm",link:function(){}}}]),angular.module("md").factory("OidcService",["$q","$log","$http","$window","$location","$rootScope","api","LocalStorage","ValueStorage","RequestService","AuthService2","CryptService","ENVIRONMENT",function(e,t,n,a,r,i,o,s,c,l,d,u,g){t=t.getInstance("OidcService");var p=128,f=localStorage.getItem("idProvider"),m=!1,h=e.defer(),v=g.xApiKeyOidc,b="oidc-login-frame",w="oidc-login-overlay",y=null,k=g.oidcUrl,C=g.auth0Url,S=g.oidcRedirectUrl,A=g.oidcIframeRedirectUrl,M=!1;i.VVLpreregistered=sessionStorage.getItem("VVLpreregistered")?!0:!1,i.VVLpreregisteredVerificationToken=""!==sessionStorage.getItem("VVLpreregisteredVerificationToken")?sessionStorage.getItem("VVLpreregisteredVerificationToken"):"","oidc"===f?k=k:(M=!1,k=C,p=66,v=g.xApiKeyAuth0,S=g.Auth0RedirectUrl,A=g.Auth0IframeRedirectUrl),a.addEventListener("message",function(e){t.debug("event.message",e);var n=sessionStorage.getItem("accessToken")?sessionStorage.getItem("accessToken"):!1,i=n?n.split("."):!1;if(i){var o=JSON.parse(atob(i[1]));n=o.user_type.includes("Agent")?!0:!1}if(e.data.oidcLogin){var s=jqCustom.getURIParameter("code",!1,e.data.oidcLogin),c=jqCustom.getURIParameter("error",!1,e.data.oidcLogin);s?P(e.data.oidcLogin):c&&0===a.location.pathname.indexOf("/online-service/")&&"/logout"!==r.url()&&(console.log("if error"),window.location.href=O(!0,!1,!1))}if("authorization_response"===e.data.type&&!e.data.oidcLogin&&(e.data.response.error&&"login_required"===e.data.response.error&&!n&&0===a.location.pathname.indexOf("/online-service/")&&"/logout"!==r.url()&&"/erstanmeldung"!==r.url()&&-1===r.path().indexOf("/aktivierung")&&(console.log("event.data.response",e.data.response),window.location.href=O(!0,!1,!1)),e.data.response.code)){var s=e.data.response.code?e.data.response.code:n;P("?code="+s)}});var I=function(){if(t.debug("Initializing Background Login"),-1===r.path().indexOf("preload")&&($.cookie("auth0."+g.xApiKeyAuth0+".is.authenticated")||-1!==a.location.pathname.indexOf("/online-service/")))if($.cookie("auth0."+g.xApiKeyAuth0+".is.authenticated")||0!==a.location.pathname.indexOf("/online-service/")||"/logout"===r.url()||"/erstanmeldung"===r.url()||-1!==r.path().indexOf("/aktivierung")){var n=O(!1,!1,!0);console.log("loginUrl",n);var i=$("#"+b);i.length||(i=$('<iframe id="'+b+'" width="0" height="0" frameborder="5" style="position: absolute; left: -1000px; top: -1000px; z-index: 99;" src="about:blank" ></iframe>'),$("body").append(i)),i.attr("src",n),h=e.defer()}else console.log("check"),window.location.href=O(!0,!1,!1)},L=function(n){t.debug("Initializing Background Logout");var r=s.get(c.oidcData);if(r){h=e.defer();var i=[["access_token",r.access_token],["prompt","none"],["post_logout_redirect_uri",encodeURIComponent(a.location.protocol+"//"+a.location.host.replace("www2","www")+A)]];n&&i.push(["include_rememberme",!0]);var o=i.map(function(e){return e.join("=")}).join("&"),l=k+"endsession?"+o,d=$("#"+b);d.length||(d=$('<iframe id="'+b+'" width="0" height="0" frameborder="5" style="position: absolute; left: -100px; top: -100px; z-index: 99;" src="about:blank" ></iframe>'),$("body").append(d)),d.attr("src",l)}else t.debug("no background logout required")},T=function(e,n){var r=$("#"+w);if(t.debug("toggleLoginOverlay",e,n),e){if(-1!==a.location.href.indexOf("/shop"))return;n&&!r.length?(r='<div id="'+w+'" class="oidc-login-overlay"><img src="/img/md-loader.gif"></div>',$("body").append(r)):n||(y=null,D())}else if(!e){if(r.length&&r.remove(),y){try{y.click()}catch(i){}y=null}E()}},D=function(){t.debug("capture bodyclick on"),document.addEventListener("click",x,!0)},E=function(){t.debug("capture bodyclick off"),document.removeEventListener("click",x,!0)},x=function(e){e.preventDefault(),e.stopPropagation(),y=e.target,T(!0,!0),E()},P=function(e){t.debug("handleOidcRedirect",e);var n=jqCustom.getURIParameter("code",!1,e);if(!n)return void R();var a=s.get(c.pckeData);return a?(console.log("pckeData",a),console.log("code",n),T(!0),void N(n,a.verifier).then(j,R)):void R()},O=function(e,n,r,i,o){t.debug("createPckeRequest");var l=d.getUser(),f=G(),h=q(p),b=F("S256",h);m=r;var w=[["client_id",v],["code_challenge",encodeURI(b)],["code_challenge_method","S256"],["display","iframe"],["state",encodeURI(f)]];M?w.push(["response_type","code"]):(w.push(["auth0Client","eyJuYW1lIjoiQGF1dGgwL2F1dGgwLWFuZ3VsYXIiLCJ2ZXJzaW9uIjoiMi4yLjEiLCJlbnYiOnsiYW5ndWxhci9jb3JlIjoiMTUuMS40In19"]),w.push(["scope","openid+profile+email"])),r?(M||(w.push(["response_mode","web_message"]),w.push(["response_type","code"])),w.push(["redirect_uri",encodeURIComponent(a.location.protocol+"//"+a.location.host+A)]),w.push(["prompt","none"])):(M||(w.push(["response_mode","query"]),w.push(["response_type","code"]),"dashboard"===i?w.push(["redirect_uri",encodeURIComponent(g.Auth0RedirectUrlDashboard)]):w.push(["redirect_uri",encodeURIComponent(a.location.protocol+"//"+a.location.host+S)]),l&&l.username),M&&(w.push(["acr_values",n?"0":"1"]),w.push(["prompt","login"]),w.push(["login_url",encodeURIComponent("login")]),w.push(["redirect_uri",encodeURIComponent(a.location.protocol+"//"+a.location.host.replace("www2","www")+S)])),l&&l.username&&M&&w.push(["login_hint",u.encrypt(u.passwordDerivedKey(navigator.userAgent),l.username)])),i&&"dashboard"!==i&&M&&w.push(["ui_theme",i]),o&&M&&w.push(["ui_foreground_color",o]);var y=w.map(function(e){return e.join("=")}).join("&"),C=k+"authorize?"+y;return s.set(c.pckeData,{verifier:h,state:f}),t.debug("createPckeRequest",C),C},N=function(r,i){t.debug("getAccessTokenByAuthorizationCode");try{var d=s.get(c.oidcData).access_token;s.set("oat",d)}catch(u){}var g=e.defer(),p=[["client_id",v],["grant_type","authorization_code"],["code",r],["code_verifier",i],["redirect_uri",encodeURIComponent(a.location.protocol+"//"+a.location.host+(m?A:S))]];console.log("authIframeRedirectUrl",A);var h=f&&"oidc"===f?k+"/token":C+"oauth/token",b={headers:{"Content-Type":"application/x-www-form-urlencoded","Skip-Tasks":"unauthorized alert"},withCredentials:!1},w={headers:{"Content-Type":"application/x-www-form-urlencoded","Auth0-Client":"eyJuYW1lIjoiQGF1dGgwL2F1dGgwLWFuZ3VsYXIiLCJ2ZXJzaW9uIjoiMi4yLjEiLCJlbnYiOnsiYW5ndWxhci9jb3JlIjoiMTYuMi42In19"},withCredentials:!1};delete n.defaults.headers.common["X-API-KEY"];var y="oidc"===f?b:w;return l.post(h,p.map(function(e){return e.join("=")}).join("&"),y).then(function(e){var t=e.data.access_token.split(".");e.data.jwt=JSON.parse(atob(t[1])),e.data.code=r,s.rm(c.pckeData),s.set(c.oidcData,e.data),s.set("userinfo",btoa(e.data.jwt.username)),o.init(e.data.access_token),g.resolve(e.data)},g.reject)["finally"](function(){}),g.promise},U=function(e,n){if(t.debug("handleAccessTokenChange"),"oidc"===n){var a=e.split("."),r={jwt:JSON.parse(atob(a[1])),access_token:e};s.set(c.oidcData,r),o.init(e)}j({access_token:e})},j=function(e){t.debug("_handleOidcAccessTokenSuccess"),V(e.access_token).then(function(e){d.onMlpUserInfo(e).then(B,function(e){T(!1),h.reject(e)})},function(e){T(!1),h.reject(e),console.error(e)})},R=function(e){t.debug("_handleOidcAccessTokenError",e),T(!1),h.reject("Token Error",e),s.rm(c.pckeData)},B=function(){var e=s.get(c.loginData),n=e&&e.redirectUrl?e.redirectUrl:"";t.debug("_processLoginData",n),-1===r.path().indexOf("/login")&&""===n&&s.rm(c.loginData);var i=s.get(c.oidcData);T(!1),h.resolve("1"===i.jwt.acr);var o=s.get(c.redirectUrl)?s.get(c.redirectUrl):n;t.debug("AuthService2.isLoggedIn()",d.isLoggedIn()+" "+o),o&&d.isLoggedIn()?(a.location.href=o,s.rm(c.redirectUrl)):M&&0===a.location.pathname.indexOf("/online-service/")&&!d.isLoggedIn()&&-1===window.location.hash.indexOf("erstanmeldung")&&-1===window.location.hash.indexOf("passwort-vergessen")&&-1===window.location.hash.indexOf("passwort-erstellen")&&-1===window.location.hash.indexOf("datenvervollstaendigung")&&(a.location.href=O(!0,!1,!1))},V=function(e){return t.debug("getUserInfo"),l.get(k+"userinfo",{},{withCredentials:!1})},q=function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=z(e),a=new Array(e),r=0;e>r;r++)a[r]=t.charCodeAt(n[r]%t.length);return String.fromCharCode.apply(void 0,a)},z=function(e){var t,n=window.crypto||window.msCrypto;if(n&&n.getRandomValues&&window.Uint8Array)return t=new Uint8Array(e),n.getRandomValues(t),t;t=new Array(e);for(var a=0;a<t.length;a++)t[a]=Math.floor(256*Math.random());return t},F=function(e,t){switch(e){case"plain":return t;case"S256":var n=new Uint8Array(sha256.arrayBuffer(t));return base64js.fromByteArray(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"");default:throw new Error("Invalid value for pkceMethod")}},G=function(){var e,t,n="";for(e=0;32>e;e++)t=16*Math.random()|0,(8===e||12===e||16===e||20===e)&&(n+="-"),n+=(12===e?4:16===e?3&t|8:t).toString(16);return n},H=function(){return t.debug("getLoginPromise"),h.promise},W=function(){h.resolve()},J=function(){console.log("tanAuthorization ");var e=r.search();console.log("tanAuthorization "+e.tan);var t=e.q?atob(e.q).split(":"):[],a=e.tan?e.tan:t[0],u=6===_.size(a)?!1:!0,p=e.customer?atob(e.customer):t[1],f=e.contract?e.contract:btoa(t[2]),m=window.location.href.indexOf("www.");console.log("tanAuthorization "+u);var h;if(u?(sessionStorage.setItem("jwtTan",!0),h=m>-1?!e.useCase||"App_VVL"!==e.useCase&&"AppVVL"!==e.useCase&&"app_vvl"!==e.useCase?"urw6205d7pVW9gOioa8hcAOcKODS4xyS":"W1XqsrCdpQ5T22aI4qdzRMcCZ2Fi2FEz":!e.useCase||"App_VVL"!==e.useCase&&"AppVVL"!==e.useCase&&"app_vvl"!==e.useCase?"qcyTH4NX7N8hB6vrd0fEX4EZIa7RGoQ9":"sPD3frgyRfB7Nf1A6XoQHjv7dC9gQDsi"):(sessionStorage.setItem("jwtTan",!1),h=m>-1?"860aa4d0-177a-43b3-9452-23b641eed51a":"29c61c5d-5aca-4663-a1dd-59d2c863ea0a"),u)return console.log("tanAuthorization: token-exchange"),delete n.defaults.headers.common.Authorization,n.defaults.withCredentials=!1,l.post(g.tokenExchange+"token-exchange",{client_id:h,grant_type:"urn:ietf:params:oauth:grant-type:jwt-bearer",assertion:a}).then(function(e){console.log("tanAuthorizationResponse: "+e),o.init(e.data.access_token);var t=e.data.access_token.split("."),n=JSON.parse(atob(t[1]));l.get(g.apiUrl+"/v2/user/users/"+n.username,null,{headers:{"CF-Access-Client-Id":"593e2798c0d2e2541a55704e3d451d3f.access","CF-Access-Client-Secret":"bcdbdb8fd7b0c778b89d3dd793881d4d1c1c3514d4188935212a540776c999bb"}}).then(function(e){"PREREGISTERED"===e.data.status&&(sessionStorage.setItem("VVLpreregistered",!0),i.VVLpreregistered=!0,l.post(g.apiUrl+"/v2/user/preregister",{userName:n.username},{headers:{"CF-Access-Client-Id":"593e2798c0d2e2541a55704e3d451d3f.access","CF-Access-Client-Secret":"bcdbdb8fd7b0c778b89d3dd793881d4d1c1c3514d4188935212a540776c999bb"}}).then(function(e){e.data.verificationToken&&(sessionStorage.setItem("VVLpreregisteredVerificationToken",e.data.verificationToken),i.VVLpreregisteredVerificationToken=e.data.verificationToken)}))}),s.set(c.taninfo,f),$.cookie("tanToken",e.data.access_token,{path:"/"}),$.cookie("tanCustomer",p,{path:"/"}),d.getTrackingObject()});var v=[["client_id",h],["grant_type","custom_identity"],["tan",a],["customer_id",p]];return delete n.defaults.headers.common.Authorization,n.defaults.withCredentials=!1,l.post(g.oidcUrl+"/token",v.map(function(e){return e.join("=")}).join("&"),{headers:{"Content-Type":"application/x-www-form-urlencoded","Skip-Tasks":"unauthorized alert"},withCredentials:!1}).then(function(e){o.init(e.data.access_token),s.set(c.taninfo,f),$.cookie("tanToken",e.data.access_token,{path:"/"}),$.cookie("tanCustomer",p,{path:"/"}),d.getTrackingObject()})};return{getUserInfo:V,createPckeRequest:O,handleOidcRedirect:P,toggleLoginOverlay:T,handleAccessTokenChange:U,getAccessTokenByAuthorizationCode:N,initializeBackgroundLogin:I,initializeBackgroundLogout:L,getLoginPromise:H,loginFinished:W,tanAuthorization:J}}]),angular.module("md").factory("pckeHelper",function(){return{}}),angular.module("md").factory("AuthService2",["$q","$log","$route","$injector","$location","$timeout","$http","$rootScope","$window","api","Idle","Title","UserModel","ModelFactory","LocalStorage","ValueStorage","ErrorService","RequestService","UrlService","ENVIRONMENT",function(e,t,n,a,r,i,o,s,c,l,d,u,g,p,f,m,h,v,b,w){function y(e,n){t.debug("loginCc");var r=a.get("OidcService");l.init(e);var i=f.get(m.oidcData);ne.isAgent=!0,"auth0"!==n?ne.username="Agent: "+i.jwt.act.sub||ne.username:ne.username="Agent: "+i.jwt.impersonated_by,console.log("impersonated_by",ne.username),r.handleAccessTokenChange(e,n)}function k(e){var t={access_token:e.accessToken};f.set(m.oidcData,t),ne.partyIds=[e.customerReferences],he(e).then(function(e){pe(e)})}function C(){t.debug("onMopapiError");var n=f.get(m.oidcData);return ne.authState="0"===n.jwt.acr?g.prototype.SOFTLOGIN:g.prototype.AUTHENTICATED,ne.username=n.jwt.username,delete ne.pagination,ue(ne),ne.init(),s.$broadcast("user:login",g),fe(),e.when({success:"login success"})}function S(){t.debug("handleMopapiError");var e={isDown:!0,tryAgain:Date.now()+6e4};f.set(m.mopapiStatus,e)}function A(){f.rm(m.mopapiStatus)}function M(e){var t=document.cookie.match("(^|;)\\s*iab_purposes\\s*=\\s*([^;]+)");if(t&&Object.values(JSON.parse(decodeURIComponent(t[2])))[0]&&Object.values(JSON.parse(decodeURIComponent(t[2])))[1]&&Object.values(JSON.parse(decodeURIComponent(t[2])))[2]&&Object.values(JSON.parse(decodeURIComponent(t[2])))[3]&&Object.values(JSON.parse(decodeURIComponent(t[2])))[4]&&Object.values(JSON.parse(decodeURIComponent(t[2])))[5]&&Object.values(JSON.parse(decodeURIComponent(t[2])))[6]&&Object.values(JSON.parse(decodeURIComponent(t[2])))[7]&&Object.values(JSON.parse(decodeURIComponent(t[2])))[8]&&Object.values(JSON.parse(decodeURIComponent(t[2])))[9]){var n=f.get(m.oidcData),a=(new Date).getTime()/1e3;dateNow=Math.round(a);var r=JSON.parse(window.localStorage.getItem("tCon"));"logout"===e?($.cookie("_econi","",{path:"/",domain:".freenet-mobilfunk.de",expires:-3}),window.localStorage.removeItem("tCon")):"login"!==e&&"changeContract"!==e&&(!r||0!==location.pathname.indexOf("/online-service/")&&0!==location.pathname.indexOf("/digitale-welt/")&&0!==location.pathname.indexOf("/service/")||dataLayer.push({event:"tData",tData:r.tData,d:r.d,acr:r.acr})),("login"===e||"changeContract"===e)&&(0===location.pathname.indexOf("/online-service/")||0===location.pathname.indexOf("/digitale-welt/")||0===location.pathname.indexOf("/service/"))&&(o.defaults.withCredentials=!1,v.get("getTrackingObject").then(function(t){"changeContract"===e&&(dateNow=r.d);var a={tData:t.data,d:dateNow,acr:n.jwt.acr};if(window.localStorage.setItem("tCon",JSON.stringify(a)),"changeContract"===e&&dataLayer.push({event:"tData",tData:t.data,d:dateNow,acr:n.jwt.acr}),t.data.id3){var i=o.defaults.headers.common.Authorization;delete o.defaults.headers.common.Authorization,o.get("https://tm.dp.freenet-mobilfunk.de/cwrw?c_name=_econi&c_content="+t.data.id3+"&c_life=2592000",{withCredentials:!0}),o.defaults.headers.common.Authorization=i}}))}}function I(i,o){t.debug("setCurrentContract",i,o);var c=de(),l=e.defer();return angular.isUndefined(i)?l.reject():c.getContract()===i?l.resolve():angular.isDefined(c.contracts)?(c.setActiveContract(i),f.set(m.userData,c,!1),$.cookie&&$.cookie("contractId",i,{path:"/",expires:7}),ae||(ae=a.get("contractsService")),ae.getDetails(i,!0).then(function(e){s.contractType=e.contractType,o&&(O()?N()&&!U()?r.path("/meine-vertraege/vertragsdetails/vertragsverlaengerung"):n.reload():location.reload()),l.resolve(e)})):l.reject(),l.promise}function L(){return ne&&ne.isLoggedIn()}function T(){return ne&&ne.isSoftLoggedIn()}function D(){return ne.isAnonymous()}function E(){return ne.isIdentified()}function x(e,n){var a,i=de(),o=!i.partyIds||0===i.partyIds.length,s="/datenvervollstaendigung",c="/vertragsinhaber-aktivierung/:identifyer/:verificationCode",l="/vertragsinhaber-aktivierung/:identifyer/:msisdn/:verificationCode",d="/aktivierung-brief",u="/datenvervollstaendigung-interessent";return e=e||r.path(),(O()||n)&&o&&i.isNewUser&&s!==e&&c!==e&&l!==e&&u!==e&&d!==e&&(t.debug("isNewUser::triggered"),a=s),a}function P(e){ne.init();var t,n="/meine-rechnungen";return e=e||r.path(),O()&&ne.hasPermission("inkasso")&&n!==e&&(t=n),t}function O(){return 0===location.pathname.indexOf("/online-service/")}function N(){return location.hash.indexOf("vertragsverlaengerung")>-1}function U(){return location.hash.indexOf("warenkorb")>-1}function j(){return ne.getContractIds()}function R(n,o){var d="/login",u=angular.isObject(o)&&o.force,g=a.get("UserModel"),p=e.defer();if(t.debug("logout",L()),L()){"auto"===n&&u||"newUsername"===n||"accountDelete"===n?oe?(t.debug("logout 2"),p.resolve()):i(function(){window.location.href=w.auth0Url+"v2/logout?returnTo="+encodeURIComponent(w.auth0Logout)+"&client_id="+w.xApiKeyAuth0+"&auth0Client=eyJuYW1lIjoiQGF1dGgwL2F1dGgwLWFuZ3VsYXIiLCJ2ZXJzaW9uIjoiMi4yLjEiLCJlbnYiOnsiYW5ndWxhci9jb3JlIjoiMTUuMS40In19"},2e3):(M("logout"),oe?(t.debug("logout 1"),B().then(p.resolve)["catch"](p.reject)):"redirectLogin"===n?window.location.href=w.auth0Url+"v2/logout?returnTo="+encodeURIComponent(w.auth0Logout+"?redirectLogin=true")+"&client_id="+w.xApiKeyAuth0+"&auth0Client=eyJuYW1lIjoiQGF1dGgwL2F1dGgwLWFuZ3VsYXIiLCJ2ZXJzaW9uIjoiMi4yLjEiLCJlbnYiOnsiYW5ndWxhci9jb3JlIjoiMTUuMS40In19":window.location.href=w.auth0Url+"v2/logout?returnTo="+encodeURIComponent(w.auth0Logout)+"&client_id="+w.xApiKeyAuth0+"&auth0Client=eyJuYW1lIjoiQGF1dGgwL2F1dGgwLWFuZ3VsYXIiLCJ2ZXJzaW9uIjoiMi4yLjEiLCJlbnYiOnsiYW5ndWxhci9jb3JlIjoiMTUuMS40In19");try{c.dataLayer.push({userId:void 0}),$('input[type="password"], textarea').val("")}catch(f){}}ne.authState=g.prototype.IDENTIFIED,ne.partyIds=[],ne.contractId=null,ne.contracts={},ue(ne),$.removeCookie("partyId",{path:"/",expires:-3}),$.removeCookie("accessToken",{path:"/",expires:-3}),$.removeCookie("contractId",{path:"/",expires:-3}),l.init(),s.$broadcast("logout"),n&&"accountDelete"!==n?d+="/"+n:(o?s.logoutMsgData=o:s.logoutMsgData="",d="/logout"),p.promise["finally"](function(){O()?(t.debug("logout::data und path",o+" "+d),"accountDelete"!==n&&(s.loginMsgData=o),i(function(){r.path(d)},1e3),i(function(){window.location.href=OidcService.createPckeRequest(!0,!1,!1)},1e3),q()):n||(t.debug("logout::no rout"),window.location.href=OidcService.createPckeRequest(!0,!1,!1))})}function B(){t.debug("requestAuthLogout");var n=e.defer(),r=a.get("OidcService");return r.initializeBackgroundLogout(!1),v.del("logout",{flush:!1})["finally"](function(){r.getLoginPromise()["finally"](function(){r.initializeBackgroundLogin(),r.getLoginPromise()["finally"](function(){n.resolve(),s.$broadcast("navLayer",null)})})}),n.promise}function V(){L()&&!d.running()&&(u.idleMessage("Logout in {{minutes}}:{{seconds}}"),u.timedOutMessage(h.getMessage("auto","login").message),u.store(),d.watch())}function q(){d.unwatch()}function z(e){return ae||(ae=a.get("contractsService")),ae.getDetails(e)}function F(){return v.get("vvlInfo").then(function(e){f.set(m.prolongationInfo,e.data.prolongation)})}function G(){var e=de();e.customer&&(t.debug("flushing customer data"),delete e.customer,ue(e))}function H(e){var t=de();return e=e||t.getContract(),angular.isObject(t)&&angular.isObject(t.contracts)&&t.contracts[e]&&(delete t.contracts[e].details,ue(t),z(e)),!0}function W(e){return z(e).then(function(e){return e.isTalkline()},function(){return!1})}function J(){return ne.isProspect()}function K(){return ne.isBusiness}function Z(){return z()}function Y(){var e=r.path(),n=["/login","/logout","/aktivierung","/aktivierung-bk","/aktivierung-email","/erstanmeldung","/passwort-vergessen","/passwort-erstellen"],a=!0;return t.debug("loginRequired path is",e),_.each(n,function(t){-1===e.indexOf(t)&&(a=!1)}),O()&&a&&!L()}function Q(){t.debug("getCustomerData"),ne.init();var n,r=e.defer(),i=ne.getAllowedAction("contractOwner","customer");return t.debug("getCustomerData::url"),L()&&i?(t.debug("getCustomerData::promies"),r.promise=v.get(i).then(function(e){return n=a.get("addressService"),n.convertAddress(e.data),e.data.expires=(new Date).getTime()+re,ne.customer=e.data,ue(ne),e})):r.reject({data:{message:"no customer link found",code:1001}}),r.promise.then(function(e){return p.transform(e.data,"Customer")})}function X(){return ne.getPartyId()}t=t.getInstance("AuthService2"),console.log("LocalStorage.get(ValueStorage.userdata)",f.get("userdata"));var ee=!1,te=f.get("userdata");null!==te&&1===Object.keys(te).length&&(ee=te.activeContract);var ne,ae,re=12e4,ie=localStorage.getItem("idProvider"),oe="oidc"===ie?!0:!1,se=function(){var e=f.get(m.loginData);e&&e.redirectUrl&&e.redirectUrl===r.absUrl()&&t.debug("WE ARE ON THE REDIRECT ROUTE")},ce=function(){ne=de(),console.log("status",ne);var e,n=f.get(m.oidcData),i=r.search();if(e=i.tan?i.tan:i.q?i.q:f.get(m.taninfo),s.isProspect=ne.isProspect(),s.authState=ne.authState,$.cookie&&$.cookie("accessToken")&&n&&n.access_token&&2===ne.authState||e&&2!==ne.authState){if(-1!==r.path().indexOf("login/cct"))return!1;if(t.debug("Cookie is set, initialising AP"),2===ne.authState){var o=a.get("OidcService");o.loginFinished("1"===n.jwt.acr),l.init($.cookie("accessToken"))}else e&&2!==ne.authState?$.cookie("tanToken")&&""!==$.cookie("tanToken")&&l.init($.cookie("tanToken")):l.init();return s.$broadcast("user:login",ne),!0}return t.debug("No Accesstoken in Cookie"),!1},le=function(){$.removeCookie("vid",{path:"/"});var e=a.get("OidcService");return e.initializeBackgroundLogout(!0),f.flush(),s.$applyAsync(function(){ne=void 0,s.$broadcast("navLayer",null),ue({})}),v.get("/ext/teaser/reset.php")},de=function(){return angular.isUndefined(ne)?f.get(m.userData)?(ne=p.transform(f.get(m.userData),"User"),ee&&(ne.activeContract=ee),s.isAgent=angular.isDefined(ne.isAgent)?ne.isAgent:!1,t.debug("getUser userData",ne)):(ne=p.transform({},"User"),s.isAgent=angular.isDefined(ne.isAgent)?ne.isAgent:!1,t.debug("getUser ModelFactory",ne)):s.isAgent=angular.isDefined(ne.isAgent)?ne.isAgent:!1,ne},ue=function(e){var n=f.get(m.oidcData);if(e=p.transform(e,"User"),t.debug("setUser::after transform",e),$.cookie)try{$.cookie("partyId",e.getPartyId(),{path:"/"}),n&&n.access_token&&(t.debug("setUser:  storing access_token in cookie"),$.cookie("accessToken",n.access_token,{path:"/",expires:30})),$.cookie("contractId",ve(),{path:"/"}),$.cookie("customerLink",e.getAllowedAction("contractOwner","customer"),{path:"/"})}catch(a){}s.isAgent=angular.isDefined(e.isAgent)?e.isAgent:!1,s.isProspect=e.isProspect(),s.authState=e.authState,f.set(m.userData,_.clone(e))},ge=function(e){t.debug("onMlpUserSuccess",e.data);var n=!1;e.data.customer&&e.data.customer.customerId?(ne.partyIds=[e.data.customer.customerId],ne.customer={name:{firstName:e.data.customer.foreName,lastName:e.data.customer.lastName,nameAffix:e.data.customer.nameAppendix,organizationName:e.data.customer.organizationName,salutation:e.data.customer.salutation},role:{productOwner:e.data.customer.customerRoles&&-1!==Object.keys(e.data.customer.customerRoles).indexOf("productOwner")?!0:!1,productUser:e.data.customer.customerRoles&&-1!==Object.keys(e.data.customer.customerRoles).indexOf("productUser")?!0:!1,AccountAdmin:e.data.customer.customerRoles&&-1!==Object.keys(e.data.customer.customerRoles).indexOf("customerAccountAdmin")?!0:!1}}):e.data.partyIds&&e.data.partyIds.length?ne.partyIds=e.data.partyIds:(G(),ne.partyIds=["CUSTOMER-ID"]),e.data.customer&&("ORGANIZATION"===e.data.customer.personType||e.data.customer.customerRoles&&-1!==Object.keys(e.data.customer.customerRoles).indexOf("customerAccountAdmin")||e.data.customer.customerRoles&&-1!==Object.keys(e.data.customer.customerRoles).indexOf("productUser")?ne.isBusiness=!0:ne.isBusiness=!1,t.debug("onMlpUserSuccess",ne)),e.data.user_type&&"mdUserAgent"===e.data.user_type&&(n=!0),e.data.impersonated_by&&""!==e.data.impersonated_by&&(n=!0);var a=f.get(m.mopapiStatus);return angular.isObject(a)&&a.isDown===!0&&a.tryAgain>Date.now()?C():he(e.data,n).then(function(e){return A(),pe(e)},S)},pe=function(n){t.debug("onMlpLoginSuccess",n);var a=e.defer(),r=f.get(m.oidcData);return ne=_.extend(ne,n.data),ne.authState="0"===r.jwt.acr?g.prototype.SOFTLOGIN:g.prototype.AUTHENTICATED,ne.username=r.jwt.impersonated_by&&""!==r.jwt.impersonated_by?"Agent: "+r.jwt.impersonated_by:r.jwt.username,delete ne.pagination,ue(ne),n.data.partyIds&&n.data.partyIds.length>0?me(ne).then(function(e){if(T())return F();t.debug("LocalStorage.get(ValueStorage.userdata)",f.get("userdata"));angular.isDefined(e.defaultContracts.TELCO)?e.defaultContracts.TELCO:Object.keys(e.defaultContracts)[0];return M("login"),fe(),e}):(ne.init(),s.$broadcast("user:login",g),fe(),a.resolve({success:"login success"}),a.promise)},fe=function(){$("body").trigger("ps:loggedIn")},me=function(n,a){var i=n.partyIds[0],o=e.defer();return n.contracts=n.contracts===!1?{}:n.contracts,t.debug("data-prev",n),t.debug("data-defaultContracts",n.defaultContracts),n.pagination&&n.pagination.complete!==!1?(o.resolve(ne),o.promise):v.get(["contracts",i]).then(function(e){var a=""===n.defaultContracts?{}:n.contracts;_.extend(n,e.data),t.debug("data",n),n.pagination.complete===!1&&(Object.assign(a,e.data.contracts),Object.assign(n.contracts,a),t.debug("contracts",e));var i=r.search();return i.contract&&angular.forEach(n.contracts,function(e,a){"TELCO"===e.contractType&&e.isActive&&e.msisdn&&md5("oclp"+e.msisdn)===i.contract&&(t.debug("fetchContracts: found a contract",a),n.defaultContracts.TELCO=a)}),ue(n),e.data.pagination&&e.data.pagination.complete===!1?me(n):(s.$broadcast("user:contracts",e.data),e.data)})},he=function(e,a){t.debug("handshakeMopapi");var r=null;if(T())try{r=f.get("oat")}catch(i){}if(a){var o=n.current.params,o={sessionId:o.sessionid};return v.post("loginCc",o,{})}if(null!==r){var s=b.getUrl("loginSSO");return v.post(s,null,{})}return v.post("loginSSO",null,{})},ve=function(){return ne.getContract()};return{init:se,anonymize:le,logout:R,loginCc:y,status:ce,getUser:de,setUser:ue,isLoggedIn:L,isAnonymous:D,isIdentified:E,isSoftLoggedIn:T,isNewUser:x,isInkasso:P,isProspect:J,isBusiness:K,isTalkline:W,flushCustomerData:G,flushContractDetails:H,getCurrentContractDetails:Z,onMlpUserInfo:ge,onMlpLoginSuccess:pe,handshakeMopapi:he,getContract:ve,getContracts:j,watchIdle:V,unwatchIdle:q,fetchContracts:me,setCurrentContract:I,loginRequired:Y,getCustomerData:Q,isOnlineService:O,loginECare:k,getPartyId:X,getTrackingObject:M}}]),app.controller("BankCtrl",["$scope","$location","bankService","contractsService","RequestService","ErrorService","TeaserEngine",function(e,t,n,a,r,i,o){window.location.href=window.location.protocol+"//"+window.location.host+"/onlineservice/meine-daten/bankverbindung-aendern",e.isLoading=!0,e.bicClass="inactive",e.isDEAccount=!0,e.ibanValidated=!1,e.setBreadcrumb([{url:"#/meine-daten",title:"Meine Daten"},{url:"#/meine-daten/bankverbindung-aendern",title:"Bankverbindung ändern"}]);var s={bank:n.requestBankAccount(),contract:a.getDetails()},c={bankSuccess:function(t){t.bankAccount.future.startDate?(e.bankdata=angular.copy(t.bankAccount.future),e.bankdata.startDate=parseInt(e.bankdata.startDate,10)):(e.bankdata=angular.copy(t.bankAccount.active),t.name.firstName||t.name.lastName?e.bankdata.newAccountHolderName=t.name.firstName+" "+t.name.lastName:e.bankdata.newAccountHolderName=t.name.companyName,e.bankdata.accountHolderName||(e.bankdata.accountHolderName=t.name.firstName+" "+t.name.lastName)),e.userName=t.name,e.bankdataOriginal=angular.copy(t.bankAccount.active)},bankError:function(t){e.errorMessage=i.getMessage(t.data.code)},contractSuccess:function(t){e.contract=t},always:function(){e.isLoading=!1}};r.handlePromises(s,c),e.compareData=function(){var t,n={};for(t in e.bankdataOriginal)e.bankdata.hasOwnProperty(t)&&e.bankdataOriginal[t]===e.bankdata[t]||(n[t]=e.bankdataOriginal[t]);e.compareString=JSON.stringify(n)},e.clearIBAN=function(){e.bankdata.iban="",e.bankdata.bic="",e.bankdata.bankName=""},e.validateIban=function(){e.bankdata.iban&&(e.bankdata.iban.match(/^DE/)?n.validateIban(e.bankdata.iban).then(function(t){e.bankdata.bankName=t.data.bankName,e.bankdata.bic=t.data.bic,e.checkIban(t.data.iban),delete e.errorMessage,e.ibanValidated=!0},function(t){e.ibanValidated=!1,e.errorMessage=i.getMessage(t.data.code)}):e.bankdata.bic&&n.validateIbanAndBic(e.bankdata.iban,e.bankdata.bic).then(function(t){e.bankdata.iban=t.data.iban,e.checkIban(t.data.iban),delete e.errorMessage,e.ibanValidated=!0},function(t){e.ibanValidated=!1,e.errorMessage=i.getMessage(t.data.code)}))},e.ibanGenerator=function(t,n){r.get(["getIban",t,n]).then(function(t){e.sepa=t.data,delete e.errorMessage},function(t){delete e.sepa,e.errorMessage=i.getMessage(t.data.code)})},e.resetBic=function(){e.bankdata.bic=""},e.checkIban=function(t){void 0===t||t.match(/^DE/)?(e.bicClass="inactive",e.isDEAccount=!0,$("#bic").attr("placeholder","Dieser Wert wird für Sie automatisch ermittelt")):(e.bicClass="",e.isDEAccount=!1,$(".iban-generator").css("display","none"),$("#bic").attr("placeholder","BIC"))},e.ibanAdopt=function(t,n,a){$.fancybox.close(),e.bankdata.iban=t,e.bankdata.bankName=n,e.bankdata.bic=a,e.ibanValidated=!0},e.saveBankAccount=function(){e.isLoading=!0,n.saveBankAccount(e).then(function(t){e.isLoading=!1,e.bankdataCode=t.data.ordernumber,e.newStartDate=t.data.startDate,""!==t.data.links.linkToPendingMandate&&(e.linkToPendingMandate=t.data.links.linkToPendingMandate.replace(/\\/g,"")),o.loadTeasers(-1,{clips:4})},function(t){e.isLoading=!1,e.errorMessage=i.getMessage(t.data.code)})},e.breakProcess=function(){$.fancybox.close()},e.backToStart=function(){t.path("/meine-daten")}}]),app.directive("form",function(){return{restrict:"E",link:function(e,t){"future"===t.attr("id")&&t.find(".btn.right").addClass("is-hidden")}}}),app.filter("salutation",function(){return function(e){switch(e){case"Herr":return"Sehr geehrter Herr";case"Frau":return"Sehr geehrte Frau";case"Firma":return"Firma"}}}),app.factory("bankService",["$log","RequestService","AuthService2",function(e,t,n){function a(){return n.getCustomerData()}return{requestBankAccount:a,validateIban:function(e){return t.get(["checkIban",e])},validateIbanAndBic:function(e,n){return t.get(["checkIban",e],{bic:n})},saveBankAccount:function(e){var n,a=e.bankdata.street+" "+e.bankdata.number;return n="yes"===e.bankdata.sameAccountHolder?{iban:e.bankdata.iban,bic:e.bankdata.bic}:{iban:e.bankdata.iban,bic:e.bankdata.bic,differentAccountHolder:{name:{firstName:e.bankdata.firstName,lastName:e.bankdata.lastName},address:{street:a.trim(),postalCode:e.bankdata.postalCode,city:e.bankdata.city}}},t.put("bankAccount",n)}}}]),app.controller("BillOnlineCtrl",["$scope","billOnlineService","WizardHandler","ErrorService",function(e,t,n,a){
e.isLoading=!1,e.success=!1,e.notificationEmail={},e.setBreadcrumb([{url:"#/meine-rechnungen",title:"Meine Rechnungen"},{url:"#/meine-rechnungen/rechnung-online",title:"Rechnung Online"}]),t.getUserEmail().then(function(t){e.notificationEmail.invoiceNotificationEmail=t.email}),e.billOnline=function(){delete e.errorMessage,e.isLoading=!0,t.billOnline(e).then(function(t){t.code&&(e.isLoading=!1,20510===t.code?n.wizard().goTo(1):n.wizard().next(),e.errorMessage=a.getMessage(t.code)),t.success&&(e.isLoading=!1,e.success=!0,n.wizard().next())},function(){n.wizard().next(),e.isLoading=!1,e.errorMessage=a.getMessage(503)})}}]),app.factory("billOnlineService",["RequestService","AuthService2",function(e,t){function n(n){return t.getCurrentContractDetails().then(function(t){var a=t.getLink("changeInvoiceDelivery");return e.put(a,n)})}return{getUserEmail:function(){return t.getCustomerData()},billOnline:function(e){var t={email:e.notificationEmail.invoiceNotificationEmail};return n(t).then(function(e){return e.data})}}}]),app.controller("BillsCtrl",["$scope","$http","$location","$timeout","$log","$rootScope","$window","billsService","contractsService","RequestService","ErrorService","AuthService2",function(e,t,n,a,r,i,o,s,c,l,d,u){e.setBreadcrumb([{url:"#/meine-rechnungen",title:"Meine Rechnungen"}]),e.isLoading=!0,e.user=u.getUser(),e.username=u.getUser().username,e.userContracts=u.getUser().contracts,e.userContractsSize=_.size(e.userContracts),e.activeContract=u.getUser().getContract(),window.location.href=window.location.protocol+"//"+window.location.host+"/onlineservice/meine-rechnungen";var g=u.getUser(),p={bills:s.getBills(),opos:s.getOpos(),contract:c.getDetails()},f={billsSuccess:function(t){204===t.status?(e.errorMessage=d.getMessage(6e3),e.bills=[],e.countBills=0):t.data.data?(e.bills=t.data.data,e.countBills=t.data.count,e.itemsToShow=3,t.data.data.code&&(e.errorMessage=t.data.data.code)):e.errorMessage=d.getMessage(6e3),e.isLoading=!1,a(function(){$().mdAccordion&&$(".accordion").mdAccordion()})},billsError:function(t){r.error("getBills",t),e.bills=[],e.isLoading=!1,e.errorMessage=d.getMessage(6e3)},oposSuccess:function(t){e.opos=t.data},contractSuccess:function(t){e.contract=t}};g.hasPermission("inkasso")&&(p.inkasso=s.inkasso(),f.inkassoSuccess=function(t){e.inkassoPartner=t.data,e.emptyInkassoPartner=0===e.inkassoPartner.length},f.inkassoError=function(t){e.errorMessage=d.getMessage(t.data.code)}),l.handlePromises(p,f),e.setContract=function(e,t){return t=!0,u.setCurrentContract(e,t)},e.buttonShow=function(){return $(".bills .checkbox:checked").length>1},e.showBillExplanation=function(t){s.showBillExplanation(e,t)},e.setActivePos=function(t){e.activePos=t},e.showMore=function(){e.itemsToShow=e.countBills,a(function(){$().mdAccordion&&$(".accordion").mdAccordion()})},e.showLess=function(){e.itemsToShow=3,a(function(){$().mdAccordion&&$(".accordion").mdAccordion()})},e.downloadMultiple=function(){o.dataLayer.push({event:"gaAuto",eventCategory:"Download",eventAction:"PS - Meine Rechnungen",eventLabel:"Sammeldownload"}),s.downloadBills(e)}}]),app.factory("billsService",["$q","$http","$compile","$timeout","$log","contractsService","UrlService","AuthService2","RequestService",function(e,t,n,a,r,i,o,s,c){function l(){var e=s.getUser(),t=e.getAllowedAction("inkasso");return c.get(t)}function d(){return c.get("bills")}function u(){return s.getCurrentContractDetails().then(function(e){return c.get(e.getLink("opos"))})}function g(){return d()}function p(e){if(w===!1){$(".download-collection a").prop("disabled",!0).addClass("inactive btn-disabled");var t=_.reduce(e.bills,function(e,t){return t.download===!0&&e.push(t.doc),e},[]);return t.length?(f({invoiceList:t.join(",")}),!0):!1}}function f(e){h(e).then(function(t){r.debug("data",t),"waiting"===t?a(function(){f(e)},3e3):m("/dlproxy"+t.zipUri,t.zipId)},function(e){r.error("error while receiving zips",e)})}function m(e,t){r.debug("downloadZipFile",e,t),window.open(e),$(".download-collection a").prop("disabled",!1).removeClass("inactive")}function h(n){var a=e.defer();return t.post("/api/ps/documents/zipped",n).then(function(e){angular.isDefined(e.data.zipState)&&("Ready"===e.data.zipState?a.resolve(e.data):a.resolve("waiting"))},function(e){a.reject(e)}),a.promise}function v(e,a){r.debug("showBillExplanation",a);var o,l,d=$('<div><div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>');jqCustom.Modal.show(d),o=_.findWhere(a.attachedDocs,{extension:"xml"}),l={templateError:function(){throw jqCustom.Modal.hide(),new Error("Failed to load template 'bill-details.html'")},contractError:function(e){throw jqCustom.Modal.hide(),new Error("Failed to load contract.",e)},detailsError:function(e){throw jqCustom.Modal.hide(),new Error("Failed to load details.",e)},done:function(t){if(e.isTalkline=t.contract.value.isTalkline(),!angular.isDefinedDeep(t,"details.value.data.invoicepositions"))throw jqCustom.Modal.hide(),new Error("response.details has no invoiceoptions",t.details);var r=t.details.value.data.invoicepositions;if(!Array.isArray(r))throw new Error("InvoicePositions is no Array",r);e.activePos="",e.invoicePositions=_.reduce(b,function(e,t,n){return r.indexOf(t)>-1&&(e[n]=t),e},{}),_.size(e.invoicePositions)&&(e.activePos=Object.keys(e.invoicePositions)[0]),e.invoicePositionLen=_.size(e.invoicePositions),e.selectedBill=a,jqCustom.Modal.show(n(t.template.value.data)(e))},fail:function(e){throw new Error("Failed to load template and details",e)}},c.handlePromises({template:t.get("/partials/bill-details.html",{cache:!0}),contract:i.getDetails(),details:c.get(["billExplanation",s.getContract(),o.doc])},l)}var b={gg:"Grundgebühr",pp:"Paketpreis",sp:"Service Plus",nt:"Netzinterne Verbindungen (NT)",nx:"Netzexterne Verbindungen (NX)",sd:"Sonstige Dienste (SD)",re:"Eingehende Roaming Verbindungen (RE)",ra:"Abgehende Roaming Verbindungen (RA)",rsms:"Roaming SMS Nachrichten (RSMS)",is:"Internet Starter",apr:"Aufwandspauschale für Rufnummernmitnahme",ml:"mload-Option",mwd:"Mehrwertdienste (MWD)",ru:"Rufumleitungen (RU)",ia:"Auslandsverbindungen",smsa:"SMS ins Ausland (SMSA)",xsms:"Mehrteilige SMS Nachrichten (XSMS)",pr:"Premium Nachrichten",vs:"Verrechnetes Startguthaben",vbs:"Verbleibendes Startguthaben",nsfb:"Sonderdienste Drittanbieter (SIF)"},w=!1;return{inkasso:l,getBills:g,downloadBills:p,showBillExplanation:v,getOpos:u}}]),app.controller("BookingHHPCtrl",["$compile","$log","$http","$rootScope","$sce","$scope","$timeout","$window","WizardHandler","ErrorService","Events","BookingService","AuthService2",function(e,t,n,a,r,i,o,s,c,l,d,u,g){function p(){delete i.errorMessage,delete a.bookingError,(i.shopSearch.postalCode||i.shopSearch.city)&&(i.shopFinder=!0),i.dealers=[],i.isLoadingShops=!0;var e={dealerid:i.bookingData.dealerid,postalCode:i.shopSearch.postalCode,city:i.shopSearch.city};u.getShops(e).then(function(t){var n;e.dealerid?(n=t,i.dealers.push(n)):(n=t,angular.forEach(n,function(e){i.dealers.push(e)})),i.selectShop(i.dealers[0]),0===t.length&&(void 0!==e.postalCode&&(i.errorMessage=l.getMessage(1)),void 0!==e.city&&(i.errorMessage=l.getMessage(2)),void 0===e.city&&void 0===e.postalCode&&(i.errorMessage=l.getMessage(3)),a.bookingError=!0)},function(){i.isLoading=!1,i.errorMessage=l.getMessage(503),a.bookingError=!0})["finally"](function(){i.isLoadingShops=!1}),o(function(){a.isLoadingShops=!1})}function f(){i.themes=[],u.getThemes().then(function(e){delete i.errorMessage,delete a.bookingError,i.isLoading=!1;var t;angular.forEach(e.body,function(e){t={reasonKey:Object.keys(e)[0],reason:e[Object.keys(e)]},i.themes.push(t)}),0===e.body.length&&(i.errorMessage=l.getMessage(503),a.bookingError=!0)},function(){i.isLoading=!1,i.errorMessage=l.getMessage(503),a.bookingError=!0})}var m,h={},v=s.dataLayer;i.loggedIn=g.isLoggedIn()?!0:!1,i.loggedIn?(m=g.getPartyId().split("."),g.getCustomerData().then(function(e){h={salutation:e.name.salutation,name:e.name.lastName,firstname:e.name.firstName,email:e.email,phone:e.phone,customerId:m[1]},i.customer=h})):i.customer={salutation:"",name:"",firstname:"",email:"",phone:"",customerId:""},i.errorMessage=!1,i.isLoading=!0,i.shopFilter="APPOINTMENT",i.shopFinder=!1,i.booked=!1,i.lateEntryShareCard=!1,i.lateEntry=!1,i.bookingData={},i.confirmation={},i.text={},i.themes=[],i.isHhp=!0,i.bookingData.reason="PB",i.getShops=function(e,t){i.shopSearch={postalCode:e,city:t},p()},i.selectShop=function(e){i.isLoading=!0,delete i.errorMessage,delete a.bookingError,i.confirmation.dealer={name:e.name,street:e.street,postal:e.postal,city:e.city},i.dates=[],u.getDates(e.id).then(function(t){i.selectedShop=e.id,i.tempDates=t.body;var n={};angular.forEach(i.tempDates,function(t,a){t=t.date.split("-");var r=new Date(t[0]+"/"+t[1]+"/"+t[2]),o=new Array(7);o[0]="Sonntag",o[1]="Montag",o[2]="Dienstag",o[3]="Mittwoch",o[4]="Donnerstag",o[5]="Freitag",o[6]="Samstag";var s=new Array(12);s[0]="Januar",s[1]="Februar",s[2]="März",s[3]="April",s[4]="Mai",s[5]="Juni",s[6]="Juli",s[7]="August",s[8]="September",s[9]="Oktober",s[10]="November",s[11]="Dezember",day=o[r.getDay()],nday=t[2],s=s[r.getMonth()],year=t[0],n={day:day,nday:nday,month:s,year:year,fulldate:t[0]+"-"+t[1]+"-"+t[2],shop:e.id},i.dates.push(n),0===a&&i.getTimes(n,"PB")}),i.lateEntry||c.wizard().next(),(200!==t.statusCode||0===t.body.length)&&(i.errorMessage=l.getMessage(503),a.bookingError=!0)},function(){i.errorMessage=l.getMessage(503),a.bookingError=!0})["finally"](function(){i.isLoading=!1,i.isDateLoading=!1});var t={10328:"martin.behrendt@md.de",51315:"xenia.miedreich@kochan.de",51759:"filiale3060@shop.md.de",51466:"filiale1642@shop.md.de",51797:"filiale3183@shop.md.de",53876:"filiale3442@shop.md.de",51021:"filiale546@shop.md.de",10239:"filiale851@shop.md.de",51304:"filiale1285@shop.md.de",52120:"franchise1119@shop.md.de",51852:"franchise3376@shop.md.de",51429:"franchise1559@shop.md.de",51589:"filiale2011@shop.md.de"};i.videoDealer=!1,angular.forEach(t,function(t,n){console.log(n+" === "+e.id),n===e.id&&(i.videoDealer=!0)})},i.getTimes=function(e,t){delete i.errorMessage,delete a.bookingError,i.bookingData.dealerid=e.shop,i.bookingData.date=e.fulldate,u.getTimes(e,t).then(function(t){i.isLoading=!1,i.times=t.body;var n,r=i.times[i.times.length-1].split(":");n="30"===r[1]?parseInt(r[0])+1+":00":r[0]+":30",i.times.push(n),i.selectedDate=e,200!==t.statusCode&&(i.errorMessage=l.getMessage(503),a.bookingError=!0)},function(){i.errorMessage=l.getMessage(503),a.bookingError=!0})},o(function(){$(".slick-prev, .slick-next").click(function(){i.getTimes($(".slick-current").attr("date"),"PB")})}),i.dealerid&&!i.reason&&(i.lateEntry=!0,i.bookingData.dealerid=i.dealerid,i.getShops()),i.reason&&(i.lateEntry=!0,i.bookingData.reason=i.reason,i.bookingData.dealerid=i.dealerid,i.bookingData.appointmentBy=i.appointmentBy,i.getShops()),i.getWayOfContact=function(e){i.bookingData.appointmentBy=e},i.takeDate=function(e,t,n,a,r,o){v.push({event:"gaAuto",eventCategory:"Service Prozess",eventAction:"Terminvereinbarung",eventLabel:"Step 2"});var s=!!o;if(!s){var l=r.split(",");r=l[0],o=l[1]}i.confirmation.day=e,i.confirmation.nday=t,i.confirmation.month=n,i.confirmation.year=a,i.confirmation.start=r?r:"",i.confirmation.end=o?o:"",i.bookingData.start=r?r:"",i.bookingData.end=o?o:"",i.reason?c.wizard().goTo(2):(c.wizard().next(),f())},i.bookAppointment=function(){v.push({event:"gaAuto",eventCategory:"Service Prozess",eventAction:"Terminvereinbarung",eventLabel:"Success"});var e="/ajax/baa-videoberatung.php";i.isLoading||(delete i.errorMessage,delete a.bookingError,"VIDEO"!==i.bookingData.appointmentBy?(i.bookingData.cartId="",i.bookingData.text=i.text.remark?i.text.remark:"",i.bookingData.customer=i.customer,u.bookAppointment(i).then(function(e){i.isLoading=!1,i.booked=!0,200!==e.statusCode&&(i.errorMessage=l.getMessage(503),a.bookingError=!0)},function(){i.errorMessage=l.getMessage(503),a.bookingError=!0})):(angular.forEach(i.customer,function(e,t){i.bookingData[t]=e}),n.post(e,i.bookingData,{flush:!1}).then(function(){i.isLoading=!1,i.booked=!0,200!==response.status&&(i.errorMessage=l.getMessage(503),a.bookingError=!0)},function(e){i.errorMessage="Die Terminvereinbarung ist leider fehlgeschlagen. Bitte versuchen Sie es später noch einmal.",a.bookingError=!0})["finally"](function(){vm.isLoading=!1})),c.wizard().next(),$(".modal-theme-body").scrollTop(0))},i.chooseTheme=function(e,t){v.push({event:"gaAuto",eventCategory:"Service Prozess",eventAction:"Terminvereinbarung",eventLabel:"Step 3"}),i.bookingData.reason=e,i.bookingData.reasontitle=""!==t?t:e,i.reason=e,c.wizard().next()},i.goBack=function(){delete i.bookingData.dealerid,delete i.errorMessage,c.wizard().previous()},i.infotabs=function(e,t){$("#id_"+e+" .special-tabs li").hasClass("is-active")?$("#id_"+e+" .special-tabs li."+t).removeClass("is-active"):$("#id_"+e+" .special-tabs li."+t).addClass("is-active"),$("#id_"+e+" div."+t).hasClass("is-visible")?$("#id_"+e+" div."+t).removeClass("is-visible"):$("#id_"+e+" div."+t).addClass("is-visible"),$(".dealer").each(function(){$(this).attr("id")!=="id_"+e&&($(this).find(".special-tabs li").removeClass("is-active"),$(this).fins(".add-content").removeClass("is-visible"))})},i.moreDates=function(){$(".b-dates").toggleClass("is-active"),$(".slick").toggleClass("is-visible");var e=$(".border-bottom").offset().top;$(".modal-theme-body").animate({scrollTop:e},"slow",function(){modalResize()})}}]),app.controller("BookingLayerCtrl",["$element","close","$compile","$log","$http","$rootScope","$sce","$scope","$timeout","WizardHandler","ErrorService","Events","BookingService","AuthService2","LocalStorage","ValueStorage","formdata",function(e,t,n,a,r,i,o,s,c,l,d,u,g,p,f,m,h){function v(){(window.matchMedia&&window.matchMedia("min-width: 701px").matches||700<$(window).width())&&c(function(){$(".modal-theme-body").height($(window).innerHeight()-220)},200)}function b(){if(s.isLoading=!1,s.dealers.length){var e=s.dealers[0].contacts.LOCATION.value.latitude,t=s.dealers[0].contacts.LOCATION.value.longitude;s.shopSearch.selectedDealer=s.dealers[0].id}loadJS([window.location.protocol+"//maps.googleapis.com/maps/api/js?v=3&key=AIzaSyDqZ86MI4Zuk1e9RELTuL-SHg0_MV79KCk&client=gme-mobilcomdebitelgmbh"],function(){y(e,t)})}function w(){delete s.errorMessage,delete i.bookingError,(s.shopSearch.postalCode||s.shopSearch.city)&&(s.shopFinder=!0),s.dealers=[],s.isLoadingShops=!0;var e={dealerid:s.bookingData.dealerid,postalCode:s.shopSearch.postalCode,city:s.shopSearch.city};g.getShops(e).then(function(t){var n;e.dealerid?(n=t,s.dealers.push(n)):(n=t.data,angular.forEach(n,function(e){s.dealers.push(e)})),h.dealerid?s.selectShop(s.dealers[0]):b(),Array.isArray(t.data)?0===t.data.length&&(void 0!==e.postalCode&&(s.errorMessage=d.getMessage(1)),void 0!==e.city&&(s.errorMessage=d.getMessage(2)),void 0===e.city&&void 0===e.postalCode&&(s.errorMessage=d.getMessage(3)),i.bookingError=!0):(s.bookingError=!0,s.errorMessage="Im ausgewählten Shop können keine Termine vereinbart werden.")},function(e){s.isLoading=!1,s.errorMessage=d.getMessage(503),i.bookingError=!0})["finally"](function(){s.isLoadingShops=!1}),c(function(){i.isLoadingShops=!1,v()})}function y(e,t){var n=google.maps,a={disableDefaultUI:!0,zoom:10,mapTypeId:n.MapTypeId.ROADMAP};s.dealers.length?(M=new n.Map(document.getElementById("map-search"),angular.extend({},a,{center:new n.LatLng(e,t)})),n.event.addListenerOnce(M,"idle",function(){k(n,M)})):M=new n.Map(document.getElementById("map-search"),a)}function k(e,t){angular.forEach(s.dealers,function(n){var a,r=new e.Marker({position:{lat:parseFloat(n.contacts.LOCATION.value.latitude),lng:parseFloat(n.contacts.LOCATION.value.longitude)},map:t,icon:"/img/00_home/map-marker.png",animation:google.maps.Animation.DROP});e.event.addListener(r,"click",function(){angular.forEach(A,function(e,t){A[t].close()}),g.getShops(n.id).then(function(n){var i=n.data;angular.forEach(i,function(e){s.thisDealer=e}),a=new e.InfoWindow({content:"<strong>"+s.thisDealer.name+"</strong><br><br>"+s.thisDealer.street+"<br>"+s.thisDealer.postal+" "+s.thisDealer.city}),a.open(t,r),newInfoWindow=A.length,A[newInfoWindow]=a},function(){})}),n.marker=r,n.popup=a}),c(function(){e.event.trigger(t,"resize"),s.selectDealer()})}var C,S={},A=[];s.loggedIn=p.isLoggedIn()?!0:!1,s.loggedIn?(C=p.getPartyId().split("."),p.getCustomerData().then(function(e){S={salutation:e.name.salutation,name:e.name.lastName,firstname:e.name.firstName,email:e.email,phone:e.phone,customerId:C[1]},s.customer=S})):s.customer=h.customer,s.errorMessage=!1,s.isLoading=!0,s.shopFilter="APPOINTMENT",s.shopFinder=!1,s.booked=!1,s.lateEntryShareCard=!1,s.lateEntry=!1,s.stepOneShareCart="processStep-step2",s.stepOne="processStep-step3",s.stepTwo="processStep-step4",s.stepThree="processStep-step5",s.bookingData={},s.confirmation={},s.text={},s.themes=[],s.reason="",s.chooseTheme=function(e,t){s.isLoading=!0,s.bookingData.reason=e,s.bookingData.reasontitle=""!==t?t:e,s.reason=e,s.getShops(),l.wizard().next(),v()};var M;s.selectDealer=function(){delete s.errorMessage,delete i.bookingError;var e=s.shopSearch.selectedDealer;angular.forEach(s.dealers,function(t){t.id===e?(M.panTo(t.marker.getPosition()),t.marker.setMap(null),t.marker=new google.maps.Marker({position:{lat:parseFloat(t.latitude),lng:parseFloat(t.longitude)},map:M,icon:"/img/00_home/map-marker-blue.png",animation:google.maps.Animation.BOUNCE}),c(function(){t.marker.setAnimation(null)},1400)):(t.marker.setIcon("/img/00_home/map-marker.png"),t.marker.setAnimation(null))})},s.getShops=function(e,t){s.shopSearch={postalCode:e,city:t},w()},s.selectShop=function(e){s.isLoading=!0,delete s.errorMessage,delete i.bookingError,s.confirmation.dealer={name:e.name,street:e.street,postal:e.postal,city:e.city},s.dates=[],g.getDates(e.id).then(function(t){s.selectedShop=e.id,s.tempDates=t.body;var n={};angular.forEach(s.tempDates,function(t,a){t=t.date.split("-");var r=new Date(t[0]+"/"+t[1]+"/"+t[2]),i=new Array(7);i[0]="Sonntag",i[1]="Montag",i[2]="Dienstag",i[3]="Mittwoch",i[4]="Donnerstag",i[5]="Freitag",i[6]="Samstag";var o=new Array(12);o[0]="Januar",o[1]="Februar",o[2]="März",o[3]="April",o[4]="Mai",o[5]="Juni",o[6]="Juli",o[7]="August",o[8]="September",o[9]="Oktober",o[10]="November",o[11]="Dezember",day=i[r.getDay()],nday=t[2],o=o[r.getMonth()],year=t[0],n={day:day,nday:nday,month:o,year:year,fulldate:t[0]+"-"+t[1]+"-"+t[2],shop:e.id},s.dates.push(n),0===a&&s.getTimes(n,s.reason)}),s.lateEntry||l.wizard().next(),(200!==t.statusCode||0===t.body.length)&&(s.errorMessage=d.getMessage(503),i.bookingError=!0)},function(){s.errorMessage=d.getMessage(503),i.bookingError=!0})["finally"](function(){s.isLoading=!1,s.isDateLoading=!1});var t={10328:"martin.behrendt@md.de",51315:"xenia.miedreich@kochan.de",51759:"filiale3060@shop.md.de",51466:"filiale1642@shop.md.de",51797:"filiale3183@shop.md.de",53876:"filiale3442@shop.md.de",51021:"filiale546@shop.md.de",10239:"filiale851@shop.md.de",51304:"filiale1285@shop.md.de",52120:"franchise1119@shop.md.de",51852:"franchise3376@shop.md.de",51429:"franchise1559@shop.md.de",51589:"filiale2011@shop.md.de"};s.videoDealer=!1,angular.forEach(t,function(t,n){n===e.id&&(s.videoDealer=!0)})},s.getTimes=function(e,t){delete s.errorMessage,delete i.bookingError,s.bookingData.dealerid=e.shop,s.bookingData.date=e.fulldate,g.getTimes(e,t).then(function(n){s.isLoading=!1,s.times=n.body;var r,o=s.times[s.times.length-1].split(":");a.debug("reason",t),r="ESP60"!==t?"30"===o[1]?parseInt(o[0])+1+":00":o[0]+":30":"30"===o[1]?parseInt(o[0])+1+":30":parseInt(o[0])+1+":00",a.debug("lastEndItem",r),s.times.push(r),s.selectedDate=e,200!==n.statusCode&&(s.errorMessage=d.getMessage(503),i.bookingError=!0)},function(){s.errorMessage=d.getMessage(503),i.bookingError=!0}),c(function(){v()})},c(function(){$(".slick-prev, .slick-next").click(function(){s.getTimes($(".slick-current").attr("date"),s.reason)})}),h.cartId&&(s.bookingData.reason="PB",h.dealerid&&""===h.dealerid||(s.lateEntryShareCard=!0,s.stepOneShareCart="processStep-step1",s.stepOne="processStep-step2",s.stepTwo="processStep-step3",s.stepThree="processStep-step4",s.getShops())),h.dealerid&&(s.lateEntry=!0,s.stepOne="processStep-step1",s.stepTwo="processStep-step2",s.stepThree="processStep-step3",s.bookingData.dealerid=h.dealerid,s.getShops()),s.getWayOfContact=function(e){s.bookingData.appointmentBy=e},s.takeDate=function(e,t,n,a,r,i){var o=!!i;if(!o){var c=r.split(",");r=c[0],i=c[1]}s.confirmation.day=e,s.confirmation.nday=t,s.confirmation.month=n,s.confirmation.year=a,s.confirmation.start=r?r:"",s.confirmation.end=i?i:"",s.bookingData.start=r?r:"",s.bookingData.end=i?i:"",l.wizard().next(),$(".modal-theme-body").scrollTop(0),v()},s.bookAppointment=function(){var e="/ajax/baa-videoberatung.php";s.isLoading||(delete s.errorMessage,delete i.bookingError,s.bookingData.text=s.text.remark?s.text.remark:"","VIDEO"!==s.bookingData.appointmentBy?(s.bookingData.cartId=h.cartId?h.cartId:"",s.bookingData.customer=s.customer,void 0!==h.presave?(s.isLoading=!1,f.set(m.confirmation,s.confirmation),f.set(m.bookingData,s.bookingData),i.$broadcast(u.changeBookingData),s.presave=!0):g.bookAppointment(s).then(function(e){s.isLoading=!1,s.booked=!0,200!==e.statusCode&&(s.errorMessage=d.getMessage(503),i.bookingError=!0)},function(){s.errorMessage=d.getMessage(503),i.bookingError=!0})):(angular.forEach(s.customer,function(e,t){s.bookingData[t]=e}),r.post(e,s.bookingData,{flush:!1}).then(function(){s.isLoading=!1,s.booked=!0,200!==response.status&&(s.errorMessage=d.getMessage(503),i.bookingError=!0)},function(e){s.errorMessage="Die Terminvereinbarung ist leider fehlgeschlagen. Bitte versuchen Sie es später noch einmal.",i.bookingError=!0})["finally"](function(){vm.isLoading=!1})),l.wizard().next(),$(".modal-theme-body").scrollTop(0))},s.close=t,s.goBack=function(){delete s.bookingData.dealerid,delete s.errorMessage,l.wizard().previous()},s.infotabs=function(e,t){$("#id_"+e+" .special-tabs li").hasClass("is-active")?$("#id_"+e+" .special-tabs li."+t).removeClass("is-active"):$("#id_"+e+" .special-tabs li."+t).addClass("is-active"),$("#id_"+e+" div."+t).hasClass("is-visible")?$("#id_"+e+" div."+t).removeClass("is-visible"):$("#id_"+e+" div."+t).addClass("is-visible"),$(".dealer").each(function(){$(this).attr("id")!=="id_"+e&&($(this).find(".special-tabs li").removeClass("is-active"),$(this).fins(".add-content").removeClass("is-visible"))})},s.moreDates=function(){$(".b-dates").toggleClass("is-active"),$(".slick").toggleClass("is-visible");var e=$(".border-bottom").offset().top;$(".modal-theme-body").animate({scrollTop:e},"slow",function(){v()})},g.getThemes().then(function(e){delete s.errorMessage,delete i.bookingError,s.isLoading=!1;var t;angular.forEach(e.body,function(e){if(t={reasonKey:Object.keys(e)[0],reason:e[Object.keys(e)]},s.themes.push(t),h.reason)switch(s.bookingData.reason=h.reason,h.reason){default:s.shopFilter="APPOINTMENT"}}),0===e.body.length&&(s.errorMessage=d.getMessage(503),i.bookingError=!0)},function(){s.isLoading=!1,s.errorMessage=d.getMessage(503),i.bookingError=!0})}]),app.controller("BookingCtrl",["$compile","$element","$http","$log","$sce","$scope","$attrs","$rootScope","$timeout","Events","BookingService","LocalStorage","UrlService","ModalService","ValueStorage",function(e,t,n,a,r,i,o,s,c,l,d,u,g,p,f){var m=Math.random().toString(36).slice(2),h=o.bsSave,v=o.bsPreview,b=o.bsPresave,w={reason:o.bsType,cartId:o.bsCart,dealerid:o.bsShop,presave:o.bsPresave,customer:{salutation:o.bsPdSalutation?o.bsPdSalutation:"",name:o.bsPdLastname?o.bsPdLastname:"",firstname:o.bsPdFirstname?o.bsPdFirstname:"",email:o.bsPdMail?o.bsPdMail:"",phone:o.bsPdPhone?o.bsPdPhone:"",customerId:""}},y="/partials/book-an-appointment/booked.html",k="/partials/book-an-appointment/presave.html";if(void 0!==o.bsLinktextEdit&&t.html(o.bsLinktextBook),s.loadedCSS||(s.loadedCSS={}),void 0!==h)return u.get(f.bookingData)?(i.bookingData=u.get(f.bookingData),i.confirmation=u.get(f.confirmation),void d.bookAppointment(i).then(function(){n.get(y).then(function(n){t.html(e(n)(i))})})):void t.remove();if(void 0!==v){if(!u.get(f.confirmation))return void t.remove();u.get(f.confirmation)&&(i.confirmation=u.get(f.confirmation),n.get(k).then(function(n){void 0!==t.attr("bs-preview")&&t.replaceWith(e(n)(i))}))}void 0!==b&&s.$on(l.changeBookingData,function(){u.get(f.confirmation)?(void 0!==o.bsLinktextEdit&&t.html(o.bsLinktextEdit),i.confirmation=u.get(f.confirmation),n.get(k).then(function(n){void 0!==t.attr("bs-presave")&&(0===t.parent(".date-wrapper").length&&t.wrap("<div class='date-wrapper'></div>"),0===$(".bookingservice.confirm").length&&t.parent(".date-wrapper").prepend(e(n)(i)))})):void 0!==o.bsLinktextEdit&&t.html(o.bsLinktextBook)}),c(function(){t.on("click",function(e){e.preventDefault(),w={reason:o.bsType,cartId:o.bsCart,dealerid:o.bsShop,presave:o.bsPresave,customer:{salutation:$("[bs-presave]").attr("bs-pd-salutation"),name:$("[bs-presave]").attr("bs-pd-lastname"),firstname:$("[bs-presave]").attr("bs-pd-firstname"),email:$("[bs-presave]").attr("bs-pd-mail"),phone:$("[bs-presave]").attr("bs-pd-phone"),customerId:""}},void 0!==t.attr("bs-presave")&&(s.bookingElement=t),$(".bookingservice.confirm").remove(),d.reset();var n,r;$('link[rel=stylesheet][href*="main.min.css"]').length?r=$('link[rel=stylesheet][href*="main.min.css"]')[0].href.split("main.min.css"):$('link[rel=stylesheet][href*="main.css"]').length&&(r=$('link[rel=stylesheet][href*="main.css"]')[0].href.split("main.css")),r&&r.length&&(n=r[0]+"pages/book-an-appointment.min.css"),p.showModal({templateUrl:"/partials/book-an-appointment/start.html",controller:"BookingLayerCtrl",inputs:{formdata:w}}).then(function(e){angular.element(document).scope().bookingError&&(m=""),$("body").addClass("modal-is-open"),jqCustom.Modal.show(e.element),e.close["finally"](function(){$("body").removeClass("modal-is-open"),jqCustom.Modal.hide()}),s.loadedCSS.bookAnAppointment||(window.loadCSS(n,window.document.getElementsByTagName("script")[0],"all"),s.loadedCSS.bookAnAppointment=n)},function(e){a.error("showModal",e)})})})}]),app.directive("appMdBookingservice",function(){return{controller:"BookingCtrl",controllerAs:"booking",restrict:"A",scope:{type:"@appMdBookingservice"}}}),app.directive("appMdOnbookingpresave",["$rootScope","Events","LocalStorage","ValueStorage",function(e,t,n,a){function r(e,t,r){n.get(a.bookingData)?t[0].style.display=r?"block":"none":t[0].style.display=r?"none":"block"}return{restrict:"A",link:function(n,a,i){var o=i.appMdOnbookingpresave&&"show"===i.appMdOnbookingpresave;r(n,a,o),e.$on(t.changeBookingData,function(){r(n,a,o)})}}}]),app.directive("appMdBaaSlickGallery",["$timeout",function(e){return{restrict:"A",link:function(t,n,a){e(function(){var e,r=$(n),i=t.$eval(a.appMdBaaSlickGallery);e="DIV"===r.prop("tagName")?r.find("div"):r.find("li"),i.slidesToShow&&i.slidesToShow>e.length&&(i.slidesToShow=e.length),e.length>1&&loadJS(["/inc/scripts/vendor/slick/slick.min.js"],function(){$(n).slick(i),setTimeout(function(){$(".slick-next, .slick-prev").click(function(){setTimeout(function(){$(".slick-current h3").trigger("click")},400)})},400)},!0,!0)})}}}]),app.filter("halfAnHourTimeSlot",function(){return function(e,t){if(void 0!==e){var n=e.split(":")[1],a=e.split(":")[0];return"ESP60"!==t?"30"===n?parseInt(a)+1+":00":a+":30":"30"===n?parseInt(a)+1+":30":parseInt(a)+1+":00"}}}),app.filter("makeDayFromNumber",function(){return function(e){if(void 0!==e){var t={1:"Montag",2:"Dienstag",3:"Mittwoch",4:"Donnerstag",5:"Freitag",6:"Samstag",7:"Sonntag"};return t[e]}}}),app.filter("formatTime",function(){return function(e){if(void 0!==e){var t=e.slice(0,2),n=e.slice(2,4);return t+":"+n}}}),app.factory("BookingService",["$compile","$log","$q","$rootScope","$http","Events","LocalStorage","RequestService","ValueStorage","ENVIRONMENT","api",function(e,t,n,a,r,i,o,s,c,l,d){function u(){var e=n.defer();return s.get("getThemes").then(function(t){t.data&&t.data.data&&404===t.data.data.statusCode?e.reject():e.resolve(t.data.data)},e.reject),e.promise}function g(e){var t=n.defer();delete r.defaults.headers.common.Authorization,r.defaults.withCredentials=!1;var a={postalCode:e.postalCode,city:e.city};return s.get(["getShops",l.apiUrl,e.dealerid?e.dealerid:""],a).then(function(e){console.log("getShopsService",e),t.resolve(e.data)},t.reject),t.promise}function p(e){var t=n.defer();return s.get(["getDates",e]).then(function(e){t.resolve(e.data.data)},t.reject),t.promise}function f(e,t){var a=n.defer();return s.get(["getTimes",e.shop,e.fulldate,t]).then(function(e){a.resolve(e.data.data)},a.reject),a.promise}function m(e){var t=n.defer();return s.post("bookAppointment",e.bookingData).then(function(e){t.resolve(e.data.data),o.rm(c.bookingData)},t.reject),t.promise}function h(){o.rm(c.bookingData),o.rm(c.confirmation),a.$broadcast(i.changeBookingData)}var v=window.location.href.indexOf("www.");return v>-1?d.initBookAnAppointment("X-API-KEY","0mLVljinIwx4VFikY6hsFmNZJolWexCJ"):d.initBookAnAppointment("X-API-KEY","XkJhueSOzmbG23Zk67yVJ1ZpDwYGOofV"),{getThemes:u,getShops:g,getDates:p,getTimes:f,bookAppointment:m,reset:h}}]),app.controller("ChatCtrl",["$element","$location","$log","$sce","$scope","$timeout","$window","AuthService2","ChatModel","ChatService","ErrorService","LocalStorage","UrlService","ValueStorage",function(e,t,n,a,r,i,o,s,c,l,d,u,g,p){function f(e,t){y&&(e&&(m(),h()),k||t?(document.body.classList.remove("chat--body"),h(!0),t&&m(!0)):(document.body.classList.add("chat--body"),h()))}function m(e){e?o.removeEventListener("orientationchange",h):o.addEventListener("orientationchange",h)}function h(t){var n=e.find(".chat-content");!0===t?n.removeAttr("style"):k||n.height(o.innerHeight-e.find(".chat-header").outerHeight())}function v(){S.url=a.trustAsResourceUrl(C)}var b,w,y=$("html").hasClass("ios"),k=!1,C=g.getUrl("chatClient"),S=this;S.isAuthenticated=!1,S.count="",S.currentPage=o.location.href,S.showStates=0,S.startProspectChat=function(){v(),S.isAuthenticated=!0},S.minimize=function(){e.toggleClass("is-minimized"),k=!k,c.resetCounter(),S.count="",f()},S.close=function(){f(!1,!0),l.closeChat(!0)},f(!0),b=u.get(p.chatOptions),s.isLoggedIn()||u.get(p.chatSession)?(S.isAuthenticated=!0,v()):(b?r.$on("modalLoginReady",function(){i(function(){"prospect"===b.type||b.cartId?S.startProspectChat():(S.showStates=1,e.find("[modal-login]").click())})}):S.showStates=2,w=r.$watch(s.isLoggedIn,function(e){S.isAuthenticated=e,e&&(v(),w())})),r.$on("logout",function(){l.closeChat()}),o.addEventListener("storage",function(){var e=u.get(p.chatCounter)||0;k&&(S.count=e?"("+e+")":"")})}]),app.directive("appMdLivechat",function(){return{controller:"ChatCtrl",controllerAs:"chat",restrict:"A",templateUrl:"/partials/chatclient/chat-directive.html"}}),app.directive("appMdChat",["$log","$rootScope","AuthService2","ChatService","Events","LocalStorage","ValueStorage",function(e,t,n,a,r,i,o){function s(e,t){var n=i.get(o.chatStatus);n&&($(e,t).css("display",""),0!==n.statusCode?e.hide():n.open||(t=t===e?e:t,t.hide()))}return{restrict:"A",scope:{type:"@chatType",cartId:"@chatCart",controls:"@chatControl"},link:function(e,t){var i=t;e.controls&&(i=t.find(e.controls)),i.on("click",function(t){t.preventDefault(),a.initChat({type:e.type,cartId:e.cartId})}),s(t,i),e.$on(r.chatStatus,function(){s(t,i)}),n.isAnonymous()||n.isBusiness()||n.isProspect()||n.getCurrentContractDetails().then(function(e){e.hasPermission("chat")||t.remove()})}}}]),app.run(["ChatService","LocalStorage","ValueStorage",function(e,t,n){t.get(n.chatSession)&&e.initChat()}]),app.factory("ChatService",["$compile","$log","$q","$rootScope","$window","AuthService2","ChatModel","LocalStorage","RequestService","UserModel","ValueStorage",function(e,t,n,a,r,i,o,s,c,l,d){function u(e){v(e),y=y||g()}function g(){return w=angular.element('<aside class="chat" app-md-livechat></aside>'),e(w)(a),$(".pushmenu-wrapper").append(w),
!0}function p(){var e,t="height=480,width=640,left=50,top=50",n=s.get(d.chatSession),a=s.get(d.chatUsers);!n||a&&2!==a||(e=r.open("","_blank",t),e.document.write("Bitte warten Sie einen Moment ..."),c.get("chatKza",null,{headers:{"x-chat-session":n}}).then(function(t){e.location.href=t.data.linkUrl},function(){e.close()}))}function f(e){w.length&&w.remove(),e&&p(),o.endChat(),y=!1}function m(e){var t,n="prospect";return i.isLoggedIn()&&e&&(t=i.getUser(),i.isBusiness()||t.isAdmin()?n="business":e.isCredit()||e.isDom()?n="credit":e.isPrepaid()&&(n="prepaid")),b(n)}function h(){return s.get(d.chatOptions)}function v(e){e?(s.set(d.chatOptions,e),e.type?b(e.type):m()):s.rm(d.chatOptions)}function b(e){var t=n.defer();return c.get(["chatStatus",e]).then(function(e){s.set(d.chatStatus,e.data),t.resolve(e.data)},function(){t.reject()}),t.promise}var w=[],y=!1;return{checkStatus:m,closeChat:f,getOptions:h,initChat:u}}]),app.factory("ChatAdapter",["$q","$http","AuthService2","ChatHelper","ChatSettings","LocalStorage","RequestService","ValueStorage",function(e,t,n,a,r,i,o,s){var c={baseUrl:r.chatServerBaseUrl,RequestFaultText:"Request invalid ",ResultFaultText:"Response invalid ",MessageType:{ParticipantJoined:"ParticipantJoined",TypingStarted:"TypingStarted",Message:"Message",TypingStopped:"TypingStopped",ParticipantLeft:"ParticipantLeft",Notice:"Notice",Client:"Client"},StatusCode:{Closed:4001,Unauthorized:4010}};return c.getSubjects=function(t){var n=e.defer(),a=i.get(s.chatStatus);return a&&o.get(["chatSubjects",t]).then(function(e){n.resolve(e.data)},function(){n.reject()}),n.promise},c.beginChat=function(t,r){var i=e.defer(),s=n.isLoggedIn()?"chatStartAuth":"chatStart";return a.isBlank(t)?i.reject(a.fault(c.RequestFaultText+"(nickname)")):a.isBlank(r)?i.reject(a.fault(c.RequestFaultText+"(subject)")):o.post(s,{nickname:t,subject:r},{flush:!1}).then(function(e){a.isBlank(e.data.sessionId)?i.reject(a.fault(c.ResultFaultText+"(sessionId)")):a.isBlank(e.data.chatId)?i.reject(a.fault(c.ResultFaultText+"(chatId)")):angular.isArray(e.data.messages)?isNaN(e.data.messages[0].index)?i.reject(a.fault(c.ResultFaultText+"(index)")):i.resolve(e.data):i.reject(a.fault(c.ResultFaultText+"(messages)"))},function(){i.reject()}),i.promise},c.getMessageEvents=function(t,n,r){var i=e.defer();return a.isBlank(t)?i.reject(a.fault(c.RequestFaultText+"(chatId)")):isNaN(r)||0>=r?i.reject(a.fault(c.RequestFaultText+"(index)")):o.get(["getMessages",t],{index:r},{flush:!1,headers:{"x-chat-session":n}}).then(function(e){void 0===e.data?i.reject(a.fault(c.ResultFaultText)):angular.isArray(e.data.messages)?(void 0===e.data.chatEnded&&(e.data.chatEnded=!1),i.resolve(e.data)):i.reject(a.fault(c.ResultFaultText+"(messages)"))},function(){i.reject()}),i.promise},c.sendMessage=function(t,n,r){var i=e.defer();return a.isBlank(r)?i.reject(a.fault(c.RequestFaultText+"(text)")):o.post(["postMessages",t],{text:r.replace(/\n/g," ")},{flush:!1,headers:{"x-chat-session":n}}).then(function(e){void 0===e.data||0!==e.data.statusCode?i.reject(a.fault(c.ResultFaultText)):i.resolve({ok:!0})},function(){i.reject()}),i.promise},c.endChat=function(t){var n,r=e.defer();return a.isBlank(t)?r.reject(a.fault(c.RequestFaultText+"(sessionId)")):(n=t.split(":")[0],o.del(["postMessages",n],{flush:!1,headers:{"x-chat-session":t}}).then(function(e){e.chatEnded?r.resolve({ok:!0}):r.reject(a.fault(c.ResultFaultText))},function(e,t){r.reject(a.fault(e,t))})),r.promise},c}]),app.controller("ChatActiveCtrl",["$log","$scope","$timeout","ChatHelper","ChatModel","ChatAdapter",function(e,t,n,a,r,i){function o(){r.isChatActive()&&i.getMessageEvents(r.chatId,r.sessionId,r.index).then(function(e){e.messages.length&&(r.index=e.messages.reverse()[0].index+1,r.processMessageEvents(e.messages.reverse(),e.chatEnded)),e.chatEnded===!0&&r.endChat(!0),t.errorTracker(!0)},function(n){t.errorTracker(!1),e.debug("Error:",n)}),n(o,5e3)}t.form={locked:!1,text:void 0},t.errorTrackerCount=0,t.isActive=function(){return void 0!==r.sessionId},t.isEnded=function(){return r.chatEnded===!0},t.getParticipants=function(){return r.participants},t.getMessages=function(){return r.messages},t.getPlaceholderText=function(){return r.chatEnded===!0?"(Der Chat wurde beendet.)":"Geben Sie hier Ihre Nachricht ein."},o(),t.textareaKeypress=function(e){var n=e.keyCode||e.which;13!==n||e.shiftKey||(e.stopPropagation(),e.preventDefault(),t.sendMessage())},t.focusTXA=function(){$("#TXA").focus()},t.sendMessage=function(){r.isChatActive()&&!a.isBlank(t.form.text)&&(t.form.locked=!0,i.sendMessage(r.chatId,r.sessionId,t.form.text).then(function(){r.addMessage(r.nickname,t.form.text,r.MessageKind.OwnMessage),t.form.text=void 0,t.form.locked=!1,t.errorTracker(!0),n(t.focusTXA,100)},function(a){r.addMessage("system","Die Nachricht konnte nicht gesendet werden.",r.MessageKind.Error),t.form.locked=!1,t.errorTracker(!1),n(t.focusTXA,100),e.debug("Error:",a)}))},t.endChat=function(){r.endChat()},t.errorTracker=function(e){e===!1?t.errorTrackerCount+=1:t.errorTrackerCount=0,t.errorTrackerCount>5&&(r.addMessage("system","Verbindung zum Chat-Server verloren.",r.MessageKind.Error),r.endChat())}}]),app.controller("ChatOnlineCtrl",["$log","$scope","ChatHelper","ChatModel","ChatAdapter","AuthService2","ErrorService","LocalStorage","ValueStorage",function(e,t,n,a,r,i,o,s,c){var l=this;l.isLoading=!0,l.hideNickname=!1,l.nickname="",i.isLoggedIn()&&(l.hideNickname=!0,l.nickname=i.getUser().username),l.isOnline=function(){return void 0===a.sessionId&&a.chatAvailable===!0},l.isOffline=function(){return void 0===a.sessionId&&a.chatAvailable===!1},l.getOfflineText=function(){return a.offlineText},l.isErrorState=function(){return void 0!==l.errorMessage},l.isErrorWarning=function(){return void 0!==l.errorMessage},l.getErrorText=function(){return l.errorMessage},l.getSubjects=function(){return a.subjects},l.beginChat=function(t){l.isLoading=!0,l.isErrorState()||void 0===t||n.isBlank(t.text)||r.beginChat(l.nickname,t.target).then(function(t){var n,i=s.get(c.chatOptions);l.isLoading=!1,a.sessionId=t.sessionId,a.chatId=t.chatId,s.set(c.chatSession,a.sessionId),s.set(c.chatId,a.chatId),a.nickname=t.messages[0].from.nickname,a.index=t.messages[0].index,a.chatEnded=!1,a.setParticipant(a.nickname,!0),a.processMessageEvents(t.messages),e.debug("Chat: active"),i&&i.cartId&&(n="Meine Warenkorb-Id lautet: "+i.cartId,r.sendMessage(a.chatId,a.sessionId,n).then(function(){a.addMessage(a.nickname,n)}))},function(t){l.isLoading=!1,e.error(t),l.errorMessage=o.getMessage("unavailable","chat"),e.debug("Inactive")})},t.$on("chat.subjects",function(t,n){var a=s.get(c.chatOptions);e.debug("chat subjects erfolgreich geladen"),n.message?l.errorMessage=n.message:n.subjects&&0!==n.subjects.length?a&&a.cartId&&(l.hideNickname||(l.nickname="Gast"),l.beginChat({target:"SALES_NO",text:"Warenkorb teilen"})):l.errorMessage=o.getMessage("subjects","chat"),l.isLoading=!1})}]),app.directive("scroll",["$timeout",function(e){return{restrict:"A",link:function(t,n,a){t.$watchCollection(a.scroll,function(){e(function(){n[0].scrollTop=n[0].scrollHeight},200)})}}}]),app.factory("ChatHelper",function(){var e={DefaultFaultStatus:400,DefaultFaultText:"Ein Fehler ist aufgetreten."};return e.isBlank=function(e){return void 0===e?!0:"string"!=typeof e?!0:0===e.trim().length},e.fault=function(t,n){return n=isNaN(n)||100>n?e.DefaultFaultStatus:n,t=void 0===t?e.DefaultFaultText:t,"string"==typeof t?{fault:{status:n,text:t}}:void 0!==t.fault?("string"==typeof t.fault&&(t.fault={text:t.fault}),e.isBlank(t.fault.text)&&(t.fault.text=e.DefaultFaultText),isNaN(t.fault.status)&&(t.fault.status=n),t):e.isBlank(t.text)?{fault:{status:n,text:e.DefaultFaultText}}:(t.fault={text:t.text},t.fault.status=n,t)},e}),app.factory("ChatModel",["$log","$window","ChatHelper","ChatAdapter","LocalStorage","ValueStorage",function(e,t,n,a,r,i){function o(e){var t=r.get(i.chatCounter)||0;r.set(i.chatCounter,e?0:t+1)}var s,c={MessageKind:{Message:0,Notice:6,SystemMessage:1,MasterMessage:2,OwnMessage:3,Typing:4,Time:5,Error:9},cartId:null,subjects:void 0,chatAvailable:void 0,sessionId:void 0,nickname:void 0,messages:void 0,index:void 0,chatEnded:!1},l=!1;return c.resetCounter=function(){o(!0)},c.setParticipant=function(e,t,a,o){if(!n.isBlank(e)&&"system"!==e&&"mobilcom"!==e){void 0===c.participants&&(c.participants={},c.participantsCount=0);var s=c.participants[e];t?(void 0===s&&(s={nickname:e,typing:!1},c.participants[e]=s,c.addMessage("system",e+" hat den Chat betreten.",c.MessageKind.SystemMessage,null,!0),r.set(i.chatUsers,++c.participantsCount)),void 0!==a&&(s.typing=a===!0)):void 0!==s&&(delete c.participants[e],c.addMessage("system",e+" hat den Chat "+(o?"verlassen.":"weitergeleitet."),c.MessageKind.SystemMessage))}},c.addMessage=function(e,t,a,r,i){c.messages||(c.messages=[]),n.isBlank(e)||n.isBlank(t)||(a||(a=c.MessageKind.Message),r||(r=(new Date).getTime()),a===c.MessageKind.Message&&o(),c.messages.length&&c.MessageKind.Typing===c.messages[c.messages.length-1].kind&&c.messages.pop(),i||((!s||r-s>6e4)&&c.messages.push({kind:c.MessageKind.Time,time:r}),s=r),c.messages.push({kind:a,nickname:e,text:t,time:r}))},c.processMessageEvents=function(e,t){if(angular.isArray(e))for(var r,i,o=0;o<e.length;o++)if(void 0!==(r=e[o])){if(r.from.nickname===c.nickname&&l)continue;switch(r.type){case a.MessageType.ParticipantJoined:c.setParticipant(r.from.nickname,!0);break;case a.MessageType.TypingStarted:c.setParticipant(r.from.nickname,!0,!0),c.addMessage(r.from.nickname,r.from.nickname+" schreibt ...",c.MessageKind.Typing,r.utcTime,!0);break;case a.MessageType.Message:case a.MessageType.Notice:r.from.type!==a.MessageType.Client||c.nickname||(c.nickname=r.from.nickname),i=r.from.nickname===c.nickname?c.MessageKind.OwnMessage:"system"===r.from.nickname?c.MessageKind.SystemMessage:"mobilcom"===r.from.nickname?c.MessageKind.MasterMessage:r.type===a.MessageType.Notice?c.MessageKind.Notice:c.MessageKind.Message,n.isBlank(r.text)||(r.type===a.MessageType.Notice&&r.text.indexOf("http")<0&&(r.text="http://"+r.text),c.setParticipant(r.from.nickname,!0,!1),c.addMessage(r.from.nickname,r.text,i,r.utcTime));break;case a.MessageType.TypingStopped:c.setParticipant(r.from.nickname,!0,!1);break;case a.MessageType.ParticipantLeft:c.setParticipant(r.from.nickname,!1,!1,t)}}l=!0},c.endChat=function(t){if(e.debug("ending ..."),c.isChatActive()){t!==!0&&a.endChat(c.sessionId);var n,o,s=[];for(n in c.participants)c.participants.hasOwnProperty(n)&&s.push(n);for(o=0;o<s.length;o++)c.setParticipant(s[o],!1,!1,!0);c.addMessage("system","Der Chat wurde beendet.",c.MessageKind.SystemMessage),c.chatEnded=!0}else a.endChat(r.get(i.chatSession));r.rm(i.chatId),r.rm(i.chatOptions),r.rm(i.chatSession),r.rm(i.chatStatus),r.rm(i.chatUsers),c.cartId=null},c.isChatActive=function(){return void 0!==c.sessionId&&c.chatEnded!==!0},c}]),app.run(["$log","$rootScope","$timeout","AuthService2","ChatHelper","ChatModel","ChatAdapter","LocalStorage","ValueStorage",function(e,t,n,a,r,i,o,s,c){function l(e){o.getSubjects(e).then(function(e){i.subjects=e.subjects||{},e.subjects&&s.set(c.chatSubjects,e.subjects),t.$broadcast("chat.subjects",e)})}var d=s.get(c.chatStatus),u=s.get(c.chatSubjects),g=s.get(c.chatSession),p=s.get(c.chatOptions),f="prospect";d&&d.open?(i.chatAvailable=!0,e.debug("Chat Online")):(i.offlineText="Bitte versuchen Sie es zu einem späteren Zeitpunkt noch einmal.",i.chatAvailable=!1,e.debug("Chat Offline")),g?(i.sessionId=g,i.chatId=g.split(":")[0],i.subjects=u,i.index=2,n(function(){t.$broadcast("chat.subjects",{})})):(p&&p.cartId&&(i.cartId=p.cartId),a.isLoggedIn()&&!a.isProspect()?a.getCurrentContractDetails().then(function(t){var n=a.getUser();e.debug("Chat user",t),a.isBusiness()||n.isAdmin()?f="business":t.isCredit()||t.isDom()?f="credit":t.isPrepaid()&&(f="prepaid"),l(f)},function(){l(f)}):l(f))}]),app.factory("ChatSettings",function(){return{chatServerBaseUrl:"/cim/customer/chat"}}),app.controller("contactAssistantCtrl",["$log","$sce","$http","$window","$scope","AuthService2","ContactService","sabioService",function(e,t,n,a,r,i,o,s){function c(e,n){n.content[0]=t.trustAsHtml(n.content[0]),e.answer=n}function l(t,n){e.debug("_handleRateSuccess",n),t.rate=n}var d,u;r.isLoading=!1,r.isLoadingFaqs=!1,r.isLoadingAnswer=!1,r.faqLimit=3,r.form={category:"",topic:""},r.$watch("form",function(e,t){t!==e&&(v(),m())},!0);var g=function(){if(i.isLoggedIn()){d="prospect";var e=i.getUser();e.activeContract?i.getCurrentContractDetails().then(function(t){i.isBusiness()||e.isAdmin()?d="business":t.isCredit()?d="credit":t.isDom()?d="dls":t.isPrepaid()&&(d="prepaid"),i.getCustomerData().then(function(e){u=e,r.show=u.getLink("contactFormDunningLevel")||u.getLink("contactFormInstallmentPayment")?!0:!1,p(r.show,d,t.msisdn,t.contractId)},function(){r.show=!1})["finally"](function(){r.isLoading=!1})}):p(r.show,d,"","")}else/interessenten/.exec(window.location)&&(treeid="interessentenIndex",p(!1,"prospect","","")),/digitale-welt/.exec(window.location)&&p(!1,"dls","",""),/prepaid/.exec(window.location)&&p(!1,"prepaid","",""),/vertragskunden/.exec(window.location)&&p(!1,"credit","",""),/business/.exec(window.location)&&p(!1,"business","","")},p=function(){r.isLoading=!0,s.getTree("rlam1rhkdrud").then(f,function(){r.showForm=!1})["finally"](function(){r.isLoading=!1})},f=function(t){e.debug("_parseContactCategories",t);var n=s.parseContactCategories(t);r.contactMainCategories=n.categories,r.contactCategories=n.topics,r.form.category=n.currentCategory,r.form.topic=n.currentTopic},m=function(){var e=o.setCookieValue("contactCategory",r.form.category?r.form.category.id:null),t=o.setCookieValue("contactTopic",r.form.topic?r.form.topic.id:null);e&&(r.isContactRoot===!1?a.location.href="/kontakt/"+h()+"/":"Rücksendung Formulare"===r.form.category&&(a.location.href="/kontakt/"+h()+"/uns-schreiben/")),t&&r.$root.$broadcast("contactTopicChange",r.form.topic)},h=function(){var e,t=window.location.href;return e=t.substr(t.indexOf("kontakt/")+8),e=e.substr(0,e.indexOf("/"))},v=function(){""===r.form.category||null===r.form.category?(r.hideFaqs=!0,r.form.topic=null):""!==r.form.topic&&null!==r.form.topic&&(r.hideFaqs=!1,r.faqs=r.form.topic.children,!r.faqs.length&&r.isContactRoot&&(a.location.href="/kontakt/"+h()+"/mit-uns-sprechen/"))};r.loadAnswer=function(e){e.answer||(r.isLoadingAnswer=!0,s.getAnswerForQuestion(e.id).then(function(t){c(e,t)},console.error)["finally"](r.isLoadingAnswer=!1))},r.setRating=function(e,t){e.rate||s.setRating(e.id,t).then(function(t){l(e,t)},console.error)},g()}]),app.controller("CallbackCtrl",["$scope","$log","AuthService2","CallbackService","ContactService","contractsService","sabioService","dataService",function(e,t,n,a,r,i,o,s){var c;e.slotsAvailable=!1,e.slotsLoaded=!1,e.submitted=!1,e.success=!1,e.hasContracts=!n.isProspect(),e.showCallback=!0,e.form={name:{},customerNo:"",contractNo:"",msisdn:""},e.subtopics=[];var l=function(){u()},d=function(){e.isLoading=!0,o.getTreePromise().then(function(n){t.debug("getCurrentTopicDetails returned",n),a.loadCallbacks(e.department).then(function(t){e.slotsLoaded=!0,e.slotsAvailable=t.slotsAvailable,e.callbacks=t,c=t.slots,i.getDetails().then(function(t){e.form.partyId=t.customerId,e.form.contractId=t.contractId,e.form.msisdn=t.msisdn.replace(/^049/,"0")}),s.getSummary().then(function(t){e.email1=t.email,e.email2=t.email,e.form.phone=t.phone,e.form.name=t.name})},t.error)},t.error)["finally"](function(){e.isLoading=!1})},u=function(){o.getTreePromise().then(function(a){t.debug("_onContactTopicChange",a),e.serviceCategory=null,$.cookie("contactCategory")&&a.forEach(function(n){n.id===$.cookie("contactCategory")&&(t.debug("Found maincategory"),n.children.forEach(function(n){$.cookie("contactTopic")===n.id&&(t.debug("serviceCategory is ",n.category),e.serviceCategory=n.category,e.department=n.department)}))}),n.isLoggedIn()&&d()})};e.toggleVisibility=function(){e.showCallback=!e.showCallback,e.showCallback&&d()},e.requestCallback=function(){o.getTreePromise().then(function(n){var r=o.parseContactCategories(n);t.debug("topicData",n,r);var i=e.form,s=e.form.slot.split(/\|/),l=s[0],d=s[1],u=c[l][d];i.emailSender=e.email1,i.topic=r.currentCategory.title,i.subtopic=r.currentTopic.title,i.department=r.currentTopic.department,i.startDate=u.start,i.endDate=u.end,e.selectedDay=d,e.start=u.start,e.end=u.end,a.requestCallback(i).then(function(n){t.debug("response",n),e.submitted=!0,e.success=!0,window.scrollTo(0,100)},function(n){t.error("response",n),e.submitted=!0,e.success=!1})})},e.$on("contactTopicChange",function(){u()}),l()}]),app.controller("ContactCtrl",["$element","$log","$location","$scope","$rootScope","AuthService2","ChatService","ContactService",function(e,t,n,a,r,i,o,s){function c(){var e;l(),/vertragsverlaengerung/.test(n.path())?e="vvl":/^\/digitale-welt\//.test(location.pathname)?e="dls":/^\/tv\//.test(location.pathname)&&(e="freenettv"),i.isAnonymous()?i.isAnonymous()&&-1!==window.location.href.indexOf("/business/")&&(e="businessi"):i.isBusiness()?e=e||"business":i.isProspect()?e=e||"prospect":i.getCurrentContractDetails().then(function(t){var n=e;t.isDom()?n=n||"dls":t.isCredit()&&!t.getLink("prolongation")?n=n||"credit":t.isPrepaid()?n=n||"prepaid":t.getLink("prolongation")&&(n=n||"vvl"),g.targetAudience=n},function(){t.debug("Identifiziert, daher wie Prospect zu betrachten")}),i.isAnonymous()||i.isBusiness()||i.isProspect(),g.targetAudience=e}function l(){g.specialPath=null,g.targetAudience=null}function d(){a.isContactLoading=!0,g.showLayer&&s.getContactInfos().then(function(e){p=angular.copy(e.data.contactinfos.vvl),a.isContactLoading=!1,a.defaultContactInfo=!1,g.contactInfos=e.data.contactinfos,u()},function(){a.isContactLoading=!1})}function u(){var e=!1,t=["/online-service/#/meine-rechnungen","/online-service/#/meine-daten","/online-service/#/meine-vertraege","/online-service/#/meine-auftraege"];t.forEach(function(t){-1!==window.location.href.indexOf(t)&&-1===window.location.href.indexOf("vertragsverlaengerung")&&(e=!0)}),g.contactInfos&&(e&&g.contactInfos.vvl?delete g.contactInfos.vvl:e||(g.contactInfos.vvl=p))}var g=this,p=null;l(),g.showLayer=!1,g.showChatBtn=!1,a.defaultContactInfo=!0,e.closest(".tabs").length&&c(),g.toggle=function(e){t.debug("_self.toggle",e),a.isContactLoading=!0,g.showLayer=e||!g.showLayer,u(),g.showLayer&&(a.$root.$broadcast("navLayer","contact"),c())},g.startChat=function(e){e.preventDefault(),g.showLayer=!1,o.initChat()},a.$on("navLayer",function(e,t){"contact"!==t?(g.showLayer=!0,g.toggle(!1)):d()}),$("#contactBlock").bind("touchstart",function(e){"A"===e.target.nodeName?e.stopPropagation():("SPAN"===e.target.nodeName&&"contactBlock"===$(e.target).parent().attr("id")||"I"===e.target.nodeName&&"contactBlock"===$(e.target).parent().parent().attr("id"))&&a.$apply(function(){g.toggle(!1)})}).hover(function(){$(window).width()>700&&a.$apply(function(){g.toggle(!0)})},function(){$(window).width()>700&&a.$apply(function(){g.toggle(!1)})}).on("keyup",function(e){const t=e.key;("Enter"===t||" "===t)&&a.$apply(function(){g.toggle(!1)})}).find(".md-header__top-bar-nav-icon-text").on("focus",function(){a.$apply(function(){r.$broadcast("navLayer","contact")})}),a.$on("$routeChangeStart",function(){g.showLayer=!1,c()})}]),app.controller("ContactFormCtrl",["$rootScope","$scope","$upload","$log","$http","$location","LocalStorage","$timeout","ContactService","contractsService","sabioService","AuthService2",function(e,t,n,a,r,i,o,s,c,l,d,u){var g,p=[],f=26214400;if(t.form={name:{},customerNo:"",contractNo:"",msisdn:"",uploads:[]},t.isLoading=!1,t.show=!1,t.submitted=!1,t.success=!1,t.textarea=!0,t.deeplink=!1,t.isLoggedIn=u.isLoggedIn(),t.contactCategories={},l.getDetails().then(function(e){t.form.customerNo=e.getCustomerNo(),t.form.contractNo=e.contractId,t.form.msisdn=e.msisdn}),/dbcp=modal_login/.exec(window.location.search)&&t.showForm?t.showNow=!0:t.showNow=!1,t.getContactTitles=function(){a.debug("getContactTitles"),c.getCurrentTopicDetails().then(function(e){a.debug("getContactTitles resolved",e),Array.isArray(e)&&e.length?t.showForm=!0:t.showForm=!1;var n=d.parseContactCategories(e);t.contactMainCategories=n.categories,t.contactCategories=n.topics,t.form.category=n.currentCategory,t.form.topic=n.currentTopic},function(){t.showForm=!1})["finally"](function(){var e={name:"pass",vb:"pass",rh:"pass",ezvn:"pass",to:"pass",tw:"pass",ti:"pass",rnt:"pass",ek:"pass",vlz:"pass",rnm:"pass",address:"pass",pukpin:"pass"};angular.forEach(e,function(e,n){var a=new RegExp("pass="+n);a.exec(window.location.search)&&(t.deeplink=!0)})})},u.isLoggedIn()){t.usertype="prospect";var m=u.getUser();m.activeContract?u.getCurrentContractDetails().then(function(e){u.isBusiness()||m.isAdmin()?t.usertype="business":e.isCredit()||e.isDom()?t.usertype="credit":e.isPrepaid()&&(t.usertype="prepaid"),t.msisdn=e.msisdn,t.contract=e.contractId,u.getCustomerData().then(function(e){g=e,t.show=g.getLink("contactFormDunningLevel")||g.getLink("contactFormInstallmentPayment")?!0:!1,t.form.name=g.name,t.email1=g.email,t.email2=g.email,t.getContactTitles(t.show,t.usertype,t.msisdn,t.contract)},function(){t.show=!1})["finally"](function(){t.isLoading=!1})}):t.getContactTitles(t.show,t.usertype,"","")}else/interessenten/.exec(window.location)&&t.getContactTitles(!1,"prospect","",""),/prepaid/.exec(window.location)&&t.getContactTitles(!1,"prepaid","",""),/vertragskunden/.exec(window.location)&&t.getContactTitles(!1,"credit","",""),/digitale-welt/.exec(window.location)&&t.getContactTitles(!1,"dls","","");t.setVisibility=function(){t.showNow?t.showNow=!1:t.showForm&&(t.showNow=!0)},t.onFileSelect=function(e,n){var a=e[0];angular.isDefined(a.size)&&a.size>f?t.contactForm["attachment"+n].$setValidity("filesize",!1):t.contactForm["attachment"+n].$setValidity("filesize",!0),p[n]=a,$("#fileattachment").blur()},t.requestContact=function(e){var n=angular.copy(t.form),r=t.form.topic;n.emailSender=t.email1,n.theme=e,n.topic=r.title,n.emailReceiver=r.email,n.category=n.category.title,n.brand="Mobilcom",delete n.upload,delete n.uploads,n.name.companyName&&(n.name.firstName=n.name.companyName,n.name.lastName=n.name.nameAffix),c.requestContact(n,p).then(function(e){a.debug("response",e),t.submitted=!0,t.success=!0},function(e){a.error("response",e),t.submitted=!0,t.success=!1})},t.$watch("form",function(e,n){if(e.category!==n.category&&(t.contactCategories=t.form.category.children),"Rücksendung Formulare"===e.category)t.form.topic="223";else if(e.topic&&"Kündigung"===e.topic.title){var r=t.form.topic;a.debug("getCurrentTopicDetails",r),t.form.text="Hiermit kündige ich meinen Vertrag mit der Rufnummer "+t.msisdn+" und der Vertragsnummer "+t.contract+" zum nächstmöglichen Zeitpunkt. Ich bitte um Bestätigung der Kündigung.",t.textarea=!1}else e.topic&&"Kündigung"!==e.topic.title&&(t.textarea=!0)},!0)}]),app.factory("CallbackService",["RequestService",function(e){function t(t){return t||(t=r),e.get(["contact",t])}function n(t){return e.post("callbackService",t,{flush:!1})}function a(e){return t(e).then(function(e){var t=e.data,n={},a={days:[],slots:{},slotsAvailable:!1};return $.each(t,function(e,t){var r=t.day,i=t.slot.start;n[r]||(n[r]=r),a.slots[i]||(a.slots[i]={}),a.slots[i][r]={start:t.start,end:t.end,capacity:t.capacity,available:t.available},t.available&&(a.slotsAvailable=!0)}),a.days=n,a})}var r="Vertrag";return{loadCallbacks:a,requestCallback:n}}]),app.factory("ContactService",["$q","$upload","$log","$location","$http","$templateCache","UrlService","RequestService","ModalService","sabioService",function(e,t,n,a,r,i,o,s,c,l){function d(r,i,l){var d=e.defer();if(-1===a.absUrl().indexOf("www.freenet-mobilfunk.de")&&!l)return c.showModal({controller:["$scope","data","ContactService","close",function(e,t,n,a){e.data=t,e.sendEmail=function(){n.requestContact(e.data,i,!0),e.sentMail=!0,d.resolve("Fake E-Mail was sent"),a(!0)},e.close=a}],inputs:{data:r},template:"<div><h3>Willkommen auf der Testumgebung!</h3> Eine E-Mail mit folgenden Werten wäre beinahe an "+r.emailReceiver+' geschickt worden:<ul><li ng-repeat="(k,v) in data">{{k}} : {{v}}</li></ul><button type="button" class="btn btn-second btn-big" ng-click="close(false)">Abbrechen</button><button type="button" class="btn btn-big" ng-disabled="sentMail" ng-click="sendEmail()">E-Mail schicken</button></div>'}).then(function(e){$("body").addClass("modal-is-open"),jqCustom.Modal.show(e.element),e.close["finally"](function(){$("body").removeClass("modal-is-open"),jqCustom.Modal.hide()})},function(e){n.error("showModal",e)}),d.promise;if(i&&i.length){var u={};i.forEach(function(a,r){if(""!==a){var i=e.defer();u["file"+r]=i.promise,t.upload({url:o.getUrl("contactFileUpload"),method:"POST",file:a}).then(function(e){n.debug("upload success",e),i.resolve(e)})["catch"](function(e){n.error("upload error",e),i.reject(e)})}}),Object.keys(u).length?e.allSettled(u).then(function(e){n.debug("allSettled returned",e),d.resolve(e)},d.reject):d.resolve([])}else d.resolve([]);return d.promise.then(function(e){return n.debug("responses are",e),r.references=Object.keys(e).map(function(t){return e[t].value.references[0]}),s.post("customerService",r)},function(e){return n.error("rejected",e),d.promise})}function u(){return s.get("contactInfo",null,{cache:i})}function g(e,t,n,a){var i="/ajax/kontaktform.php",o={type:t,flag:e,msisdn:n?n:"",contract:a?a:""};return r.post(i,o,{flush:!1}).then(function(e){return v=e.data.result,p(),e})}function p(){var e=h("contactCategory"),t=h("contactTopic"),n=!1,a=null;e&&t&&v[e]&&angular.forEach(v[e],function(e){e.id===t&&(n=!0,a=e)}),n?b.resolve(a):b.reject(null)}function f(){return n.debug("getCurrentTopicDetails"),l.getTreePromise()}function m(e,t){return t&&$.cookie(e)!==t?($.cookie(e,t,{path:"/"}),!0):!1}function h(e){return $.cookie(e)}n=n.getInstance("ContactService");var v=null,b=e.defer(),w={name:{contactCategory:"1jydr1dha07jr",contactTopic:"s0uj8ytyxv1g"},vb:{contactCategory:"trww52pr2kbm",contactTopic:"t8fpkjjtlwz7"},rh:{contactCategory:"trtmu0wmg7qt",contactTopic:"urxhk010rgog"},ezvn:{contactCategory:"trtmu0wmg7qt",contactTopic:"vf0yb8v6izhu"},to:{contactCategory:"1hrdovhx8a4ab",contactTopic:"1if0jo2b9j12w"},tw:{contactCategory:"1hrdovhx8a4ab",contactTopic:"s0xa8m6ac7dy"},ti:{contactCategory:"1hrdovhx8a4ab",contactTopic:"1iun7roz39bok"},rnt:{contactCategory:"rhjc74jv6cs1",contactTopic:"uve502hrr97n"},ek:{contactCategory:"rhjc74jv6cs1",contactTopic:"1ibeswhn5razl"},vlz:{contactCategory:"trww52pr2kbm",contactTopic:"21cf4f08ea424c228682992209f7de7e"},pukpin:{contactCategory:"rhjc74jv6cs1",contactTopic:"u8b8ibd9jpt1"},rnm:{contactCategory:"trww52pr2kbm",contactTopic:"2e1f8391f5d5495bbeb6664653ca8da6"},address:{contactCategory:"1jydr1dha07jr",contactTopic:"1iyeys61ftf1g"}};return angular.forEach(w,function(e,t){var n=new RegExp("pass="+t);n.exec(window.location.search)&&($.cookie("contactCategory",e.contactCategory,{path:"/"}),$.cookie("contactTopic",e.contactTopic,{path:"/"}))}),{requestContact:d,getContactInfos:u,getContactTopics:g,getCurrentTopicDetails:f,setCookieValue:m,getCookieValue:h}}]),app.controller("contractinfosCtrl",["$scope","contractinfosService","RequestService","ErrorService",function(e,t,n,a){e.setBreadcrumb([{url:"#/meine-vertraege",title:"Meine Verträge"},{url:"#/meine-vertraege/vertragsdetails",title:"Vertragsdetails"},{url:"#/meine-vertraege/vertragsdetails/produktinformationen",title:"Produktinformationen"}]),e.isLoading=!0;var r={},i={};r.contractinfos=t.contractinfos(),i.contractinfosSuccess=function(t){e.isLoading=!1,e.contractinfos=t.data},i.contractinfosError=function(){e.isLoading=!1,e.errorMessage=a.getMessage(503)},n.handlePromises(r,i)}]),app.factory("contractinfosService",["RequestService",function(e){function t(){return e.get("transparencyRegulation")}return{contractinfos:t}}]),app.controller("ContractDetailCtrl",["$log","$scope","$http","SimService","AuthService2","RequestService","contractsService","LocalStorage","ValueStorage",function(e,t,n,a,r,i,o,s,c){function l(t){e.error(t)}if(e=e.getInstance("ContractDetailCtrl"),t.isLoading=!0,t.setBreadcrumb([{url:"#/meine-vertraege",title:"Meine Verträge"},{url:"#/meine-vertraege/vertragsdetails",title:"Vertragsdetails"}]),t.contractId=r.getContract(),t.contractKey=sha256(t.contractId),s.get(c.userData)){var d=s.get(c.userData);t.isBusiness=d.isBusiness}o.getDetails(t.contractId,!0).then(function(a){t.isLoading=!1,t.details=a,a.links.tariffDocument&&n.get("/api"+t.details.links.tariffDocument+"-PIB?access_token="+$.cookie("accessToken")).then(function(n){e.debug("data",n.data.code),angular.isDefined(n.data.code)?t.details.pibLink="error":t.details.pibLink=t.details.links.tariffDocument+"-PIB?access_token="+$.cookie("accessToken")},function(){t.details.pibLink="error"}),"DEBIT"===t.details.tariffPaymentType&&"D2"===t.details.netCode&&o.getPrepaidBalance(t.contractId).then(function(e){t.prepaidBalance=(parseInt(e.amount)/100).toFixed(2).toString().replace(/\./g,",")}),a.links.prolongationReminder&&i.get("vvlGetReminder").then(function(e){e.data.email&&""!==e.data.email?s.set(c.hasReminder,!0):s.set(c.hasReminder,!1)})},l)["finally"](function(){t.isLoading=!1}),t.dateCheck=function(e){return e>Date.now()}}]),app.controller("ContractsCtrl",["$q","$scope","$filter","$log","$timeout","contractsService","RequestService","AuthService2",function(e,t,n,a,r,i,o,s){s.isLoggedIn()&&(window.location.href=window.location.protocol+"//"+window.location.host+"/onlineservice/meine-vertraege");var c,l=s.getUser(),d=i.getContracts();t.callForContracts=function(){a.debug("contract"),s.fetchContracts(l).then(function(e){var a=[];angular.forEach(e.contracts,function(e,t){e.contractId=t,a.push(e)}),t.pagesWithContracts=n("ceil")(a.length/10),t.contracts=a,c=e.pagination,t.complete=c.complete,t.loaded=c.loaded-l.getContracts().length,t.all=c.all-t.loaded,t.allPages=n("ceil")(t.all/10)})},t.callForContracts(),t.isLoading=!0,t.setBreadcrumb([{url:"#/meine-vertraege",title:"Meine Verträge"}]),t.isAdmin=l.isAdmin(),t.isUser=l.getAllowedAction("contractOwner"),t.currentPage=1,t.startItem=1,t.endItem=10,t.pointsPrep=!1,t.pointsApp=!0,c=l.getPagination(),t.complete=c.complete,t.loaded=c.loaded-l.getContracts().length,t.all=c.all-t.loaded,t.allPages=n("ceil")(t.all/10),t.pageRange=function(e,n){var a;for(t.pagesRange=[],a=e;n>=a;a++)t.pagesRange.push(a)},t.allPages<=7?t.pageRange(1,t.allPages):t.pageRange(1,5),t.pagination=function(e){if(t.callForContracts(),t.startItem=10*(e-1)+1,t.endItem=t.all<=t.startItem+9?t.all:t.startItem+9,t.currentPage=e,t.allPages>8)if(e>=4)if(t.pointsPrep=!0,e>=t.allPages-2)t.pageRange(t.allPages-4,t.allPages),t.pointsApp=!1;else{var n=e+2<t.allPages?e+2:t.allPages;t.pageRange(e-2,n),t.pointsApp=!0}else t.pointsPrep=!1,t.pageRange(1,5)},e.allSettled(d).then(function(e){var r=[];angular.forEach(e,function(e){r.push(e.value)}),t.contracts=r,t.multiContract=r.length>5,t.isLoading=!1,t.pagesWithContracts=n("ceil")(r.length/10),a.debug(t.pagesWithContracts+" by pageload"),angular.forEach(t.contracts,function(e){e.tariffPaymentType&&"DEBIT"===e.tariffPaymentType&&"D2"===e.netCode&&i.getPrepaidBalance(e.contractId).then(function(e){t.prepaidBalance=(parseInt(e.amount)/100).toFixed(2).toString().replace(/\./g,",")})})},function(e){t.isLoading=!1,a.error("ContractsCtrl",e)}),t.dateCheck=function(e){return e>Date.now()},t.switchContract=function(e){s.setCurrentContract(e,!1)}}]),app.filter("contractIdFilter",function(){return function(e){if(angular.isString(e)){var t=e.indexOf(".");return-1!==t?e.substring(t+1,e.length):e}}}).filter("msisdn2Phone",function(){return function(e){if(!angular.isString(e))return e;if(e.includes("."))return"(DOM) "+e;var t="0"+e.substring(3,6);return t+=13===e.length?" - "+e.substring(6,9)+" "+e.substring(9,11)+" "+e.substring(11,e.length):" - "+e.substring(6,9)+" "+e.substring(9,12)+" "+e.substring(12,e.length)}}).filter("ceil",function(){return function(e){return Math.ceil(e);
}}),app.factory("contractsService",["$q","$log","$rootScope","$cacheFactory","AuthService2","RequestService","ModelFactory",function(e,t,n,a,r,i,o){function s(a,s){function c(e,i){var c=o.transform(e.data,"Contract");c.msisdn=u,c.isActive=f,n.earliestTerminationDate=e.data.earliestTerminationDate,n.distributionChannel=e.data.distributionChannel,i||(m.contracts[a].details=e.data,r.setUser(m)),d?2===r.getUser().authState&&(t.debug("$broadcast contract:load",d,s),n.$broadcast("contract:loaded",c)):s&&n.$broadcast("contract:changed",c),d=!1,h.resolve(c)}function l(e){t.error("contractError",e);var n={contractId:a,msisdn:u,isActive:f},i=o.transform(n,"Contract");m.contracts&&m.contracts[a]&&(m.contracts[a].details=n),r.setUser(m),h.resolve(i)}var u,g,p,f,m=r.getUser(),h=e.defer(),v=!1;if(a=a||m.getContract(),g=m.getContractLink(a,"contractDetails"),a===!1||""===a)return t.debug("No Contract Id Given"),h.reject("No contract Id given"),h.promise;if("CONTRACT-ID"===a)return h.reject("Cannot load details for CONTRACT-ID. "+this.caller),h.promise;if(m.contracts&&m.contracts[a]&&(m.contracts[a].msisdn&&(u=m.contracts[a].msisdn),m.contracts[a].details&&(v=!0),f=m.contracts[a].isActive),s||!v){if(!m.isLoggedIn())return h.reject("Not logged in"),h.promise;g?(s||(p={withoutContractSelection:!0}),i.get(g,p).then(c,l)):l("No contract details link")}else c({data:m.contracts[a].details},!0);return h.promise}function c(){var t=[],n=r.getContracts();return n.length>5?angular.forEach(r.getUser().contracts,function(n,a){var r=e.defer();n.contractId=a,r.resolve(n),t.push(r.promise)}):angular.forEach(n,function(e){t.push(s(e))}),t}function l(t){var n=e.defer();return i.get(["getPrepaidBalance",t]).then(function(e){n.resolve(e.data)})["catch"](function(){n.reject()}),n.promise}t=t.getInstance("contractsService");var d=!0;return{getDetails:s,getContracts:c,getPrepaidBalance:l}}]),app.controller("MyDeviceCtrl",["$scope","$log","RequestService","dashboardService","formdata","close",function(e,t,n,a,r,i){var o=r.contractId,s={vendors:n.get("vendors",{channel:"cockpit",hasDefaultVariant:1,hasSapId:1}),devices:n.get("devices",{channel:"cockpit",group:"pdb_hersteller_id",noVariants:1,key:"defaultVariant",hasDefaultVariant:1,hasSapId:1})},c={vendorsSuccess:function(t){e.vendors=t.data.vendors},devicesSuccess:function(t){e.devices=t.data.devices},done:function(){e.isPromise=!1}};e.isPromise=!0,n.handlePromises(s,c),e.updateDevices=function(){e.vendorDevices=e.devices[e.vendor]},e.submitMyDevice=function(){a.saveMyDevice(o,e.vendor,e.device).then(function(){e.closeModal(e.vendorDevices[e.device])})},e.closeModal=function(e){i(e)}}]),app.controller("DashboardCtrl",["$log","$scope","$rootScope","$location","$window","LocalStorage","OidcService","AuthService2","dashboardService","RequestService","ModalService","SimService","partnerofferService","abTestService",function(e,t,n,a,r,i,o,s,c,l,d,u,g,p){e=e.getInstance("DashboardCtrl"),s.isLoggedIn()?window.location.href=window.location.protocol+"//"+window.location.host+"/onlineservice/dashboard":o.createPckeRequest(!0,!1,!1,"dashboard"),t.isLoading=!0,t.uniqueEndDate=!1,t.dashboardData={},t.$root.siteTitle="Online Service Dashboard";var f=s.getUser(),m=f.getContractIds(),h=f.getContract(),v=f.getPartyId();t.user=f,t.dashboardData={},t.hasTelcoContract=f.hasTelcoContract(),t.isTalkline=s.isTalkline(),t.isBusiness=f.isBusiness,t.customerData={},t.isBack=!1,t.isMonday=!1,t.isEvening=!1,t.isWeekend=!1,t.isMorning=!1,t.isWomensday=!1,t.isBirthday=!1,t.isChristmass=!1,t.isNewYear=!1,t.isDefault=!1;var b=i.get("mlpRedirect");i.rm("mlpRedirect"),null!==b&&""!==b&&(window.location.href=b),s.getCurrentContractDetails().then(function(e){t.isProlongation=angular.isDefined(e.links.prolongation),t.isProlongationReminder=angular.isDefined(e.links.prolongationReminder),t.isOptionsAllowed=angular.isDefined(e.links.options);var a=(window.location.href.indexOf("www-git."),new Date(1e3*e.contractStartDate)),r=new Date(Date.now());n.contractualMonth=r.getMonth()-a.getMonth()+12*(r.getFullYear()-a.getFullYear())});for(var w=["salutation-one","salutation-two","salutation-three"],y=0;2>=y;y++)if($.cookie(w[0])&&$.cookie(w[1])&&$.cookie(w[2])){if("true"==$.cookie(w[y])){switch(y){case 0:$.cookie(w[0],!1,{path:"/"}),$.cookie(w[1],!0,{path:"/"}),$.cookie(w[2],!1,{path:"/"});break;case 1:$.cookie(w[0],!1,{path:"/"}),$.cookie(w[1],!1,{path:"/"}),$.cookie(w[2],!0,{path:"/"});break;case 2:$.cookie(w[0],!0,{path:"/"}),$.cookie(w[1],!1,{path:"/"}),$.cookie(w[2],!1,{path:"/"})}break}}else $.cookie(w[0],!0,{path:"/"}),$.cookie(w[1],!1,{path:"/"}),$.cookie(w[2],!1,{path:"/"});var k=(f.customer&&f.customer.name.firstName&&""!==f.customer.name.firstName&&!t.isBusiness?" "+f.customer.name.firstName:"",{"salutation-one":"Viele Grüße von uns an Sie","salutation-two":"Hallo und Herzlich willkommen","salutation-three":"Schön, dass Sie da sind"});angular.forEach(k,function(e,n){$.cookie(n)&&"true"==$.cookie(n)&&(t.isDefault=!0,t.isDefaultText=e)}),l.get("getCustomerData",h).then(function(e){t.customerData=e.data;var n=new Date(1e3*t.customerData.birthDate),a=n.getDate(),r=n.getMonth()+1;M===a&&I===r&&(t.isDefault=!1,t.isBirthday=!0)}).then(function(t){e.debug("getCustomerData error",t)});var C=new Date,S=C.toDateString(),A=C.getDay(),M=C.getDate(),I=C.getMonth()+1,L=C.getHours(),T=C.setDate(C.getDate()+7),D=new Date(T),E=D.toDateString();$.cookie("7days")||$.cookie("7days",E,{path:"/",expires:8}),S!=$.cookie("7days")||t.isBirthday||($.cookie("7days",E,{path:"/",expires:8}),t.isDefault=!1,t.isBack=!0),1==A&&L>=6&&17>=L&&!t.isBirthday&&!t.isBack&&(t.isDefault=!1,t.isMonday=!0),A>=0&&4>=A&&L>18&&23>=L&&!t.isBirthday&&!t.isBack&&(t.isDefault=!1,t.isEvening=!0),(5==A&&L>=6||6==A&&12>=L&&!t.isBirthday&&!t.isBack)&&(t.isDefault=!1,t.isWeekend=!0),A>=1&&4>=A&&L>=6&&10>=L&&!t.isBirthday&&!t.isBack&&(t.isDefault=!1,t.isMorning=!0),3!=I||8!=M||t.isBirthday||t.isBack||(t.isDefault=!1,t.isWomensday=!0),12==I&&M>=24&&26>=M&&!t.isBirthday&&(t.isDefault=!1,t.isChristmass=!0),1==I&&M>=1&&!t.isBirthday&&(t.isDefault=!1,t.isNewYear=!0),t.simStatus={ACTIVATABLE:!1,ACTIVATING:!1,NETACTIVATION_ONGOING:!1,ACTIVE:!1};var x=function(){P(),O()},P=function(){n.loginSuccess&&(n.loginSuccess=!1,g.getUser(v,h.split(".")[1],"2").then(function(e){e!==!1?t.powerlayer=!1:t.powerlayer=!0},function(t){e.debug("partnerofferService -> error",t)}))},O=function(){m.length&&(m.splice(m.indexOf(h),1),m.unshift(h),m=_.filter(m,function(e){return"TELCO"===f.contracts[e].contractType}),angular.forEach(m,function(e,n){t.dashboardData[e]={sort:n,contractId:e,msisdn:f.contracts[e].msisdn},0===n&&c.requestDetails(t.dashboardData,e,t)["finally"](function(){N(),t.isLoading=!1})}))},N=function(){t.hasESims=!1,t.simStatus={ACTIVATABLE:!1,ACTIVATING:!1,NETACTIVATION_ONGOING:!1,ACTIVE:!1,msisdn:t.dashboardData[h].msisdn},u.getSimStatus().then(function(){u.hasESimStatus("ACTIVATABLE").then(function(){t.simStatus.ACTIVATABLE=!0}),u.hasESimStatus("ACTIVATING").then(function(){t.simStatus.ACTIVATING=!0}),u.hasESimStatus("NETACTIVATION_ONGOING").then(function(){t.simStatus.NETACTIVATION_ONGOING=!0}),u.hasESimStatus("ACTIVE").then(function(){t.simStatus.ACTIVE=!0})},e.error)};t.changeMyMobile=function(n){d.showModal({templateUrl:"/partials/mymobile.html",controller:"MyDeviceCtrl",inputs:{formdata:{contractId:n}}}).then(function(e){jqCustom.Modal.show(e.element),e.close.then(function(e){e&&(t.dashboardData[n].device=e),jqCustom.Modal.hide()})},function(t){e.error("showModal",t)})},t.initSlideData=function(e){u.clearESimStatus(),N(),t.setActiveContract(e),h=e,c.requestDetails(t.dashboardData,e,t)},t.backToStart=function(){a.path("/meine-daten")},x()}]),app.filter("prolongationDate",function(){return function(e){var t=1e3*e,n=Date.now(),a=864e5;return t>n?Math.round((t-n)/a):-1}}).filter("key2Label",function(){return function(e){switch(e){case"data":return"MB";case"call":return"Anrufe";case"sms":return"SMS";case"unitsMinSms":return"Minuten/SMS";case"unitsMin":return"Minuten"}}}).filter("netFilter",function(){return function(e){switch(e){case"D2":return"Vodafone-Netz";case"E+":return"E-Plus-Netz";case"D1":return"Telekom Mobilfunknetz";case"O2":return"O2-Netz";default:return"-"}}}).filter("netUrlFilter",function(){return function(e){switch(e){case"E+":return"EP";default:return e}}}),app.factory("dashboardService",["$q","$http","$cacheFactory","$log","contractsService","AuthService2","UrlService","RequestService",function(e,t,n,a,r,i,o,s){function c(e,t,n){return r.getDetails(t).then(function(r){_.extend(e[t],r),e[t].isTalkline=r.isTalkline(),e[t].isProlongationPossible=r.isProlongationPossible(),r.hasPermission("usageSummary")?d(t).then(function(r){if(204===r.status)e[t].costCheck={};else{a.debug("_data",r.data),angular.forEach(r.data,function(e){null!==e&&e.calculationPeriod&&""!==e.calculationPeriod.endDate&&null!==e.calculationPeriod.endDate&&f.push(e.calculationPeriod.endDate)});var i=[];e:for(var o=0;o<f.length;o++){for(var s=0;s<i.length;s++)if(i[s]===f[o])continue e;i[i.length]=f[o]}i.length>0&&(n.uniqueEndDate=!0),e[t].costCheck=r.data}},function(){e[t].costCheck={}}):e[t].costCheck={},"DEBIT"===e[t].tariffPaymentType&&"D2"===e[t].netCode&&s.get(["getPrepaidBalance",t]).then(function(n){e[t].prepaidBalance=(parseInt(n.data.amount)/100).toFixed(2).toString().replace(/\./g,",")}),s.get(["properties",t],{filter:g}).then(function(n){var a,r=n.data;r[g]&&s.get("devices",{sapIds:r[g],key:"defaultVariant"}).then(function(n){a=n.data.devices[r[g]],e[t].device=a})})},function(){e[t].costCheck={}})}function l(e,t,n){var a={};return a[p]=t,a[g]=n,s.put(["properties",e],a)}function d(n){n=n||i.getContract();var a=e.defer();return u.get(n)?a.resolve(u.get(n)):t.get(o.getUrl("costCheck",n)).then(function(e){u.put(n,e),a.resolve(e)})["catch"](function(e){a.reject(e)}),a.promise}var u=n("costcheckCache"),g="cockpit-device",p="cockpit-vendor",f=[];return{requestDetails:c,getCostcheck:d,saveMyDevice:l}}]),app.controller("EmailCtrl",["$log","$scope","dataService","contractsService","RequestService","ErrorService",function(e,t,n,a,r,i){function o(t){e.debug("Deprecated: Wiredminds ausgebaut",t)}window.location.href=window.location.protocol+"//"+window.location.host+"/onlineservice/meine-daten/email-aendern",t.isLoading=!0,t.setBreadcrumb([{url:"#/meine-daten",title:"Meine Daten"},{url:"#/meine-daten/email-aendern",title:"E-Mail ändern"}]),t.email={};var s={data:n.getSummary(),contract:a.getDetails()},c={dataSuccess:function(e){t.summary=e},contractSuccess:function(e){t.contract=e},always:function(){t.isLoading=!1}};r.handlePromises(s,c),t.saveEmail=function(){n.saveEmail(t.email.emailNew).then(function(e){t.taskId=e.data.taskId,o(!0)},function(e){t.errorMessage=i.getMessage(e.data.code),o(!1)})}}]),app.controller("DataCtrl",["$log","$scope","$location","dspService","dataService","invoiceService","marketingService","AuthService2","RequestService",function(e,t,n,a,r,i,o,s,c){function l(n){t.isLoading=!1,angular.forEach(n,function(n,a){n.resolved?"summary"!==a?t[a]=n.value.data:t.summary=n.value:e.info(a+"Promise error",n.reason)})}t.isLoading=!0,t.setBreadcrumb([{url:"#/meine-daten",title:"Meine Daten"}]);var d={summary:r.getSummary()},u={always:l},g=n.search(),p=s.getUser();p.hasContracts()&&(d.dsp=a.getCodeword(),d.invoice=i.getInvoiceAddress(),d.invoiceMail=i.getInvoiceEmailAddress()),c.handlePromises(d,u),g.emc&&(n.search("emc",null).replace(),$.fancybox({href:"#emc",title:"Änderung Ihrer E-Mail-Adresse",type:"inline"}))}]),app.factory("dataService",["$q","$http","RequestService","AuthService2",function(e,t,n,a){function r(){return a.getCustomerData()}function i(e){return a.getCustomerData().then(function(t){var a=t.getLink("changeEmail");return n.put(a,{email:e})})}function o(e){return n.put("invoiceEmail",{email:e})}return{getSummary:r,saveEmail:i,saveInvoiceEmail:o}}]),angular.module("md").directive("mdChatCapitaGwe",function(){var e=["/inc/scripts/vendor/chat-gwe/bootstrap.min.js","/inc/scripts/vendor/chat-gwe/events.js","/inc/scripts/vendor/chat-gwe/widgets-config.js"],t=["/inc/styles/vendor/chat-gwe/bootstrap.min.css","/inc/styles/vendor/chat-gwe/bootstrap-theme.min.css"],n=!1,a=function(){console.log("onLoadSuccess")},r=function(){n||(window.preload(e.concat(t),a,null,!1),n=!0)},i=function(){setTimeout(r,3e3)};return{restrict:"A",scope:{type:"@mdChatCapitaGwe"},priority:-1,link:function(e,t){t.on("focus",i)}}}),angular.module("md").directive("bindHtmlCompile",["$compile",function(e){return{restrict:"A",link:function(t,n,a){var r=t.$watch(function(e){return e.$eval(a.bindHtmlCompile)},function(a){n.html(a&&a.toString()),e(n.contents())(t),r()})}}}]),app.directive("appMdEqualheight",["$timeout",function(e){return{restrict:"A",link:function(t,n){$.fn.equalHeight&&e(function(){$(n).equalHeight()})}}}]),app.directive("appMdFootnote",["$log","$rootScope","$compile",function(e,t,n){return{restrict:"A",scope:{type:"@appMdFootnote"},priority:-1,link:function(e,a){function r(){if(location.href.indexOf("/online-shop/")>-1)return void i();var r=t.addFootNote(a.text(),e.type);e.footNoteIndex=r.index,e.footNoteKey=r.key,a.html(o),n(a.contents())(e),a.removeAttr("app-md-footnote")}function i(){var t=$(".footnotes-content");e.footNoteIndex=$("dt",t).length+1,e.type?e.footNoteKey=e.type:e.footNoteKey=e.footNoteIndex,t.append("<dt>"+e.footNoteKey+")</dt>"),t.append('<dd id="footnote-'+e.footNoteIndex+'"><span class="is-arrow"></span><span class="footnote-detail">'+a.text()+"</span></dd>"),a.html(o),n(a.contents())(e),a.removeAttr("app-md-footnote")}var o='<a class="footnote" app-md-scroll-to href="#footnote-{{footNoteIndex}}"><sup>{{footNoteKey}})</sup></a>';if(""!==a.text()&&-1===a.text().indexOf("{{"))r();else var s=e.$watch(function(){""!==a.text()&&(r(),s())})}}}]),angular.module("md").directive("appMdCampaignHotline",function(){return{restrict:"A",link:function(e,t){var n=t.text(),a="040 / 55 55 41 535",r="040555541535";$.cookie("fbcampaign")&&(0===n.indexOf("040")&&t.text(a),t.attr("href")&&-1!==t.attr("href").indexOf("tel:")&&t.attr("href","tel:"+r))}}}),app.directive("ngLazysrc",function(){return{restrict:"A",priority:99,link:function(e,t,n){var a="src",r="src";n.$observe("ngLazysrc",function(e){e&&("IMG"!==t[0].tagName?n.$set("style","background-image: url('"+e+"');"):n.$set(r,e),document.all&&a&&(t.prop(a,n[r]),t.prop("style",n.style)))})}}}),app.directive("modalLogin",["$q","$sce","$http","$compile","$rootScope","AuthService2","ENVIRONMENT",function(e,t,n,a,r,i,o){return{scope:{buttonText:"@mlButtonText",form:"@mlForm",introimage:"@mlImage",noaction:"@mlNoaction",template:"@mlTemplate",text:"@mlText",shopLink:"@mlShopLink",shopText:"@mlShopText",title:"@mlTitle",mlpHeadline:"@mlMlpHeadline",getTargets:"&mlTargets"},link:function(s,c,l){function d(){var r=e.defer();return m=n.get(s.template).then(function(e){h=e.data}),m.then(function(){f=$(a(h)(s)),s.introtext=t.trustAsHtml(c.find(".is-hidden").html()),s.form&&(v=$(s.form,f),v.on("submit",function(e){i.isLoggedIn()||e.preventDefault()})),r.resolve()},r.reject),r.promise}function u(){function e(e){window.location.href=e+(/\?/.test(e)?"&":"?")+"dbcp=modal_login"}var t=l.href;i.isBusiness()&&y.business?e(y.business):i.isProspect()&&y.prospect?e(y.prospect):i.getCurrentContractDetails().then(function(e){e.isCredit()&&y.credit?t=y.credit:e.isPrepaid()&&y.prepaid?t=y.prepaid:e.isDom()&&y.dom&&(t=y.dom)})["finally"](function(){e(t)})}function g(e){s.formObject=null,s.formObject={},v.length?v.attr("action",l.href+(/\?/.test(l.href)?"&":"?")+"dbcp=modal_login"):s.formObject.target=l.href,s.hasErrors=!1,s.isPromise=!1,s.buttonText=w,$(".js-scroll-to-login",e).on("click",function(){$(".modal-body").animate({marginTop:-1*$("#product-login").position().top},500)}),e&&r.$broadcast("modalLoginReady")}function p(e){s.hasErrors=!0,s.isPromise=!1,s.buttonText=w,s.errorMessage=e}var f,m,h,v=[],b=Math.random().toString(36).slice(2),w=s.buttonText,y=s.getTargets();return c.is("a")?(s.close=function(){s.isPromise||($("body").removeClass("modal-is-open"),jqCustom.Modal.hide(),g(null))},s.setRedirect=function(){if(s.shopLink){var e=o.mlp;"self"===s.shopLink?loginRedirect=$location.absUrl():loginRedirect=s.shopLink,$.cookie("loginRedirect",loginRedirect,{path:"/",expires:122/1440}),window.location.href=e+"?mlp_headline="+s.mlpHeadline}},s.submit=function(){var e=v.length||s.noaction||y?"none":null;s.buttonText="Bitte warten...",s.hasErrors=!1,s.isPromise=!0,setTimeout(function(){i.login(s.formObject,e).then(function(e){e.error?p(e.error):v.length?v.trigger("submit"):y?u():(g(),$("body").removeClass("modal-is-open"),jqCustom.Modal.hide())},function(e){p(e.error)})},600)},void c.on("click",function(e){i.isLoggedIn()?v.length&&(e.preventDefault(),v.trigger("submit")):(e.preventDefault(),d().then(function(){jqCustom.Modal.show(f,b),$("body").addClass("modal-is-open"),$(".modal-body").css({marginTop:0}),g(f)}))})):function(){}}}}]),angular.module("md").directive("appOmuvCounterTime",function(){return{scope:{datetime:"@datetime"},template:'<div class="counter-time js-counter-time" ng-cloak style="display:none">  <div class="counter-time__container">    <div class="counter-time__part">      <div class="counter-time__digit-container js-counter-time-day">        <div class="counter-time__digit">1</div>        <div class="counter-time__digit">2</div>      </div>\n      <div class="counter-time__digit-label">        Tage\n      </div>\n    </div>\n    <div class="counter-time__seperator"></div>    <div class="counter-time__part">      <div class="counter-time__digit-container js-counter-time-hour">        <div class="counter-time__digit">9</div>        <div class="counter-time__digit">6</div>      </div>      <div class="counter-time__digit-label">        Stunden      </div>    </div>    <div class="counter-time__seperator"></div>    <div class="counter-time__part">      <div class="counter-time__digit-container js-counter-time-minute">        <div class="counter-time__digit">0</div>        <div class="counter-time__digit">0</div>      </div>      <div class="counter-time__digit-label">        Minuten      </div>    </div>    <div class="counter-time__seperator counter-time__short"></div>    <div class="counter-time__part counter-time__short">      <div class="counter-time__digit-container js-counter-time-second">        <div class="counter-time__digit">0</div>        <div class="counter-time__digit">0</div>      </div>      <div class="counter-time__digit-label">        Sekunden      </div>    </div>  </div></div>',link:function(e,t,n){var a=t.children().first(),r=e.$eval(n.options);a.data("target",e.datetime),a.css({display:"inline-block"}),a.addClass(r["class"]||""),preload(["/theme/js/md-web.min.js"],function(){a.show()},null,!1)}}}),app.directive("appOmuvMfp",function(){return{restrict:"A",link:function(){window.theme.productListingPage&&window.theme.productListingPage.init(),window.theme.tariffListingPage&&window.theme.tariffListingPage.init()}}}),app.directive("appOmuvToolTip",function(){return{restrict:"A",link:function(){window.theme.toolTipExt&&window.theme.toolTipExt.init()}}}),app.directive("appOmuvProductInfoBox",function(){return{restrict:"A",link:function(){window.theme.productInfoBox&&window.theme.productInfoBox.init(),window.theme.productInfoBoxTex&&window.theme.productInfoBoxTex.init()}}}),app.directive("appMdOverlay",["$window",function($window){function _showFacebookOverlay(e){_checkFacebookAgreement()?(_loadFacebookSDK(),$(".facebook-overlay").hide()):e.isConfirmationVisible=!0}function _checkFacebookAgreement(){var e=!!localStorage.getItem("fbchatagreed");return e===!0?!0:!1}function _checkTimeZone(e,t,n,a){var r=new Date,i=r.getDay(),o=r.getHours(),s="",c="",l="",d="",u="",g="";return""!==e?(s="0"+e,c="0"+t,l="0"+(parseInt(n)-1),d="0"+(parseInt(a)-1),u=new Date(2018,l,s,0,0,0),g=new Date(2018,d,c,0,0,0)):(u=(new Date).setDate(r.getDate()+1),g=(new Date).setDate(r.getDate()-1)),""===t&&(g=r),i>0&&6>i&&r>=u&&g>=r&&o>9&&16>o?!0:!1}function _checkLocation(path){if(""!==path){for(var loc=window.location.href,pathNum=path.length,cond="",finalCond="",i=0;pathNum>i;i++)0!==i&&(cond+=" || "),cond+='loc.indexOf("'+path[i].trim()+'") !== -1',i===pathNum-1&&(finalCond=cond);if(""!==finalCond&&eval(finalCond))return!0}return!1}function _loadFacebookSDK(){localStorage.setItem("fbchatagreed",!0),$(".facebook-overlay").hide(),$window.fbAsyncInit=function(){FB.init({appId:"1487422668002839",autoLogAppEvents:!0,xfbml:!0,version:"v2.11"})},function(e,t,n){var a,r=e.getElementsByTagName(t)[0];e.getElementById(n)||(a=e.createElement(t),a.id=n,a.src="https://connect.facebook.net/de_DE/sdk.js",r.parentNode.insertBefore(a,r))}(document,"script","facebook-jssdk")}return{restrict:"A",template:function(e,t){var n=angular.isDefined(t.path)?t.path.split(","):"",a=angular.isDefined(t.startday)?t.startday:"",r=angular.isDefined(t.endday)?t.endday:"",i=angular.isDefined(t.startmonth)?t.startmonth:"",o=angular.isDefined(t.endmonth)?t.endmonth:"";return _checkLocation(n)&&_checkTimeZone(a,r,i,o)?'<div ng-if="showFacebook" class="facebook-overlay"><div class="facebook-overlay--icon" ng-click="showConfirmation()"><svg x="0" y="0" width="60" height="60"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g><g><circle fill="#aaaaaa" cx="30" cy="30" r="30"></circle><g transform="translate(10.000000, 11.000000)" fill="#FFFFFF"><path d="M0,18.7150914 C0,8.37723141 8.956743,0 20,0 C31.043257,0 40,8.37723141 40,18.7150914 C40,29.0529515 31.043257,37.4301829 20,37.4301829 C18,37.4301829 16.0763359,37.1551856 14.2544529,36.6459314 L6.95652174,40 L6.95652174,33.0434783 C2.44929143,29.6044708 0,24.5969773 0,18.7150914 Z M16.9276495,19.6993886 L22.109375,25.0798234 L33.0434783,13.4782609 L23.0672554,18.9962636 L17.890625,13.6158288 L6.95652174,25.2173913 L16.9276495,19.6993886 Z"></path></g></g></g></g></svg></div><div class="facebook-overlay--confirmation" ng-if="isConfirmationVisible"><div class="facebook-overlay--close" ng-click="showConfirmation()">&times;</div><strong>Chatten Sie mit uns:</strong><br /><p>Sie erklären sich damit einverstanden, dass Daten an Facebook übertragen werden.</p><button class="btn no-margin" ng-click="confirmFacebook()">Mit uns chatten</button><br /><a ng-href="/legal/datenschutz/" target="_blank">Datenschutzerklärung</a></div><div class="fb-customerchat" attribution="setup_tool" page_id="136037176430191" theme_color="#84BC34" logged_in_greeting="Hi! Wie können wir Ihnen helfen?" logged_out_greeting="Hi! Wie können wir Ihnen helfen?"></div></div>':'<div ng-if="!showFacebook" class="trusted-shops-snippet" id="trusted-shops-snippet" data-ts-id="X00ABD3959729C422C7594B45C824D4BD" data-width="100" data-height="120" data-position="left" data-responsive="true"></div>'},link:function(e,t,n){var a=angular.isDefined(n.path)?n.path.split(","):"",r=angular.isDefined(n.startday)?n.startday:"",i=angular.isDefined(n.endday)?n.endday:"",o=angular.isDefined(n.startmonth)?n.startmonth:"",s=angular.isDefined(n.endmonth)?n.endmonth:"";_checkLocation(a)&&_checkTimeZone(r,i,o,s)&&(e.showFacebook=!0,e.confirmFacebook=_loadFacebookSDK,e.showConfirmation=function(){e.isConfirmationVisible=!e.isConfirmationVisible},_showFacebookOverlay(e))}}}]),app.directive("appMdPagination",function(){return{restrict:"A",link:function(e,t){function n(){t.empty();var n=e.nrResults,a=e.resultsPerPage||10,r=e.currentPage||1,i=Math.ceil(n/a),o=7,s=Math.floor((o-2)/2),c=(r-1)*a,l=Math.min(n,c+a)||1,d=r-s>0?r-s:1,u=i>=r+s?r+s:i;u=Math.min(i,u+Math.max(s+1-r,0)),t.append('<div class="grid-col grid-xl-4 grid-m-4 grid-s-8 not-mobile"><strong>'+(c+1)+" bis "+l+"</strong> von "+n+" Treffern</div>");var g=$('<div class="grid-col grid-xl-8 grid-m-8 grid-s-8 pagination-pages-container"></div>'),p=$('<a data-icon="" data-page="1" title="Erste Seite" class="first-page not-mobile"></a>'),f=$('<a data-icon="" data-page="'+(r-1)+'" title="Vorherige Seite" class="previous-page"></a>');1===r&&(p.addClass("disabled"),f.addClass("disabled")),g.append(p).append(f);var m=$('<div class="pagination-pages"><strong>Seite</strong></div>'),h=$('<span class="not-mobile"></span>'),v=$('<select class="selectbox"></select>');r>1+s&&h.append('<a data-page="1" title="Seite 1">1</a> ...');for(var b=d;u>=b;b++)b===r?h.append('<a data-page="'+b+'" class="is-active" title="Seite '+b+'">'+b+"</a>"):h.append('<a data-page="'+b+'" title="Seite '+b+'">'+b+"</a>");for(b=1;i>=b;b++)v.append('<option value="'+b+'"'+(b===r?' selected="selected"':"")+">"+b+"</option>");i-s>r&&i>u&&(i>u+1&&h.append("... "),h.append('<a data-page="'+i+'"  title="Seite '+i+'">'+i+"</a>")),m.append(h).append($('<span class="only-mobile"></span>').append(v).append(" / "+i)),g.append(m);var w=$('<a data-page="'+i+'"  data-icon="" title="Letzte Seite" class="last-page not-mobile"></a>'),y=$('<a data-page="'+(r+1)+'" data-icon="" title="Nächste Seite" class="next-page"></a>');(1===i||r===i)&&(w.addClass("disabled"),y.addClass("disabled")),g.append(y).append(w),t.append(g),t.addClass("pagination clearfix")}function a(){e.results.length?(n(),t.show()):t.hide()}n(),e.$watch("nrResults",a)}}}),angular.module("md").directive("appMdSticky",["$window","$timeout",function(e,t){return{restrict:"A",link:function(n,a){var r,i=a,o=a.children().first(),s=function(){var t=$(e).scrollTop(),n=i.offset().top-$(e).height()+o.height();n>t?(o.addClass("is-sticky"),e.matchMedia&&e.matchMedia("(max-width: "+jqCustom.Config.breakpoints.phone+"px)").matches||$(e).width()<=jqCustom.Config.breakpoints.phone?o.width("auto"):o.width(i.width()-20)):(o.removeClass("is-sticky"),o.width("auto"))},c=function(){r=jqCustom.ResizeHandler.addListener(s),$(e).on("scroll",s),t(s),n.$on("$destroy",function(){jqCustom.ResizeHandler.removeListener(r),$(e).off("scroll",s)})},l=function(t){angular.isObject(t)&&(t=t[0]);var n=t.getBoundingClientRect(),a=Math.max(document.documentElement.clientHeight,e.innerHeight);return!(n.bottom<0||n.top-a>=0)},d=function(){l(a)&&(c(),$(e).off("scroll",d))};a.data("startonscreen")?l(a)?c():$(e).on("scroll",d):c()}}}]),app.directive("appMdBar",["TeaserEngine",function(e){return{restrict:"E",scope:{amount:"=",page:"="},link:function(t,n){var a=$('<div class="inner-wrapper"></div>');e.loadBar(n,t),$().mdLazyload&&$("[data-lazysrc]").mdLazyload(),n.wrap(a)}}}]),app.directive("appMdBox",["TeaserEngine",function(e){return{restrict:"E",scope:{amount:"=",start:"=",page:"="},link:function(t,n,a){var r=$('<div class="inner-wrapper no-padding"></div>'),i=$('<div class="grid-col grid-xl-4 grid-m-6 grid-s-8 wrap-box"></div>');e.loadBoxes(n,t,function(){if(t.start){var e=parseInt(t.start,10)-1;n.find(".box.teaser:lt("+e+")").remove()}t.amount>1&&!angular.isDefined(a.noWrap)&&(n.find(".box.teaser").wrap(i),n.find("article").removeClass("grid-l-6").addClass("grid-l-12 no-padding"),n.wrap(r))}),$().mdLazyload&&$("[data-lazysrc]").mdLazyload()}}}]),app.directive("appMdMenubox",["TeaserEngine",function(e){return{restrict:"E",scope:{amount:"=",start:"=",page:"="},link:function(t,n,a){var r=$('<div class="grid-col grid-xl-3 menubox-wrap"></div>');e.loadMenuBoxes(n,t,function(){if(t.start)for(var e=parseInt(t.start,10)-1,i=0;e>i;i++)n.find(".menu-box.teaser:first-child").remove();angular.isDefined(a.noWrap)||n.find(".menu-box.teaser").wrap(r),$().mdLazyload&&n.find("[data-lazysrc]").mdLazyload()})}}}]),app.directive("appMdClips",["TeaserEngine",function(e){return{restrict:"E",scope:{amount:"=",page:"="},link:function(t,n){e.loadClips(n,t),$().mdLazyload&&$("[data-lazysrc]").mdLazyload()}}}]),app.directive("appMdHpIntros",["TeaserEngine",function(e){return{restrict:"E",scope:{amount:"=",page:"="},link:function(t,n){e.loadHpIntros(n,t),n.wrap('<div class="box box-rectangle box-full as-contentintro"></div>')}}}]),app.directive("appMdLpIntros",["TeaserEngine",function(e){return{restrict:"E",scope:{amount:"=",page:"="},link:function(t,n){e.loadLpIntros(n,t),n.wrap('<div class="inner-wrapper as-contentintro"></div>')}}}]),app.directive("appMdShopClips",["TeaserEngine",function(e){return{restrict:"E",scope:{amount:"=",page:"="},link:function(t,n){e.loadShopClips(n,t),$(n).parents(".inner-wrapper").length||n.wrap('<div class="inner-wrapper"></div>')}}}]),app.directive("appMdPowerlayer",["TeaserEngine",function(e){return{restrict:"E",scope:{page:"="},link:function(t,n){e.loadPowerlayer(n,t),$().mdLazyload&&$("[data-lazysrc]").mdLazyload()}}}]),app.directive("nboid",["AuthService2",function(e){return{restrict:"A",scope:{nboid:"@"},link:function(t,n){t.nboid&&n.on("click",function(){var n=e.getUser();n.nboId=t.nboid,e.setUser(n)})}}}]),app.directive("appMdVisibility",["$log","$rootScope","AuthService2","LocalStorage","ValueStorage","Events",function(e,t,n,a,r,i){function o(){d=n.getUser(),u=n.getCurrentContractDetails().then(function(e){l=e},function(){l=null})}function s(e,n){"undefined"!=typeof n&&e!==n&&(o(),t.$broadcast(i.userHasChange))}function c(t,s,c,g,p){function f(){w=y.authstate===d.authState}function m(){for(var e=y.type.replace(/\s/g,"").split(","),t=e.length,a=!1;t--;){switch(e[t]){case"business":a=n.isBusiness();break;case"prospect":a=n.isProspect();break;case"credit":a=n.isSoftLoggedIn()||l&&l.isCredit();break;case"prepaid":a=l&&l.isPrepaid();break;case"dom":a=l&&l.isDom()}if(a)break}w=a}function h(){if(n.isSoftLoggedIn()){var e=a.get(r.prolongationInfo);w=y.retention===("NONE"!==e)}else w=y.retention===Boolean(l.hasPermission("prolongation"))}function v(){w=!0,u||o(),y.hasOwnProperty("authstate")&&f(),n.isAnonymous()?w=w&&!(y.hasOwnProperty("type")||y.hasOwnProperty("retention")):u["finally"](function(){w&&y.hasOwnProperty("type")&&m(),w&&y.hasOwnProperty("retention")&&h(),w&&l&&y.hasOwnProperty("isretentionclient")&&isRetentionClient(),b()}),b()}function b(){w?y.usevar?t.isVisible=!0:s.show():y.usevar?t.isVisible=!1:s.hide()}var w,y=t.getConfig();return p(t,function(e){s.append(e)}),"object"!=typeof y?void e.debug("missing values – no permissions, no differentiation"):(v(),void t.$on(i.userHasChange,v))}var l,d,u=null;return t.$watch(n.isLoggedIn,s),t.$watch(n.isSoftLoggedIn,s),t.$watch(n.getUser,s),{link:c,restrict:"A",scope:{getConfig:"&appMdVisibility"},transclude:!0}}]),angular.module("md").directive("mdColorSelect",function(){return{restrict:"E",scope:{colors:"=",onChange:"&"},template:'<div class="options color-select is-big"><div class="option-input" ng-repeat="color in colors track by $index" ng-click="onChange()(color)" ng-class="{\'is-disabled\': !color.available, \'selected\' : $parent.$parent.vm.selectedColor == color.color }" ng-style="{backgroundColor: color.color}"></div></div>'}}),angular.module("md").directive("mdMemorySelect",function(){return{restrict:"E",scope:{memories:"=",onChange:"&"},template:'<ul ng-if="nrMemories >= 1" class="memory-select"><li ng-class="{\'selected\': key === $parent.$parent.$parent.$parent.vm.selectedMemory, \'is-unavailable\': !memories[key].available}" ng-if="memories[key]" '+"ng-repeat=\"key in ['16GB','32GB','64GB','128GB','256GB','512GB']\" ng-click=\"onChange()(key)\">{{key}}</li></ul>",link:function(e){e.nrMemories=Object.keys(e.memories).length}}}),app.directive("appMdTables",function(){return{restrict:"A",link:mdTablesInit}}),app.directive("appMdTableRepeat",function(){return{restrict:"A",link:function(e,t){e.$last===!0&&t.ready(function(){mdTablesInit(e,t.closest("table"))})}}}),app.directive("appMdTableTariff",function(){function e(e,t){$().mdTariffTable&&(t.mdTariffTable(),e.$on("$destroy",function(){t.data("mdTariffTable")&&t.data("mdTariffTable").destroy()}),mdTablesInit(e,t))}return{restrict:"A",link:e}}),app.directive("appMdTableTariffRepeat",function(){return{restrict:"A",link:function(e,t){e.$last===!0&&t.ready(function(){mdTableTariffInit(e,t.closest("table"))})}}}),app.directive("appMdTabs",function(){return{restrict:"A",link:function(e,t){$().mdTabs&&(t.mdTabs(),e.$on("$destroy",function(){t.data("mdTabs").destroy()}))}};
}),app.directive("appMdStepSlider",function(){return{restrict:"A",link:function(e,t){if($().mdRangeSlider){var n=$(t).find("option"),a=$('<div class="rangeslider"><div class="range-slider"></div></div>');n.each(function(e,t){var n=t.className,r=$('<div class="range-segment '+n+'"></div>');r.append($('<div class="range-caption">'+$(t).text()+"</div>")),a.append(r)}),t.append(a),$(t).mdStepSlider({maxValue:n.length,initialValue:t.find("select")[0].selectedIndex})}}}}),app.directive("appMdRangeSlider",function(){return{restrict:"A",require:"ngModel",scope:{appMdRangeSlider:"=",suffix:"@"},link:function(e,t,n,a){function r(){$(".range-segment",o).remove(),i=$('<div class="range-segment"><div class="range-highlight"></div></div>'),i.append($('<div class="range-caption"></div>')),o.append(i),i=$('<div class="range-segment"></div>'),i.append($('<div class="range-caption"></div>')),o.append(i),o.mdRangeSlider({minValue:n.min,maxValue:e.appMdRangeSlider,initialValue:e.appMdRangeSlider,model:a,suffix:e.suffix})}if($().mdRangeSlider){var i,o=$('<div class="rangeslider"><div class="range-slider"><div class="range-handle"></div><span></span></div></div>');t.after(o),e.$watch("appMdRangeSlider",function(){r()})}}}}),app.directive("appMdAccordion",function(){return{restrict:"A",link:function(e,t){$().mdAccordion&&t.mdAccordion()}}}),app.directive("appMdAccCheck",function(){return{restrict:"A",link:function(e,t){e.$last===!0&&t.ready(function(){t.closest(".accordion").mdAccordion()})}}}),app.directive("appMdFaqBox",function(){return{restrict:"A",link:function(e,t){$().mdFaqBox&&t.mdFaqBox()}}}),app.directive("appMdOffcanvas",function(){return{restrict:"A",link:function(e,t){$().mdOffCanvas&&t.mdOffCanvas()}}}),app.directive("appMdTabNavigation",function(){return{restrict:"AC",link:function(e,t){$().mdTabNav&&t.mdTabNav()}}}),app.directive("appMdSlidePsBox",function(){return{restrict:"A",link:function(e,t){$().mdSlides&&setTimeout(function(){var n=5<t.find(".slides-container-box > li").length;t.mdSlides({slide:".slides-container-box > li",auto:!1,inline:!0,height:450,width:938,style:"slide",nextBtn:!0,prevBtn:!0,bullets:!n,label:n,slideCallback:function(t){e.initSlideData(t.attr("id"))}})},200)}}}),app.directive("appMdTolstoyWidget",function(){return{restrict:"E",link:function(e,t){setTimeout(function(){window.tolstoyWidget&&(e.isProlongation&&e.isOptionsAllowed&&0===e.tolstoyABTestVV?(window.tolstoyWidget.show(),window.tolstoyWidget.recreate("h9s59cng3d63a")):e.isProlongationReminder&&e.isOptionsAllowed&&0===e.tolstoyABTestVVReminder?(window.tolstoyWidget.show(),window.tolstoyWidget.recreate("g9u9obujf791j")):(window.tolstoyWidget.hide(),window.tolstoyWidget.on("onWidgetReady",function(){window.tolstoyWidget.hide(),console.log("Widget Ready")})))},1e3)}}}),app.directive("appMdSlides",function(){return{restrict:"A",link:function(e,t){$().mdSlides&&t.mdSlides({slide:".slides-container > li",auto:!0,inline:!1,height:700,width:700,style:"slide",nextBtn:!0,prevBtn:!0,bullets:!0,timeout:1e4})}}}),app.directive("appMdOfslide",["$timeout",function(e){return{restrict:"A",link:function(t,n,a){if(angular.isDefined(a.appMdWatch))var r=t.$watch(a.appMdWatch,function(){$().mdOverflowSlide&&n.ready(function(){e(function(){n.mdOverflowSlide()})}),r()});else $().mdOverflowSlide&&e(function(){n.mdOverflowSlide()});t.$on("$destroy",function(){n.data("overflowSlide")&&n.data("overflowSlide").destroy()})}}}]),app.directive("appMdOfslideRepeat",["$timeout",function(e){return{restrict:"A",link:function(t,n){t.$last===!0&&($().mdOverflowSlide&&e(function(){n.closest(".vendor-select").mdOverflowSlide()}),t.$on("$destroy",function(){n.data("overflowSlide")&&n.data("overflowSlide").destroy()}))}}}]),app.directive("appMdScrollTo",function(){return{restrict:"A",link:function(e,t,n){angular.isDefined(n.href)&&$(t).on("click",function(e){e.preventDefault(),$(n.href).length&&(0===n.href.indexOf("#footnote-")&&jqCustom.Footnotes&&jqCustom.Footnotes.expandFootnote($(n.href)),$("body, html").animate({scrollTop:$(n.href).offset().top-$("header").height()},500))})}}}),app.directive("appMdPrice",["$rootScope","$compile","$filter","$timeout",function(e,t,n,a){return{restrict:"A",scope:{appMdPrice:"@",oldprice:"@oldprice",oldpriceprefix:"@oldpriceprefix",medprice:"@medprice",promduration:"@promotionduration",footNote:"@footnote",introText:"@intro",foot:"@foot",decimals:"@decimals"},link:function(r,i,o){function s(a,o){o=o||{},i.empty();var s,c,u=parseFloat(r.appMdPrice),g=((u.toString().split(".")[1]||"")+"00").slice(0,2),p=0>u?Math.ceil(u):Math.floor(u),f="",m="";"xs"===a.size?(0===u&&a.zero?i.text(a.zero):i.text(n("euro")(u,"+",angular.isUndefined(r.decimals)?!1:!0)),a["class"]&&i.addClass(a["class"]),r.footNote&&(l===!1||o.footnote)?(d=e.addFootNote(r.footNote),i.append('<span class="price-footnote"><a class="footnote" app-md-scroll-to href="#footnote-'+d.index+'"><sup>'+d.key+")</sup></a></span>")):r.footNote&&i.append('<span class="price-footnote"><a class="footnote" app-md-scroll-to href="#footnote-'+d.index+'"><sup>'+d.key+")</sup></a></span>")):(s=$('<div class="price"></div>'),c=$('<div class="price-value"></div>'),a.size&&s.addClass("price-"+a.size.toLowerCase()),a["class"]&&s.addClass(""+a["class"].toLowerCase()),a.intro&&s.append('<span class="price-intro">{{introText}}</span>'),a.prefix&&(f=$('<span class="price-prefix">'+a.prefix+"</span>")),c.append('<span class="price-euro">'+p+".</span>"),c.append('<span class="price-cent">'+g+"</span>"),c.append('<span class="price-currency" itemprop="priceCurrency" content="EUR">€</span>'),(r.oldprice||r.foot)&&(m=$('<div class="price-foot"></div>'),r.foot&&m.append("<span>"+r.foot+"</span> "),r.oldprice&&(r.medprice&&"0"!==r.medprice&&r.promduration?m.append("für "+r.promduration+" Monate, danach "+n("number")(r.medprice,2)+' € statt regulär <span class="caper-price">'+n("number")(r.oldprice,2)+' €<span class="line"></span></span>'):r.promduration?m.append("für "+r.promduration+' Monate, statt regulär<span class="caper-price">'+n("number")(r.oldprice,2)+' €<span class="line"></span></span>'):m.append((r.oldpriceprefix||"statt regulär")+' <span class="caper-price">'+n("number")(r.oldprice,2)+' €<span class="line"></span></span>'))),r.footNote&&(d===!1||o.footnote)?(d=e.addFootNote(r.footNote),c.append('<span class="price-footnote"><a class="footnote" app-md-scroll-to href="#footnote-'+d.index+'"><sup>'+d.key+")</sup></a></span>")):r.footNote&&c.append('<span class="price-footnote"><a class="footnote" app-md-scroll-to href="#footnote-'+d.index+'"><sup>'+d.key+")</sup></a></span>"),c.prepend(f),i.append(s.append(c).append(m))),t(i.contents())(r),l=!0}var c,l=!1,d=!1;a(function(){c=i.data(),s(c),o.$observe("appMdPrice",function(){s(i.data())}),o.$observe("oldprice",function(){s(i.data())}),o.$observe("oldpriceprefix",function(){s(i.data())}),o.$observe("footnote",function(){s(i.data(),{footnote:!0})})},50)}}}]),app.directive("appMdMedia",function(){return{restrict:"A",link:function(e,t){preload(["/inc/scripts/vendor/mediaelement/mediaelement-and-player.min.js","/inc/scripts/vendor/mediaelement/mediaelementplayer.min.css"],function(){jQuery(t).mediaelementplayer()}),e.$on("destroy",function(){jQuery(t).parent().find(".mejs-container").remove()})}}}),app.directive("appMdAudio",function(){return{restrict:"A",link:function(e,t){t.find("audio").length&&preload(["/inc/scripts/vendor/mediaelement/mediaelement.min.js"],function(){new MediaElement(t.find("audio")[0],{success:function(e){t.data("me",e)}})})}}}),app.directive("appMdPdf",function(){return{restrict:"A",link:function(e,t){preload(["/inc/scripts/vendor/jspdf.umd.min.js"],function(){})}}}),app.directive("errSrc",function(){return{link:function(e,t,n){e.$watch(function(){return n.ngSrc},function(e){e||t.attr("src",n.errSrc)}),t.bind("error",function(){t.attr("src",n.errSrc)})}}}),app.directive("appMdBills",function(){return{link:function(e,t,n){function a(){if(angular.isDefined(n.horizontal))return r(),void $(".info-list").addClass("is-horizontal");$(".info-list").removeClass("is-horizontal");var e,t=$("li.info-arrow").outerHeight();$.each(b,function(n,a){var r=s();0===r.h&&(r.h=1.43);var i=$("li.info-arrow:eq("+n+")"),o=(a.y+a.h/2-t/2)*r.h+8;n>0&&(e=parseInt($("li.info-arrow:eq("+(n-1)+")").css("top"),10)+t+5,o=e>o?e:o),i.css("top",o)})}function r(){var e,t=$("li.info-arrow").outerWidth();$.each(b,function(n,a){var r=$("li.info-arrow:eq("+n+")"),i=a.x+a.w/2-t/2+7;n>0&&(e=parseInt($("li.info-arrow:eq("+(n-1)+")").css("left"),10)+t+5,i=e>i?e:i),r.css({left:i,top:"425px"})})}function i(){$("li.info-arrow").each(function(e,t){$(t).on("mouseover",function(t){t.preventDefault(),c(e),d(e)}).on("click",function(t){t.preventDefault(),l(e)})}),$("a.listen").each(function(e,t){$(t).on("click",function(t){t.preventDefault();var n=$(this);n.toggleClass("is-playing"),n.hasClass("is-playing")?(o(e),n.data("me").currentTime=0,n.data("me").play(),n.data("me").addEventListener("ended",o)):o(-1)})}),$("a.prev").on("click",function(e){e.preventDefault(),h=0===h?b.length-1:h-1,u(h)}),$("a.next").on("click",function(e){e.preventDefault(),h=h===b.length-1?0:h+1,u(h)})}function o(e){$("a.listen").each(function(t,n){t!==e&&($(n).removeClass("is-playing"),$(n).data("me").stop())})}function s(){var e=m.width()/("evn"===n.appMdBills?f[0]:p[0]),t=m.height()/("evn"===n.appMdBills?f[1]:p[1]);return{w:e,h:t}}function c(e){if(!angular.isUndefined(e)&&-1!==e){h=e;var t=b[e],n=s();$(".info-highlight").css({top:parseInt(t.y*n.h,10),left:parseInt(t.x*n.w,10),height:parseInt(t.h*n.h,10),width:parseInt(t.w*n.w,10)}).show(),$(".info-highlight-tooltip").css({top:parseInt(t.y*n.h,10)}).show()}}function l(e){h=e,$(".hint, .info-arrow").removeClass("is-active"),$(".hint:eq("+e+"), .info-arrow:eq("+e+")").addClass("is-active")}function d(e){$(".hint:eq("+e+")").hasClass("is-active")||$(".hint, .info-arrow").removeClass("is-active")}function u(e){l(e),c(e)}var g={musterrechnung:[{x:340,y:35,w:120,h:40},{x:340,y:75,w:120,h:20},{x:35,y:120,w:325,h:30},{x:35,y:151,w:325,h:11},{x:35,y:163,w:325,h:30},{x:35,y:200,w:325,h:22},{x:35,y:230,w:325,h:50},{x:35,y:255,w:325,h:30},{x:35,y:437,w:325,h:30}],"musterrechnung-mit-guthaben":[{x:340,y:85,w:120,h:40},{x:340,y:115,w:120,h:95},{x:35,y:215,w:325,h:60},{x:35,y:275,w:325,h:35},{x:35,y:318,w:325,h:50},{x:35,y:385,w:325,h:30},{x:35,y:436,w:325,h:18},{x:35,y:545,w:325,h:121}],"open-positions":[{x:340,y:85,w:120,h:35},{x:340,y:115,w:120,h:95},{x:35,y:215,w:325,h:60},{x:35,y:270,w:325,h:27},{x:35,y:320,w:325,h:50},{x:35,y:390,w:325,h:20},{x:35,y:428,w:325,h:30},{x:35,y:528,w:325,h:121}],evn:[{x:45,y:291,w:42,h:125},{x:97,y:291,w:50,h:125},{x:158,y:291,w:20,h:125},{x:209,y:291,w:28,h:125},{x:275,y:277,w:15,h:120},{x:366,y:277,w:20,h:120},{x:403,y:394,w:26,h:10}],sepa:[{x:340,y:85,w:120,h:40},{x:340,y:120,w:120,h:75},{x:35,y:210,w:325,h:30},{x:35,y:240,w:325,h:35},{x:35,y:270,w:325,h:55},{x:35,y:360,w:325,h:28},{x:35,y:408,w:325,h:19},{x:35,y:424,w:325,h:33},{x:35,y:496,w:325,h:75},{x:35,y:558,w:325,h:121}]},p=[460,740],f=[460,651],m=$("figure img:eq(0)"),h=-1,v=null,b=g[n.appMdBills];a(),i(),v=jqCustom.ResizeHandler.addListener(function(){c(h),a()}),e.$on("$destroy",function(){jqCustom.ResizeHandler.removeListener(v)})}}}),app.directive("appMdFancybox",["$timeout",function(e){return{restrict:"A",link:function(t,n){if($().fancybox){var a=n.attr("rel"),r=n.data("min-height"),i=n.data("max-width"),o={type:n.data("fancybox-type")||"ajax"};r&&(o.minHeight=r),i&&(o.maxWidth=i),"undefined"!=typeof a&&a!==!1?(o.nextEffect="fade",e(function(){n.fancybox(o)})):(o.beforeShow=function(){$("#popup").mdAccordion()},n.fancybox(o))}}}}]),app.directive("appMdCurrentDate",["$filter",function(e){return{restrict:"A",link:function(t,n){var a=new Date;n.text(e("date")(a,"dd.MM.yyyy"))}}}]),app.directive("appMdZoomGallery",["$timeout",function(e){return{restrict:"A",link:function(t,n){n.addClass("has-zoom"),preload(["/inc/scripts/vendor/plugins/jquery.elevateZoom-3.0.8.min.js"],function(){t.$watch("device.selectedVariant",function(){t.device&&t.device.variants&&e(function(){var e=$(".zoomContainer");if(e.length)$(".zoomWindow").css("backgroundImage","url("+t.device.variants[t.device.selectedVariant].images.zoom+")");else if($.fn.mdZoomGallery){var a=n.find(".angebot-gallery a");a.attr("data-zoom-image",t.device.variants[t.device.selectedVariant].images.zoom),a=n.find(".angebot-teaser img"),a.attr("data-zoom-image",t.device.variants[t.device.selectedVariant].images.zoom),n.mdZoomGallery({resize:!1})}})})})}}}]),app.directive("appMdNavHighlight",function(){return{restrict:"A",link:function(e,t){var n=window.location.pathname;t.find("a:not(.teaser)").each(function(){var e=$(this),t=e.attr("href"),a=0===n.indexOf(t);e.toggleClass("is-current",a)})}}}),app.directive("appMdContactSticky",function(){return{restrict:"A",link:function(){jqCustom.ContactSticky&&jqCustom.ContactSticky.init()}}}),app.directive("appMdSlickGallery",["$timeout",function(e){return{restrict:"A",link:function(t,n,a){e(function(){var e,r=$(n),i=t.$eval(a.appMdSlickGallery);e="DIV"===n[0].nodeName?r.find("div"):r.find("li"),e.length>i.slidesToShow&&preload(["/inc/scripts/vendor/slick/slick.min.js"],function(){$(n).slick(t.$eval(a.appMdSlickGallery))})})}}}]),app.directive("appMdOnlineBonus",["$http",function(e){return{restrict:"A",link:function(t,n){e.get("/ajax/vvl_treueguthaben.php").then(function(e){$(n).html(e.data.value)})}}}]),app.directive("appMdResponsiveCarousel",function(){return{link:function(e,t){try{$(t).ResponsiveCarousel()}catch(n){}}}}),app.directive("msisdn2Phone",function(){return function(e){if(!angular.isString(e))return e;var t="0"+e.substring(3,6);return t+=13===e.length?" - "+e.substring(6,9)+" "+e.substring(9,11)+" "+e.substring(11,e.length):" - "+e.substring(6,9)+" "+e.substring(9,12)+" "+e.substring(12,e.length)}}),app.directive("appFocus",function(){function e(e,t){var n=!1,a=e.find(".error");angular.forEach(t.$error,function(e,t){return e===!0&&a.find("."+t).length?(n=t,!1):void 0}),n?(a.children().hide(),a.find("."+n).show()):a.children().length>1&&(a.children().hide(),a.find(".default").show())}return{restrict:"A",require:"ngModel",link:function(t,n,a,r){r.$focused=!1;var i=n.closest(".form-item");n.bind("focus",function(){n.hasClass("is-visited")||r.$valid!==!0||(n.addClass("is-visited"),i.removeClass("is-invalid"),t.$digest(function(){r.$focused=!0}))}).bind("blur",function(){r.$valid===!1?i.addClass("is-invalid"):i.find(".ng-invalid").length>0||i.removeClass("is-invalid"),e(i,r),t.$digest(function(){r.$focused=!1})})}}}),app.directive("appMdFileUpload",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,a){$(t).before($('<div class="fake-control"><input type="text" /><button type="button" class="btn"><i class="far fa-paperclip"></i>Datei auswählen</button></div>')).change(function(){$(this).prev(".fake-control").find("input").val($(this).val())}),a.$render=function(){a.$setViewValue(t.val())},t.bind("change",function(){e.$apply(function(){a.$render();var e,t;try{e=n.ngPattern.match(new RegExp("^/(.*?)/([gimy]*)$")),t=new RegExp(e[1],e[2])}catch(r){t=/\.(tif|TIF|gif|GIF|jpg|jpeg|JPEG|JPG|png|PNG|bmp|BMP|PDF|pdf)/}var i=a.$viewValue,o=t.test(i);a.$setValidity("filetype",o)})})}}}),app.directive("appMdValidate",["$compile",function(e){var t={name:/^[A-Za-z0-9äöüßÖÄÜ\.\- ]{0,100}$/,street:/^[A-Za-zäöüßÖÄÜ\.\- ]{0,100}$/,email:/^[a-zA-Z0-9][a-zA-Z0-9\.\-\+_]*@[a-zA-Z0-9][\w\.-]*[a-zA-Z0-9]\.[a-zA-Z][a-zA-Z\.]*[a-zA-Z]$/,msisdn:/^(?:\+49|0(?:0?49)?)1[0-9]{2,3}(?:\/|-)?[0-9]{7,8}$/,number:/^[0-9]+$/,password:/^(?=.*[A-Z].*)(?=.*[a-z].*)(?=.*[0-9].*)(?!.*[\s\\\\<>#%&]).{5,20}$/,phone:/^(?:\+49|0(?:0?49)?)[0-9]{2,5}[/-]?[0-9]{5,8}$/,zip:/^[0-9]{5}$/,birthDate:/^(0[1-9]|[12][0-9]|3[01])\.(0[1-9]|1[012])\.(19|20)\d\d$/,imei:/^(|:|\/|_|-|\w)+$/,iban:/^[a-zA-Z0-9]{22}$/,de_iban:/^de[a-z0-9]{20}$/i,int_iban:/^[a-zA-Z]{2}[0-9]{2}[a-zA-Z0-9]{4}[0-9]{7}([a-zA-Z0-9]?){0,16}$/,bic:/^\w{4}(de|at)\w{2}(\w{3})?$/i,de_bic:/^\w{4}de\w{2}(\w{3})?$/i,int_bic:/^[a-z]{6}[0-9a-z]{2}([0-9a-z]{3})?$/i,addressPrefix:/^[A-Za-z0-9äöüßÖÄÜ\.\-\&\:\/ ]+$/};return{restrict:"A",terminal:!0,priority:1e3,link:function(n,a,r){t[r.appMdValidate]&&(a.attr("ng-pattern",t[r.appMdValidate]),a.removeAttr("app-md-validate"),e(a)(n))}}}]),app.directive("ngMatch",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,a){e.$watch(function(){var t=n.ngMatch.indexOf(".")?angular.getDeep(e,n.ngMatch):e[n.ngMatch],r=angular.isUndefined(a.$modelValue)?a.$$rawModelValue:a.$modelValue,i=a.$pristine&&angular.isUndefined(r)||t===r;return i},function(e){a.$setValidity("match",e)})}}}),app.directive("appMdAddressChange",["addressService",function(e){return{restrict:"A",transclude:!0,templateUrl:"/partials/helper/alternateAddress.html",link:function(t){t.checkTowns=function(n){n.length>=5&&e.checkTowns(n).then(function(e){t.townList=e})},t.checkStreets=function(n,a){e.checkStreets(n,a).then(function(e){t.streetList=e})}}}}]),app.directive("appMdFormZip",["$compile","addressService",function(e,t){return{restrict:"A",require:"ngModel",link:function(e,n,a){e.$watch(a.ngModel,function(a){n.controller("ngModel").$valid&&t.checkTowns(a).then(function(t){e.__zip=a,e.townList=t})})}}}]),app.directive("appMdFormTown",["$compile","addressService",function(e,t){return{restrict:"A",require:"ngModel",link:function(e,n,a){e.$watch(a.ngModel,function(){e.isLoadingStreets=!0,t.checkStreets(e.__zip).then(function(t){e.streetList=t})["finally"](function(){e.isLoadingStreets=!1})})}}}]),app.directive("mdNumberInput",function(){return{restrict:"A",require:"ngModel",scope:{model:"=ngModel",start:"=?start"},link:function(e,t,n){var a=48,r=57,i=8,o=e.$eval(n.mdNumberInput),s=o.max?parseFloat(o.max):null,c=o.min?parseFloat(o.min):null;angular.element(t).on("keydown",function(e){g(e.keyCode)||(e.preventDefault(),e.stopPropagation())}),angular.element(t).on("change",function(){p()});var l=function(){return!u(s)&&e.model>s},d=function(){return!u(c)&&e.model<c},u=function(e){return null===e||void 0===e||isNaN(e)},g=function(e){return e>=a&&r>=e||e===i},p=function(){e.model=parseFloat(e.model),l()?e.model=s:d()&&(e.model=c)};e.model=e.start||e.model||1}}}),app.directive("mdSuggest",function(){var e=2;return{restrict:"A",require:"ngModel",scope:{targetUrl:"@mdSuggest",mdAutocomplete:"@mdAutocomplete",search:"=ngModel",onSelect:"=onSelect",mdAutosuggest:"@mdAutosuggest"},controller:["$scope","$http","$log","$filter","$timeout",function(t,n,a,r,i){t.isLoading=!1,t.selectedPhrase=!1,t.showPresuggestions=!1,t.showSuggestions=!1,n.get(t.mdAutosuggest).then(function(e){t.presuggestions=e.data})["finally"](function(){t.isSearching=!1}),t.$watch("search",function(a,o){if(!t.isLoading&&a!==o&&a!==t.selectedPhrase&&"/"!==t.targetUrl)if(a.length>=e)if(t.$parent.spellCheck||t.$parent.completion||t.$parent.speech)t.$parent.spellCheck=!1,t.$parent.completion=!1,t.$parent.autocomplete=!1,t.$parent.partOFautocomplete=!1;else{t.$parent.searchLength=!0;var s,c=[];t.close("preSearch"),t.isLoading=!0,n.get(t.targetUrl+encodeURIComponent(a)).then(function(e){angular.forEach(e.data,function(e){-1===c.indexOf(e.search_realm)&&c.push(e.search_realm),s=e[Object.keys(e)[1]]}),t.facette=c,t.suggests=r("sortAfterCategorie")(e.data),t.close("preSearch"),t.selectedPhrase||t.$root.searchcomplete?(t.$root.searchcomplete=!1,t.selectedPhrase=!1):t.open()})["finally"](function(){t.isLoading=!1}),n.get(t.mdAutocomplete+encodeURIComponent(a)).then(function(e){t.autocomplete=e.data,t.$parent.autocomplete=e.data;var n=e.data.toLowerCase().split(a.toLowerCase());t.partOFautocomplete=n[1],t.$parent.partOFautocomplete=n[1],$("#hidden-text").text($(".search-header input").val());var r=document.getElementById("hidden-text").offsetWidth+11;i(function(){$(".autocompletion").css("left",r)},20)})}else 0===a.length?(t.open("preSearch"),t.showSuggestions=!1):(t.$parent.autocomplete=!1,t.$parent.partOFautocomplete=!1)}),t.open=function(e){e?t.showPresuggestions=!0:t.showSuggestions=!0},t.select=function(e,n,a){n?(t.selectedPhrase=r("cutmd")(n[e].title),t.search=r("cutmd")(n[e].title)):(t.selectedPhrase=e,t.search=e),i(t.onSelect,10),t.$parent.gaParamSugessts=a,t.close(),t.close("preSearch"),t.showSuggestions=!1,t.showPresuggestions=!1,t.$parent.autocomplete=!1,t.$parent.partOFautocomplete=!1},t.close=function(e){e?t.showPresuggestions=!1:t.showSuggestions=!1,t.selectedIndex=-1,t.suggestindex=-1},t.$root.$on("search:close",function(){$(".search-header input").blur()})}],link:function(e){var t={left:37,up:38,right:39,down:40,enter:13,esc:27,tab:9,backspace:8},n=$(".search-header input");e.selectedIndex=-1,e.suggestindex=-1,n.on("focus",function(){e.isSearching||0===e.$parent.nrResults||e.search||e.open("preSearch")}),n.on("blur",function(){e.close(),e.close("preSearch")}),$(document).on("scroll",e.close),n.on("keydown",function(a){var r=a.keyCode||a.which;switch(r){case t.down:e.showPresuggestions?e.selectedIndex<e.presuggestions.length&&e.selectedIndex++:e.suggestindex<e.suggests.length&&e.suggestindex++;break;case t.up:e.showPresuggestions?e.selectedIndex>-1&&e.selectedIndex--:e.suggestindex>-1&&e.suggestindex--;break;case t.tab:case t.right:a.preventDefault(),a.stopPropagation(),""!==n.val()&&""!==e.$parent.autocomplete&&e.select(e.$parent.autocomplete.trim(),!1,"autocmplete");break;case t.enter:-1!==e.selectedIndex||-1!==e.suggestindex?(a.preventDefault(),a.stopPropagation(),e.showPresuggestions?e.select(e.selectedIndex,e.presuggestions,"most"):e.select(e.suggestindex,e.suggests,"suggest")):e.onSelect(),e.close();break;case t.esc:e.showSuggestions&&(a.preventDefault(),e.close(),e.close("preSearch"));break;case t.backspace:e.showSuggestions&&""===e.search&&(e.close(),e.open("preSearch"))}e.$apply()})},template:'                <div class="bg-white grid-full is-relative no-padding-top">                    <div class="inner-wrapper">                        <div class="search-content search-result-page grid-xl-8 grid-xl-pp-2 grid-xl-ap-2 grid-l-clear">                            <div ng-class="{\'is-active\':(presuggestions && presuggestions.length > 0 && showPresuggestions)}" class="presuggestion-container">                                <ul class="presuggestlist" ng-show="presuggestions && showPresuggestions">                                    <li class="is-blue-60">Meist gesucht</li>                                    <li ng-repeat="sug in presuggestions track by $index" ng-click="select($index, presuggestions,\'most\')" ng-class="{active: ($index==selectedIndex), last: $last}">                                        {{sug.title}}                                    </li>                                </ul>                            </div>                        </div>                        <div class="search-content search-result-page grid-xl-8 grid-xl-pp-2 grid-xl-ap-2 grid-l-clear">                            <div class="frequent clearfix" ng-show="showSuggestions && facette.length > 0">                                <ul class="suggestlist">                                  <li ng-repeat="tag in facette | sort track by $index"  data-icon="{{tag | icons}}">                                    <h4>{{tag | facetten}}</h4>                                    <div ng-repeat="suggest in suggests track by $index" ng-click="select($index, suggests, \'suggest\')" ng-if="tag === suggest.search_realm" ng-class="{active: ($index==suggestindex), last: $last}">                                      <span style="color:#7a8394;" ng-bind-html="suggest.title | cutmd | txt2html:search:\'<em>\'+search+\'</em>\'"></span>                                    </div>                                </div>                              </li>                            </ul>                        </div>                    </div>                </div>'}}),app.directive("apiForm",["ApiFormValidationService","RequestService",function(e,t){function n(e,n,i,o){var s,c=n.find("button[type=submit]");r=n,c&&n.on("submit",function(n){n.preventDefault(),s=t.post(i.apiForm,e[i.apiVars]),s["finally"](a.bind(null,o,s))})}function a(t,n){n&&n.then&&(e.reset(t),n.then(function(){r.removeClass("api-error").addClass("api-success").attr("status",200),e.setValid(t)},function(n){r.attr("status",n.status).addClass("api-error-"+n.status).removeClass("api-success"),e.applyErrors(t,n)}))}var r;return{restrict:"A",require:"form",link:n}}]),app.directive("apiValidate",["$timeout",function(e){function t(e,t,r,i){var o=[];i.$registerApiError=a.bind(null,i,t,o),t.on("change",n.bind(null,i,o))}function n(e,t){for(;t.length;)e.$setValidity(t.shift(),!0);return!0}function a(t,n,a,r){a.push(r),t.$setValidity(r,!1),e(function(){n.trigger("blur")})}return{require:"ngModel",restrict:"A",link:t}}]),app.directive("appMdFormDateTimestamp",["DateService",function(e){return{require:"ngModel",restrict:"A",link:function(t,n,a,r){r.$parsers.push(function(t){return e.dateToTimestamp(t)}),r.$formatters.push(function(e){if(!e)return"";var t=new Date(1e3*e);return(t.getDate()<10?"0"+t.getDate():t.getDate())+"."+(t.getMonth()<10?"0"+t.getMonth():t.getMonth())+"."+t.getFullYear()})}}}]),app.controller("DSPCtrl",["$scope","$location","WizardHandler","ErrorService","dspService",function(e,t,n,a,r){var i=this;i.dsp={},i.newcode="",i.isLoading=!0,e.setBreadcrumb([{url:"#/meine-daten",title:"Meine Daten"},{url:"#/meine-daten/datenschutzkennwort-aendern",title:"Datenschutzkennwort ändern"}]);var o=r.getCodeword();o.then(function(e){i.dsp=e.data,i.isLoading=!1},function(e){404===e.status&&(i.dsp.codeword="-"),i.isLoading=!1}),i.backToStart=function(){t.path("/meine-daten")},i.saveCodeword=function(e){r.saveCodeword(e).then(function(e){delete i.errorMessage,i.taskId=e.data.taskId,n.wizard().next()},function(e){n.wizard().previous(),i.errorMessage=a.getMessage(e.data.code),i.isLoading=!1})}}]),app.factory("dspService",["$q","$http","UrlService",function(e,t,n){function a(){return t.get(n.getUrl("dsp"))}function r(a){if(angular.isString(a)&&a.length){var r={codeword:a};return t.put(n.getUrl("dsp"),r)}return e.defer().reject("Invalid Codeword")}return{getCodeword:a,saveCodeword:r}}]),app.controller("InsurancesCtrl",["$log","$scope","RequestService","AuthService2","ErrorService","InsurancesService",function(e,t,n,a,r,i){function o(){var r={vendors:n.get("vendors",{channel:l}),devices:n.get("devices",{channel:l,group:"pdb_hersteller_id",noVariants:1}),owner:a.getCustomerData()},i={vendorsSuccess:function(e){c=e.data.vendors,t.updateVendors()},devicesSuccess:function(e){t.devices=e.data.devices},ownerSuccess:function(e){t.email=e.email},error:function(t,n){e.debug("Error for promise "+n),e.error(t),s(t)},done:function(){t.isPromise=!1}};n.handlePromises(r,i)}function s(t){e.error("_handleResponseError()",t),r.modalError("/partials/modal_redir.html",r.parseResponseError(t),{label:'Zu "Meine Daten"',link:"#/meine-daten"})}t.setBreadcrumb([{url:"#/meine-vertraege",title:"Meine Verträge"},{url:"#/meine-vertraege/vertragsdetails",title:"Vertragsdetails"},{url:"#/meine-vertraege/vertragsdetails/handyversicherung",title:"Handyversicherung"}]);var c,l="handyfinder";t.isPromise=!0,t.classic=!1,t.premium=!1,t.selection={productVariantId:null,vendor:null,device:null,hwImei:null},i.getInsurances().then(function(n){var a=i.handleInsurances(n.data);e.debug("Controller getInsurances()",a),angular.forEach(a,function(e,t){var n=a[t].name.replace(" SP Handy","");a[t].name="Schutzpaket "+n}),t.insurances=a,o()},s),t.updateVendors=function(){var e;t.vendors=c,t.classic=!1,t.premium=!1,t.selection.productVariantId&&(e=t.insurances[t.selection.productVariantId],"comprehensiveProtectionClassic"===e.category?t.classic=!0:t.premium=!0)},t.updateDevices=function(){t.vendorDevices=t.devices[t.selection.vendor]},t.orderInsurance=function(){var n=t.selection,a={productVariantId:n.productVariantId,hwProvider:t.vendors[n.vendor].name,hwName:t.devices[n.vendor][n.device].name,hwImei:"-",email:t.email};i.orderInsurance(a).then(function(n){var a=n.data;e.debug("data",a),t.taskId=a.taskId},function(n){var a=n.data;e.error(a),t.errorMessage=r.getMessage(a.code)})}}]),app.factory("InsurancesService",["$log","RequestService",function(e,t){function n(e){var n={};return e&&(n.filter=e),t.get("insurances",n)}function a(t){var n={};return angular.forEach(t,function(e,t){if(!/notebook/i.test(e.name)){var a={};e.variantId=parseInt(t,10),angular.forEach(e.additionalInformation,function(t,n){var r=parseFloat(t.value);isNaN(r)?a[n]={title:t.name,desc:t.value}:a[n]={title:t.name,price:r},"grossAmountYear2"===n&&(e.price=t.value)}),e.additionalInformation=a,n[t]=e}}),e.debug("response",n),n}function r(e){return t.post("insuranceOrder",e)}return{getInsurances:n,orderInsurance:r,handleInsurances:a}}]),app.controller("InvoiceCtrl",["$scope","$log","$location","$timeout","invoiceService","addressService","contractsService","RequestService","ErrorService","WizardHandler",function(e,t,n,a,r,i,o,s,c,l){e.isLoading=!0,e.setBreadcrumb([{url:"#/meine-daten",title:"Meine Daten"},{url:"#/meine-daten/rechnungsadresse-aendern",title:"Rechnungsadresse ändern"}]);var d={invoice:r.getInvoiceAddress(),contract:o.getDetails()},u={invoiceSuccess:function(t){var n=t.data;e.invoiceForm={},e.invoiceFormOriginal=n},contractSuccess:function(t){e.contract=t},always:function(){e.isLoading=!1}};s.handlePromises(d,u),e.checkTowns=function(t){i.checkTowns(t).then(function(t){e.townList=t})},e.checkStreets=function(t,n){i.checkStreets(t,n).then(function(t){e.streetList=t,a(function(){$("#street").trigger("focus").trigger("blur")})})},e.saveInvoiceAddress=function(){delete e.invoiceChangeError,e.isLoading=!0,r.saveInvoiceAddress(e.invoiceForm).then(function(t){e.isLoading=!1,e.invoiceChange=!0,e.taskIdInvoice=t.data.taskId},function(n){t.info("invoiceAddressChangeError",n),e.isLoading=!1,e.invoiceChange=!0,e.invoiceChangeError=c.getMessage(n.data.code),l.wizard().goTo(0)})},e.backToStart=function(){n.path("/meine-daten")}}]),app.factory("invoiceService",["$q","$log","$injector","RequestService",function(e,t,n,a){function r(){return a.get("invoiceAddress")}function i(){return r().then(function(e){return t.debug("requestInvoiceAddress answer",e),angular.isDefinedDeep(e,"data.address.street")&&(addressService=n.get("addressService"),addressService.convertAddress(e.data)),e},function(e){return t.info("getInvoiceAddressError",e),{}})}function o(){return a.get("invoiceEmail")}function s(e){t.info("saveInvoiceAddress",e);var n=e.address.street+" "+e.address.streetNr,r={name:{salutation:e.name.salutation,nameAffix:""},address:{street:n.trim(),postalCode:e.address.postalCode,prefix:e.address.prefix||"",city:e.address.city}};return"Firma"===r.name.salutation?(r.name.companyName=e.name.companyName,r.name.companyNameAppendix=""):(r.name.firstName=e.name.firstName,r.name.lastName=e.name.lastName),a.put("invoiceAddress",r)}return{requestInvoiceAddress:r,getInvoiceAddress:i,getInvoiceEmailAddress:o,saveInvoiceAddress:s}}]),app.controller("InvoiceEmailCtrl",["$scope","$log","InvoiceEmailService","contractsService","RequestService","ErrorService",function(e,t,n,a,r,i){function o(e){t.debug("Deprecated: Wiredminds ausgebaut",e)}window.location.href=window.location.protocol+"//"+window.location.host+"/onlineservice/meine-daten/rechnungsemail-aendern",e.isLoading=!0,e.setBreadcrumb([{url:"#/meine-daten",title:"Meine Daten"},{url:"#/meine-daten/rechnungsemail",title:"Rechnungsemail"}]),e.email={};var s={email:n.getInvoiceMail(),contract:a.getDetails()},c={emailSuccess:function(t){t.data.code?e.errorMessage=i.getMessage(t.data.code):e.responseEmail=t.data},contractSuccess:function(t){e.contract=t},always:function(){e.isLoading=!1}};r.handlePromises(s,c),e.saveInvoiceEmail=function(){n.saveEmail(e.email.emailNew).then(function(t){e.taskId=t.data.taskId,o(!0)},function(t){e.errorMessage=i.getMessage(t.data.code),o(!1)})}}]),app.factory("InvoiceEmailService",["$q","$http","UrlService","RequestService",function(e,t,n,a){
function r(){return a.get("invoiceEmail")}function i(){var t=e.defer();return r().then(function(e){t.resolve(e)},function(e){t.resolve(e)}),t.promise}function o(e){return a.put("invoiceEmail",{email:e})}return{getInvoiceMail:i,saveEmail:o}}]),app.controller("JobsCtrl",["$log","$scope","jobsService",function(e,t,n){t.isLoading=!0,t.setBreadcrumb([{url:"#/meine-auftraege",title:"Meine Aufträge"}]);var a=n.getJobs();a.then(function(e){200===e.status&&(t.jobs=e.data),t.isLoading=!1},function(n){e.debug("JobsCtrl: There was an error...",n),t.isLoading=!1})}]),app.factory("jobsService",["AuthService2","RequestService",function(e,t){function n(){return e.getCustomerData().then(function(e){return t.get(e.getLink("orders"))})}return{getJobs:n}}]),app.controller("MarketingCtrl",["$scope","$location","$window","AuthService2","marketingService","ErrorService",function(e,t,n,a,r,i){window.location.href=window.location.protocol+"//"+window.location.host+"/onlineservice/meine-daten/informationsservice";var o=n.dataLayer;e.isLoading=!0,e.getPermitValue=function(t){e.marketing.permitValue=t.target.value},e.setBreadcrumb([{url:"#/meine-daten",title:"Meine Daten"},{url:"#/meine-daten/einwilligung",title:"Einwilligung"}]),a.getCustomerData().then(function(t){e.marketing=t.marketingPermit,e.isLoading=!1}),e.setMarketingInfo=function(){e.isLoading=!0,r.setMarketingInfo(e.marketing.permitValue).then(function(t){"VOICE"===e.marketing.permitValue&&o.push({event:"gaClick",eventCategory:"Kunde",eventAction:"Werbeerlaubnis VOICE",eventLabel:"Meine Daten"});var n=t.data;e.isLoading=!1,e.taskid=n.taskId},function(){e.isLoading=!1,e.errorMessage=i.getMessage(503)})},e.backToStart=function(){t.path("/meine-daten")}}]),app.factory("marketingService",["$q","RequestService","AuthService2",function(e,t,n){function a(a,r){return a=a||"VOICE",r=r||{},n.getCustomerData().then(function(n){var i=n.getLink("changeMarketingPermit");return i?t.put(i,_.extend({permitValue:a,nboId:0},r)):e.reject("User not allowed to change marketing permit")})}return{setMarketingInfo:a}}]),app.controller("MiniCartCtrl",["$scope","$rootScope","$sce","minicartService",function(e,t,n,a){function r(){i.isCartLoading=!0,i.showLayer&&a.getCart().then(function(e){i.isCartLoading=!1,i.cartHTML=n.trustAsHtml(e.data)},function(){i.isCartLoading=!1})}var i=this;i.showLayer=!1,i.basketCount=function(){var e=$.cookie("_eio_cart");return e?e:0},i.toggle=function(t){if(i.isCartLoading=!0,i.showLayer=t||!i.showLayer,i.showLayer){var n=window.location.href.indexOf("www."),a="/theme/css/md-web.min.css",r="www-git.freenet-mobilfunk.de";n>-1&&(r="www.freenet-mobilfunk.de"),window.loadCSS("//"+r+a,window.document.getElementsByTagName("link")[0],"all"),e.$root.$broadcast("navLayer","minicart")}else e.$apply()},e.$on("navLayer",function(e,t){"minicart"!==t?i.showLayer=!1:r()}),$(".shopping-cart-block").hover(function(){i.toggle(!0)},function(){i.toggle(!1)}).on("keydown",function(t){const n=t.key;return"Enter"===n||" "===n?(t.preventDefault(),e.$apply(function(){i.toggle(!1)}),!1):void 0}),$(".shopping-cart-block").on("focusout",".cart-header-mini__cart-button",function(){i.toggle(!1)}),$(".shopping-cart-block").find("a.md-header__top-bar-nav-icon").on("focus",function(){e.$apply(function(){t.$broadcast("navLayer","minicart")})}),e.$on("$routeChangeStart",function(){i.showLayer=!1})}]),app.factory("minicartService",["RequestService","UrlService",function(e,t){function n(){return e.get(t.getUrl("minicart"))}return{getCart:n}}]),app.controller("newsletterCtrl",["$log","$q","$http","$scope","AuthService2","dataService","ErrorService","UrlService","formdata","close",function(e,t,n,a,r,i,o,s,c,l){function d(t){e.debug("Deprecated: Wiredminds ausgebaut",t)}function u(){var n=r.getCurrentContractDetails(),o=i.getSummary(),s={details:n,data:o};a.isPromise=!0,t.allSettled(s).then(function(t){var n;e.debug(t),t.data.resolved&&(n=t.data.value,a.nl.firstname=n.name.firstName,a.nl.lastname=n.name.lastName,a.nl.gender=n.name.salutation,m.title=n.name.title),t.details.resolved&&(n=t.details.value,m.msisdn=n.msisdn,m.type=n.contractType,m.payment=n.tariffPaymentType),g()})}function g(){a.nl.email=c.usermail,a.isPromise=!1}function p(){e.debug(c),a.userTypeTitle="customer"===c.usertype?"Kunden":"Interessenten"}var f=t.defer(),m={};p(),a.buttonLoginText="Login",a.buttonNewsletterText="Newsletter anmelden",a.cssClass=c.cssClass,a.nl={},a.isPromise=!1,a.showLoginForm=!r.isLoggedIn()&&"customer"===c.usertype,a.showNewsletterForm=!a.showLoginForm,a.showThx=!1,c.headline&&(a.headline=c.headline),a.showLoginForm?a.logdata={username:c.usermail}:r.isLoggedIn()?u():g(),a.closeModal=function(e){f.resolve(),l(e)},a.login=function(){a.isPromise=!0,a.buttonText="Bitte warten…",a.errorMessage="",r.login(a.logdata,"none").then(function(){a.errorMessage="",a.buttonText="Login",a.showLoginForm=!1,a.showNewsletterForm=!0,u()},function(e){e.error&&(a.isPromise=!1,a.buttonText="Login",a.errorMessage=e.error)})},a.submitNewsletter=function(){var t=angular.copy(a.nl);a.errorMessage="",a.isPromise=!0,_.extend(t,{eventid:c.eventid,isCredit:Number("TELCO"===m.type&&"CREDIT"===m.payment),isPrepaid:Number("TELCO"===m.type&&"DEBIT"===m.payment),isShop:Number(r.isProspect()||"OTHER"===m.type),msisdn:m.msisdn||"",origin:c.origin,title:m.title||"",vp_nummer:c.vp_nummer,permissionverwaltung:c.permission}),e.debug(t),n.post(s.getUrl("newsletter"),t,{headers:{"Content-Type":"application/json"}}).then(function(t){e.debug("Success",t),a.isPromise=!1,t.data.error?(a.errorMessage=t.data.message,d()):t.data.success?(a.showNewsletterForm=!1,a.showThx=!0,d(!0)):(a.errorMessage=o.getMessage(),d())},function(t){d(),e.debug("Error",t),a.isPromise=!1,a.errorMessage=o.getMessage(t.data.code||t.status)})}}]),app.controller("newsletterShortCtrl",["$log","$scope","AuthService2","ModalService",function(e,t,n,a){function r(){i.loggedIn&&(i.usertype=n.isProspect()?"prospect":"customer")}var i=this,o=Math.random().toString(36).slice(2),s={origin:"Reg_Formular",eventid:"",vp_nummer:""};i.loggedIn=n.isLoggedIn(),r(),t.$watch(n.isLoggedIn,function(e){i.loggedIn=e,r()}),this.submit=function(){e.debug(i,t),i.invalidType=_.isEmpty(i.usertype),i.invalidMail=_.isEmpty(i.usermail),i.invalidMail||i.invalidType||(i.isLoading=!0,s.usertype=i.usertype,s.usermail=i.usermail,s.cssClass=i.cssClass||"nl__default",s.permission=i.permission||"Interessentennewsletter",i.headline&&(s.headline=i.headline),a.showModal({templateUrl:"/partials/newsletter.html",controller:"newsletterCtrl",inputs:{formdata:s}}).then(function(e){i.isLoading=!1,jqCustom.Modal.show(e.element,o),e.close.then(function(e){e&&(i.usertype=i.usermail=null),jqCustom.Modal.hide()})}))}}]),app.controller("optionsCtrl",["$window","$location","$log","$route","$scope","$rootScope","$timeout","AuthService2","ErrorService","ModalService","optionsService","WizardHandler","TeaserEngine",function(e,t,n,a,r,i,o,s,c,l,d,u,g){function p(e){r.subGroups=e,r.currentSubGroup&&o(function(){if($("#"+r.currentSubGroup).length&&window.scrollTo(0,$("#"+r.currentSubGroup).offset().top-$("header").height()),t.search().option){var e;if(n.debug("Direct link to option"),angular.forEach(r.subGroups,function(n,a){a===r.currentSubGroup&&angular.forEach(n,function(n){n.productId===+t.search().option&&(e=n)})}),e){var a=s.getUser();a.isAgent?(i.isAgent=!0,n.debug("userAgent cannot book options")):(r.isLoading=!0,r.isBuildingCart=!0,e.isSelected=!0,n.debug("calling updateOption on targetOption"),d.updateOption(e).then(r.prepareOrder,n.debug))}else n.debug("No Option with ID "+t.search().option+" was found!"),f(+t.search().option,t.search().asDom)}}),r.isLoading=!1,r.isLoadingOptions=!1}function f(e,t){l.showModal({templateUrl:"/partials/modal_option_not_found.html",controller:["optionId","hybrisId","$scope",function(e,t,n){n.optionId=e,n.hybrisId=t}],inputs:{optionId:e,hybrisId:t}}).then(function(e){jqCustom.Modal.show(e.element)},function(e){n.debug("_showOptionsNotFoundModal",e)})}function m(e){_.each(r.subGroups,function(t){_.each(e,function(e){t.hasOwnProperty(e.id)&&(angular.isDefined(e.selected)&&(t[e.id].isSelected=e.selected,"StreamOn"===t[e.id].groupName&&(r.StreamOn=t[e.id].productId),"StreamOn Gaming"===t[e.id].groupName&&(r.StreamOnGaming=t[e.id].productId)),angular.isDefined(e.changeable)&&(t[e.id].changeable=e.changeable))})}),r.noOptionChange=!1,r.isOptionChange=!1}function h(){w&&w.abort(),w=d.getOptions(r.currentGroup),w.then(function(e){n.debug(e),p(e)},v)}function v(e){n.warn(e),r.isLoading=!1,r.isLoadingOptions=!1,r.isOptionChange=!1,r.errorMessage=c.getMessage(e.data.code||e.status)}window.location.href=window.location.protocol+"//"+window.location.host+"/onlineservice/meine-vertraege/optionen-anpassen";var b,w,y=a.current.params,k=e.dataLayer;r.isLoading=!0,r.isLoadingOptions=!1,r.isOptionChange=!1,r.StreamOn=!1,s.getCurrentContractDetails().then(function(e){r.contract=e}),r.setBreadcrumb([{url:"#/meine-vertraege",title:"Meine Verträge"},{url:"#/meine-vertraege/vertragsdetails",title:"Vertragsdetails"},{url:"#/meine-vertraege/vertragsdetails/zusatzoptionen",title:"Zusatzoptionen"}]),r.options={},r.noOptionChange=!0,r.products=[],r.totalCost=[],b=d.getGroups(),b.then(function(e){r.groups=e,y&&y.group&&e[y.group]?(r.currentGroup=y.group,y.option&&(r.currentSubGroup=y.option)):r.currentGroup=Object.keys(e)[0],h()},v),r.changeGroup=function(e){n.debug(e+" clicked"),r.errorMessage="",r.noOptionChange=!0,r.currentGroup=e,r.currentSubGroup=null,r.isLoadingOptions=!0,r.options={},h()},r.changeOption=function(e){var t;r.errorMessage="",r.isOptionChange=!0,n.debug(e),t=d.updateOption(e),t.then(m,v)},r.orderOptions=function(){r.errorMessage="",r.isLoadingOptions=!0,d.executeOrder().then(function(e){n.debug(e),r.taskId=e.taskId,r.isLoadingOptions=!1;var t=0;angular.forEach(r.totalCost,function(e){t+=e}),k.push({event:"checkout",ecommerce:{checkout:{actionField:{step:2}}}}),k.push({event:"checkout",ecommerce:{checkout:{actionField:{step:3}}}}),k.push({event:"purchase",ecommerce:{purchase:{actionField:{id:sha256(r.contract.msisdn+"85187407"),affiliation:"Zusatzoptionen",revenue:t/100,tax:t/100/119*19,shipping:0},products:r.products}}}),g.trackTransaction("tarifoptionen")})},r.prepareOrder=function(){var e;r.isOptionChange=!0,r.errorMessage="",r.products=[],e=d.getChangesPromise(),e.then(function(e){console.log("changed response",e),r.isLoading=!1,r.isOptionChange=!1,r.changedOptions=e,angular.forEach(r.changedOptions.add,function(e,t){r.totalCost.push(e.priceInfoRecurrent),r.products.push({name:e.label,id:t,price:e.priceInfoRecurrent/100,brand:"brand",category:e.label.includes("Gutschrift")?"Promotion":"Zusatzoption",quantity:1})}),k.push({event:"addToCart",ecommerce:{currencyCode:"EUR",add:{products:r.products}}}),k.push({event:"checkout",ecommerce:{checkout:{actionField:{step:1},products:r.products}}}),u.wizard().next(),window.scrollTo(0,100)},v)}}]),angular.module("md").factory("optionsService",["$http","$log","$q","UrlService","RequestService",function(e,t,n,a,r){var i=function(){function i(e){var t=[];return _.each(e,function(e){_.each(e,function(e,n){e.isSelected!==f[n].isSelected&&t.push(e)})}),t}function o(){var t=n.defer();return e.get(a.getUrl("getOptionsSummary")).then(function(e){e.data.code?t.reject(e):204===e.status&&(e.data={code:50204},t.reject(e)),m.options=e.data,t.resolve(e.data)},function(e){return t.reject(e)}),t.promise}function s(){var e=n.defer();return r.get("getOptions").then(function(t){t.data.code?e.reject(t):204===t.status&&(t.data={code:50204},e.reject(t)),p=t.data,e.resolve(p)},function(t){e.reject(t)}),e.promise}function c(t){var a,r,i="/api"+p[t].Links,o=n.defer();return m.group=p[t].virtualGroupname,r=e({method:"GET",url:i,flush:!1,timeout:o.promise}),a=r.then(function(e){var a;return e.data.code?n.reject(e):(a=e.data[t],delete a.virtualGroupname,d(angular.copy(a)),a)},function(e){return n.reject(e)}),a.abort=function(){o.resolve()},a["finally"](function(){a.abort=angular.noop,o=r=a=null}),a}function l(){return e.post(a.getUrl("getOptions")).then(function(e){return e.data.code?(u(!1),n.reject(e)):(u(!0),e.data)},function(e){return u(!1),n.reject(e)})}function d(e){f={},_.each(e,function(e){_.each(e,function(e,t){f[t]=e})})}function u(e){t.debug("Deprecated: Wiredminds ausgebaut",e)}function g(a){var r,i=a.links.putOption,o="DELETE";return a.isSelected&&(o="PUT",i=a.links.deleteOption),t.debug("Sending http request with ",o," to ",i),r=e({method:o,url:"/api"+i,flush:!1}).then(function(e){return e.data.code?n.reject(e):e.data},function(e){return n.reject(e)})}var p,f,m={group:"",options:{}};return{executeOrder:l,getChanges:i,getChangesPromise:o,getGroups:s,getOptions:c,updateOption:g}}();return i}]),app.filter("withoutGroupname",function(){return function(e){var t={};return angular.forEach(e,function(e,n){angular.isObject(e)&&(t[n]=e)}),t}}),app.filter("optionRuntime",function(){return function(e){var t="(";switch(Number(e)){case 0:t+="Keine";break;case 1:t+="1 Monat";break;default:t+=e+" Monate"}return t+=" Laufzeit)"}}),app.filter("optionDates",["$filter",function(e){return function(t){var n="dd.MM.yyyy",a=Date.now(),r=1e3*t.startDate,i=t.endDate?1e3*t.endDate:null,o="";return a>r+864e5?(o="Die Option gebucht seit: "+e("date")(r,n),i&&(o+=" | Deaktiviert zum "+e("date")(i,n))):t.isSelected&&(o="Bei Abschluss wird die Option gebucht zum: "+e("date")(r,n)),o}}]),app.filter("isObject",function(){return function(e){var t={};return angular.forEach(e,function(e,n){angular.isObject(e)&&(t[n]=e)}),t}}),app.controller("ewpController",["$log","$scope","RequestService","addressService","ErrorService","bankService",function(e,t,n,a,r,i){function o(e){var n=_.sortBy(_.toArray(e.data.vendors),"name")||[];t.vendors=n}function s(n){var a=_.values(n.data.devices);e.debug("devices",a),t.devices=a}t.isLoading=!0,t.isPromise=!1,t.form={},t.requiresBicInput=function(){return t.ewpform.iban.$viewValue?null===t.ewpform.iban.$viewValue.match(/^DE/):!1},n.get("vendors",{channel:"handyfinder"}).then(o)["finally"](function(){t.isLoading=!1}),t.loadDevices=function(){t.isPromise=!0,t.devices={},n.get("devices",{channel:"handyfinder",vendors:t.form.vendor.id,noVariants:1}).then(s)["finally"](function(){t.isPromise=!1})},t.validateIban=function(){t.form.iban&&(t.form.iban.match(/^DE/)?i.validateIban(t.form.iban).then(function(e){t.bankdata.bankName=e.data.bankName,t.form.bic=e.data.bic,delete t.ibanError},function(e){t.ibanError=r.parseResponseError(e)}):t.form.iban&&t.form.bic&&i.validateIbanAndBic(t.form.iban,t.form.bic).then(function(e){t.form.iban=e.data.iban,t.checkIban(e.data.iban)},function(t){e.debug("validateIbanAndBic Error",t)}))},t.checkTowns=function(e){a.checkTowns(e).then(function(e){t.townList=e})},t.checkStreets=function(e){a.checkStreets(e).then(function(e){t.streetList=e})}}]),app.controller("partnerofferLayerCtrl",["$scope","formdata",function(e,t){e.netz=t.netz}]),app.controller("partnerofferCtrl",["$log","$rootScope","$scope","$timeout","$location","partnerofferService","AuthService2","ErrorService",function(e,t,n,a,r,i,o,s){n.errorMessage=!1,n.isLoading=!1,n.submitSuccess=!1,n.customer=o.getPartyId(),n.contractId=o.getContract().split(".")[1],t.loginTarget&&t.loginTarget.match("partner-angebot-d")||"undefined"==typeof t.loginSuccess?(t.loginSuccess=!1,n.origin=1,i.getUser(n.customer,n.contractId,n.origin)):n.origin=2;var c=function(){var e=window.dataLayer||{};e.push({event:"virtual_page_view",virtualPageURL:"/online-service/#"+r.url()+"/step2",virtualPageTitle:n.$root.siteTitle+" - /step2"})};n.acceptOffer=function(){i.acceptOffer(n).then(function(e){e.data.netz_id_aktuell?(n.errorMessage=!1,n.submitSuccess=!0,c()):n.errorMessage=s.getMessage(4)},function(t){n.errorMessage=s.getMessage(503),e.debug("showModal -> error",t)})}}]),app.factory("partnerofferService",["$q","$log","$timeout","AuthService2","ErrorService","RequestService","ModalService",function(e,t,n,a,r,i,o){function s(e,n,s){var c="/ajax/churn_user.php",l=e.split("."),d={kundennummer:l[1],vertragsnummer:n,getUser:!0},u={};return t.debug(d),i.post(c,d).then(function(e){if(!e.data.netz_id_aktuell)return window.location.href=a.isLoggedIn()?"/online-service/#/dashboard":"/online-service/#/login",!1;u.netz="D"+e.data.netz_id_aktuell;var n="/partials/modal-partneroffer.html";"2"!==s&&(n="/partials/modal-partnerofferD1.html"),o.showModal({templateUrl:n,controller:"partnerofferLayerCtrl",inputs:{formdata:u}}).then(function(e){jqCustom.Modal.show(e.element)},function(e){t.debug("showModal -> error",e)})},function(e){$scope.errorMessage=r.getMessage(503),t.debug("showModal -> error",e)})}function c(e){var t="/ajax/churn_user.php",n=e.customer.split("."),a={kundennummer:n[1],vertragsnummer:e.contractId,origin:e.origin,setUser:!0};return i.post(t,a)}return t=t.getInstance("partnerofferService"),{getUser:s,acceptOffer:c}}]),app.controller("PasswordForgottenCtrl",["$scope","$location","$log","$route","WizardHandler","ErrorService","passwordForgottenService",function(e,t,n,a,r,i,o){e.isLoading=!1,e.smsConfirm=!1,e.emailConfirm=!1,e.temporaryPwd=!1,e.pwdforgotten={},e.pwset={},e.createdInfos={},e.additionalData={},e.setBreadcrumb([{url:"#/passwort-vergessen",title:"Passwort"}]),e.location=t,e.wayfinder=function(){newBusinessAccount===!0?e.businessLogin():r.wizard().next()},e.getPasswordUser=function(t,a,s){if(t||a||s)t?r.wizard().next():a&&!s?(e.temporaryPwd=!0,r.wizard().next()):s&&(e.isLoading=!0,e.setPasswordSms());else{var c=/^0([\d]*)$/,l=e.pwdforgotten.userName;c.test(l)&&(l=l.replace(c,"49$1")),e.isLoading=!0,o.requestTemporaryPassword(l).then(function(t){n.debug("response",t.data),delete e.errorMessage,"sms"===t.data.confirmationType?(delete e.errorMessage,e.smsConfirm=!0,$.fancybox({href:"#smssent",title:"Temporäres Passwort wurde versendet!",type:"inline"})):(delete e.errorMessage,e.emailConfirm=!0,r.wizard().next()),e.createdInfos=t.data},function(t){t.data.code?5008===t.data.code?e.errorMessage="Es wurde kein Zugang für die Rufnummer / den Loginnamen gefunden. Falls Sie Ihr Benutzer-Konto bereits auf ein Login mit E-Mail-Adresse umgestellt haben, geben Sie bitte unbedingt diese an.":e.errorMessage=i.getMessage(t.data.code):e.errorMessage=i.getMessage(503)})["finally"](function(){e.isLoading=!1})}},e.setPasswordSms=function(){e.isLoading=!0,o.setPasswordSms(e).then(function(t){e.isLoading=!1,t&&201!==t.status&&200!==t.status?t.data.code?(e.errorMessage=i.getMessage(t.data.code),r.wizard().previous()):(e.errorMessage=i.getMessage(503),r.wizard().previous()):(delete e.errorMessage,r.wizard().next())})},e.setPasswordEmail=function(){var t=a.current.params.pwtoken,r=e.pwset.password;e.isLoading=!0,o.setPasswordEmail(t,r).then(function(t){return delete e.errorMessage,t},function(t){n.debug("setPasswordEmail error",t),t.data.code?e.errorMessage=i.getMessage(t.data.code):e.errorMessage=i.getMessage(503)})["finally"](function(){e.isLoading=!1})}}]),app.factory("passwordForgottenService",["$http","RequestService","ENVIRONMENT",function(e,t,n){function a(a){e.defaults.withCredentials=!1,e.defaults.headers.common["x-api-key"]=n.xApiKey;var r=e.defaults.headers.common.Authorization;delete e.defaults.headers.common.Authorization;var i=t.post("resetPassword",{userName:a});return e.defaults.withCredentials=!0,delete e.defaults.headers.common["x-api-key"],e.defaults.headers.common.Authorization=r,i}function r(e){var n={taskId:e.createdInfos.taskId,temporaryPassword:e.additionalData.temporaryPassword,password:e.additionalData.password};return t.post("passwordSetSms",n)}function i(e,n){return t.post("passwordSetEmail",{token:e,password:n})}return{requestTemporaryPassword:a,setPasswordSms:r,setPasswordEmail:i}}]),app.controller("PrepaidCtrl",["$scope","$location","$log","AuthService2","prepaidService","ErrorService",function(e,t,n,a,r,i){a.getCurrentContractDetails().then(function(e){e.hasPermission("prepaid")||t.path("/meine-vertraege/vertragsdetails")}),e.isLoading=!0,e.success=!1,e.notAvailable=!1,e.setBreadcrumb([{url:"#/meine-vertraege",title:"Meine Verträge"},{url:"#/meine-vertrage/vertragsdetails",title:"Vertragsdetails"},{url:"#/prepaidcash",title:"Prepaid-Guthaben"}]),r.getChargingAmount().then(function(t){n.debug("getInstantCash",t),e.isLoading=!1,e.possibleamounts=t.data.possibleAmounts,0===e.possibleamounts.length?e.notAvailable=!0:e.amount=e.possibleamounts[0]/100},function(t){n.error("checkInstantCash",t),e.isLoading=!1,e.errorMessage=i.getMessage(t.data.code)}),e.saveInstantCash=function(){e.isLoading=!0,r.charge(100*e.amount).then(function(t){n.debug("savePrepaidCash",t),e.isLoading=!1,e.success=!0},function(t){n.debug("error",t),e.isLoading=!1,e.errorMessage=i.getMessage(t.data.code)})},e.backToStart=function(){t.path("/meine-vertraege")}}]),app.factory("prepaidService",["AuthService2","RequestService",function(e,t){function n(){var n={url:"getPrepaidCharge",params:{contract:e.getContract(),chargingType:"immediately"}};return t.get(n)}function a(e){var n={chargingType:"immediately",chargingAmountInCent:e};return t.post("setPrepaidCharge",n)}return{getChargingAmount:n,charge:a}}]),app.controller("ByCreditBalanceCtrl",["$scope","$location","AuthService2","ByCreditBalanceService","$log","ErrorService",function(e,t,n,a,r,i){e.isLoading=!0,e.notAvailable=!1,e.success=!1,e.isNumber=angular.isNumber,e.setBreadcrumb([{url:"#/meine-vertraege",title:"Meine Verträge"},{url:"#/vertragsdetails",title:"Vertragsdetails"},{url:"#/prepaidcash",title:"Prepaid-Guthaben"}]),e.form={chargingAmount:""},a.getPrepaidCharge().then(function(t){r.debug("getPrepaidCharge",t),e.currentamount=t.data.currentAmount,e.possibleamounts=t.data.possibleAmounts,0===e.possibleamounts.length&&(e.notAvailable=!0),e.isLoading=!1},function(t){r.error("checkPrepaidGuthaben",t),e.notAvailable=!0,e.isLoading=!1,e.errorMessage=i.getMessage(error.data.code)}),e.saveInstantCreditBalance=function(){e.isLoading=!0;var t="byCreditBalance",n=e.form.chargingAmount;a.instantCreditBalance(n,t).then(function(t){r.debug("savePrepaidByCridit",t),e.isLoading=!1,e.success=!0})},e.backToStart=function(){t.path("/meine-vertraege")}}]),app.factory("ByCreditBalanceService",["AuthService2","RequestService",function(e,t){"use strict";function n(){var n={url:"getPrepaidCharge",params:{contract:e.getContract(),chargingType:"byCreditBalance"}};return t.get(n)}function a(e,n){var a={chargingType:n,chargingAmountInCent:e};return t.post("setPrepaidCharge",a)}return{instantCreditBalance:a,getPrepaidCharge:n}}]),app.controller("MonthlyCtrl",["$scope","$location","$log","AuthService2","monthlyService","ErrorService",function(e,t,n,a,r,i){e.isLoading=!0,e.notAvailable=!1,e.isNumber=angular.isNumber,e.changingBlockedUntilDate=null,e.noError=!0,e.success=!1,e.setBreadcrumb([{url:"#/meine-vertraege",title:"Meine Verträge"},{url:"#/vertragsdetails",title:"Vertragsdetails"},{url:"#/prepaidcash",title:"Prepaid-Guthaben"}]),e.form={chargingAmount:""},r.getPrepaidCharge().then(function(t){e.currentamount=t.data.currentAmount,e.possibleamounts=t.data.possibleAmounts,e.changingBlockedUntilDate=t.data.changingBlockedUntilDate,0===e.possibleamounts.length&&(e.arrayLength=e.possibleamounts.length),0!==e.changingBlockedUntilDate.length&&(e.notAvailable=!0,e.noError=!1),e.isLoading=!1},function(t){e.notAvailable=!0,e.noError=!1,e.isLoading=!1,e.errorMessage=i.getMessage(t.data.code)}),e.saveInstantCreditMonthly=function(){e.isLoading=!0;var t="monthly",a=e.form.chargingAmount;r.instantCreditMonthly(a,t).then(function(t){n.debug("savePrepaidMonthly",t),e.isLoading=!1,e.success=!0},function(t){n.debug("error",t),e.isLoading=!1,e.errorMessage=i.getMessage(response.data.code)})},e.backToStart=function(){t.path("/meine-vertraege")}}]),app.factory("monthlyService",["$log","AuthService2","RequestService",function(e,t,n){function a(){var e={url:"getPrepaidCharge",params:{contract:t.getContract(),chargingType:"monthly"}};return n.get(e)}function r(t,a){var r={chargingType:a,chargingAmountInCent:t};return e.debug("sendParams",r),n.post("setPrepaidCharge",r)}return{getPrepaidCharge:a,instantCreditMonthly:r}}]),app.controller("PsGameCtrl",["$q","$log","$http","$rootScope","$scope","$timeout","UrlService","AuthService2","marketingService",function(e,t,n,a,r,i,o,s,c){var l,d,u,g=this,p="/ajax/iphone_se_game.php";$('link[rel=stylesheet][href*="main.min.css"]').length?d=$('link[rel=stylesheet][href*="main.min.css"]')[0].href.split("main.min.css"):$('link[rel=stylesheet][href*="main.css"]').length&&(d=$('link[rel=stylesheet][href*="main.css"]')[0].href.split("main.css")),u=d[0]+"pages/ps-game.css",a.loadedCSS||(a.loadedCSS={}),a.loadedCSS.dlsOptions||(window.loadCSS(u,window.document.getElementsByTagName("script")[0],"all",function(){r.isLoading=!1}),a.loadedCSS.dlsOptions=u),g.step=1,g.loginData={},g.gameData={},g.isLoading=!1,g.hasMarketingPermit=!1,g.errorMessage=!1;var f=function(){return c.setMarketingInfo()},m=function(){return g.isPromise=!0,n.post(p,g.gameData,{flush:!1}).then(function(){$.cookie("ps-game-iphone-se",!0,{expires:31,path:"/"}),g.step=3},function(e){g.errorMessage=e})["finally"](function(){g.isPromise=!1})};g.login=function(){g.isPromise=!0,s.login(g.loginData,"none").then(function(){g.proceedToFinalStep()},function(e){e.error?g.errorMessage=e.error:g.errorMessage=e})["finally"](function(){g.isPromise=!1})},g.proceedToFinalStep=function(){g.isLoading=!0,g.errorMessage=!1,s.getCustomerData().then(function(e){l=e,l.marketingPermit&&l.marketingPermit.value&&"VOICE"===l.marketingPermit.value&&(g.hasMarketingPermit=!0),g.gameData={customer:s.getPartyId(),firstname:e.name.firstName||"",lastname:e.name.lastName||"",salutation:e.name.salutation&&"Firma"!==e.name.salutation?e.name.salutation:"",mail:e.email||"",advertising:g.hasMarketingPermit?"granted":""}},function(e){t.debug(e)})["finally"](function(){g.isLoading=!1,g.step=2})},g.submit=function(){g.gameData.permit?(g.gameData.advertising="now-granted",f()["finally"](m)):m()},function(){i(function(){$.cookie("ps-game-iphone-se")?(g.isLoading=!1,g.step=4):s.isLoggedIn()?(g.isLoading=!1,g.proceedToFinalStep()):(g.isLoading=!1,g.step=1)})}()}]),app.controller("RegistrationCtrl",["$scope","$log","WizardHandler","OidcService","ErrorService","registrationService","ENVIRONMENT",function(e,t,n,a,r,i,o){e.env=o.env,e.isLoading=!1,e.showHint=!1,e.registerSuccess=!1,e.registerdata={},e.setBreadcrumb([{url:"#erstanmeldung",title:"Erstanmeldung"}]),e.goToLoginPageUrl=function(){window.location.href=a.createPckeRequest(!0,!1,!1)},window.onloadTurnstileCallback=function(){turnstile.render(".cf-turnstile",{sitekey:"0x4AAAAAAAFgo0NTC4yG0Hu9",callback:function(t){""!=t?e.$apply(function(){e.success=!0}):e.$apply(function(){e.success=!1})}})},e.registerNow=function(){t.debug("rigisternow");var a=e.registerdata.email,o=e.registerdata.password;e.isLoading=!0,i.registerNow(a,o).then(function(t){e.isLoading=!1,("true"===t.data.sent||t.data.sent===!0)&&(delete e.errorMessage,e.registerSuccess=!0)},function(t){e.isLoading=!1,e.registerSuccess=!1,e.errorMessage=r.getMessage(t.data.code),n.wizard().goTo(0)})}}]),app.factory("registrationService",["RequestService","$http",function(e,t){var n=window.location.href.indexOf("www."),a=window.location.href.indexOf("www-git.");return{registerNow:function(r,i){var o=localStorage.getItem("idProvider"),s="oidc"===o?"5KTK6oNTjrQa4yeWg6eTpxtyyasjbMq3":"hH9yns04GhgsNPWtVBjUrdssp3JrR1Zd",c="oidc"===o?"8b121bbc-6f75-4f38-a2ac-2dcb64a25a30":"tv9o9ZkTAJsXqMPR5sfzah3Bfbjq5JrP",l={};-1!==a&&(l={headers:{"X-API-KEY":s,"CF-Access-Client-Id":"593e2798c0d2e2541a55704e3d451d3f.access","CF-Access-Client-Secret":"bcdbdb8fd7b0c778b89d3dd793881d4d1c1c3514d4188935212a540776c999bb"},withCredentials:!1}),-1!==n&&(l={headers:{"X-API-KEY":c}});var d={userName:r,password:i};return delete t.defaults.headers.common.Authorization,e.post("register",d,l)}}}]),angular.module("md").directive("contactAssistantCtrl1",function(){return{restrict:"EA",templateUrl:"/partials/faq/contact.html",controller:"sabioCtrl",controllerAs:"vm",replace:!0,scope:{}}}),angular.module("md").directive("appMdSabioFaq",function(){return{restrict:"EA",templateUrl:"/partials/faq/tree.html",controller:"sabioCtrl",controllerAs:"vm",replace:!0,scope:{}}}),angular.module("md").directive("appMdSabioTopFaq",function(){return{restrict:"EA",templateUrl:"/partials/faq/servicefaq.html",controller:"sabioServicesCtrl",controllerAs:"vm",replace:!0,scope:{treeId:"@treeId",nrItems:"@nrItems"}}}),angular.module("md").controller("sabioCtrl",["$log","$scope","$route","$sce","$location","$timeout","sabioService",function(e,t,n,a,r,i,o){function s(e){angular.forEach(e,function(t,n){e[n].content&&(e[n].content=a.trustAsHtml(e[n].content)),delete e[n].score}),h.searchResult=e}function c(t){e.debug(t)}function l(e){angular.forEach(e,function(t,n){e[n].content&&(e[n].content=a.trustAsHtml(e[n].content)),delete e[n].score}),h.suggestResult=e}function d(t){e.debug(t)}function u(e){if(h.tree=e,Array.isArray(e)&&e.length){var t=e[0];Array.isArray(t.children)&&t.children.length&&(h.isSimpleTree=!!t.children[0].leaf)}i(function(){$(".newwoffcanvas").mdOffCanvas(),i(m)})}function g(t){e.debug(t)}function p(t,n){e.debug("_handleAnswerSuccess",n),n.content?(n.content[0]=a.trustAsHtml(n.content[0]),t.answer=n):t.answer=-1}function f(t,n){e.debug("_handleRateSuccess",n),t.rate=n}function m(e){var t=r.search();if(e){var n=!1,a=!1;if(angular.forEach(h.questions,function(e,r){e.id===t.id&&(n=e,a=r)}),n||(n=h.questions[0],a=0),n){var o=$(".offcanvas-content.is-active .accordion-section:eq("+a+") .accordion-head");o.click(),i(function(){$("html, body").animate({scrollTop:o.offset().top-$("header").height()-10},500)})}}else{var s=!1,c=!1,l=!1,d=!1;if(t.path&&angular.forEach(h.tree,function(e,n){e.id===t.path&&(s=e,c=n),angular.forEach(e.children,function(a,r){a.id===t.path&&(s=e,c=n,l=a,d=r)})}),s){var u=$("ul.offcanvas-controls > li:eq("+c+")");if($("> a",u).click(),l&&0!==d){var g=$("ul > li:eq("+d+")",u);$("> a",g).click()}}}}e=e.getInstance("sabioCtrl");var h=this;h.isLoadingTree=!0,h.isSimpleTree=!1,h.isLoadingSearchResult=!0,h.searchError=!1,h.isContractUser=r.absUrl().indexOf("/vertragskunden/")>-1?!0:!1,h.loadSearchResult=function(e){e?(h.searchError=!1,o.getSearchResult(e).then(s,c)["finally"](function(){h.isLoadingSearchResult=!1,h.suggestResult={}})):h.searchError=!0},h.getSuggests=function(e){e?(h.searchError=!1,o.getSuggests(e).then(l,d)["finally"](function(){h.isLoadingSeaggestResult=!1})):h.suggestError=!0},h.setSearchSuggest=function(e){h.search=e,h.loadSearchResult(e)},o.getTree().then(u,g)["finally"](function(){h.isLoadingTree=!1}),h.loadQuestions=function(t){e.debug("loadQuestions"),h.questions=t.children,i(function(){m(!0)})},h.loadAnswer=function(e){angular.isDefined(e.answer)||(e.isLoadingAnswer=!0,o.getAnswerForQuestion(e.id).then(function(t){p(e,t)},console.error)["finally"](function(){e.isLoadingAnswer=!1}))},h.setRating=function(e,t){e.rate||o.setRating(e.id,t).then(function(t){f(e,t)},console.error)}}]),angular.module("md").factory("sabioService",["$q","$log","$http",function(e,t,n){var a="/ajax/faq-search/result.php",r="/ajax/faq-search/suggest.php",i="/ajax/sabio/faq.php",o=e.defer(),s=e.defer(),c=e.defer(),l=function(e){return param=a+"?q="+e,n.get(param).then(function(e){return s.resolve(e.data),e.data})},d=function(e){return param=r+"?q="+e,n.get(param).then(function(e){return c.resolve(e.data),e.data})},u=function(e){return null!=e?param=i+"?action=tree&index="+e+"&r="+Date.now():param=i+"?action=tree&r="+Date.now(),n.get(param).then(function(e){return o.resolve(e.data.children),e.data.children})},g=function(e){return t.debug("getQuestion",e),n.get(i+"?action=faq&treeId="+e).then(function(e){return t.debug("getQuestions->answer",e),e.data.data.result})},p=function(e){return t.debug("getSearch"),n.get(i+"?action=search&treeId="+e).then(function(e){return e.data.data.result})},f=function(e){return t.debug("getAnswerForQuestion"),
n.get(i+"?action=answerforquestion&questionId="+e).then(function(e){return e.data.data},t.error)},m=function(e){return t.debug("getAnswer",e),n.get(i+"?action=answer&contentId="+e).then(function(e){return t.debug("getAnswer->response",e),e.data.data},t.error)},h=function(e,t){return n.get(i+"?action=rate&answerId="+e+"&rate="+t).then(function(e){return e.data})},v=function(){return o.promise},b=function(e){t.debug("_parseContactCategories",e);var n=null,a=[],r=null,i=null;return Array.isArray(e)?(n=e,a=[]):t.debug("parseContactCategories:: data is no Array"),$.cookie("contactCategory")&&angular.forEach(e,function(e){e.id===$.cookie("contactCategory")&&(r=e,a=e.children)}),$.cookie("contactTopic")&&angular.forEach(a,function(e){e.id===$.cookie("contactTopic")&&(i=e)}),{categories:n,topics:a,currentCategory:r,currentTopic:i}};return{getSearchResult:l,getTree:u,getAnswer:m,getAnswerForQuestion:f,getSearch:p,getSuggests:d,getTreePromise:v,setRating:h,getQuestions:g,parseContactCategories:b}}]),angular.module("md").controller("sabioServicesCtrl",["$log","$scope","$sce","$timeout","sabioService",function(e,t,n,a,r){function i(t){e.debug("_handleSearchSuccess",t),l.tree=t[0].children[0].children,l.themaHeadline=t[0].children[0].title,l.loadQuestions(l.tree),l.currentQuestion=l.questions[0],l.loadAnswer(l.questions[0])}function o(t){e.debug("_handleSearchError",t)}function s(t,a){e.debug("_handleAnswerSuccess",a),a.content?(a.content[0]=n.trustAsHtml(a.content[0]),t.answer=a):t.answer=-1}function c(t,n){e.debug("_handleRateSuccess",n),t.rate=n}e=e.getInstance("sabioServicesCtrl");var l=this;l.isLoadingTree=!0,r.getTree().then(i,o)["finally"](function(){l.isLoadingTree=!1}),l.loadAnswer=function(t){e.debug("loadAnswer",t),l.currentQuestion=t,t.answer||(l.isLoadingAnswer=!0,r.getAnswerForQuestion(t.id).then(function(e){s(t,e)},console.error)["finally"](function(){l.isLoadingAnswer=!1}))},l.loadQuestions=function(t){e.debug("loadQuestions",t),l.questions=t},l.setRating=function(e,t){e.rate||r.setRating(e.id,t).then(function(t){c(e,t)},console.error)}}]),app.controller("ShopsCtrl",["$element","$location","$rootScope","$scope","MyShopService",function(e,t,n,a,r){var i=this,o=!1;i.showLayer=!1,i.forceLayer=!1,i.myShop=!!$.cookie("myRepairShop"),i.isUrlShops=window.location.href.indexOf("haendlerseiten")>0,n.myShopIsSet=i.myShop;var s=function(){i.isLoading=!0,r.get().then(function(e){i.shopData=e},function(){})["finally"](function(){i.isLoading=!1,o=!0})};i.toggle=function(e){i.myShop=!!$.cookie("myRepairShop"),i.showLayer=e||i.forceLayer||!i.showLayer,i.showLayer&&(!o&&i.myShop&&s(),a.$root.$broadcast("navLayer","shops"))},this.setForceLayer=function(){i.forceLayer=!0},a.$on("navLayer",function(e,t){"shops"!==t&&(i.showLayer=!0,i.forceLayer=!1,i.toggle(!1))});var c=$("#shopsBlock");c.bind("touchstart",function(e){"A"===e.target.nodeName?e.stopPropagation():("SPAN"===e.target.nodeName&&"shopsBlock"===$(e.target).parent().attr("id")||"I"===e.target.nodeName&&"shopsBlock"===$(e.target).parent().parent().attr("id"))&&a.$apply(function(){i.toggle(!1)})}).hover(function(){$(window).width()>700&&a.$apply(function(){i.toggle(!0)})},function(){$(window).width()>700&&a.$apply(function(){i.toggle(!1)})}).on("keyup",function(e){const t=e.key;("Enter"===t||" "===t)&&a.$apply(function(){i.toggle(!1)})}).find(".md-header__top-bar-nav-icon-text").on("focus",function(){a.$apply(function(){n.$broadcast("navLayer","shops")})}).on("focusout",function(){setTimeout(function(){0===$(document.activeElement).closest("#shopsBlock").length&&a.$apply(function(){i.showLayer=!0,i.toggle(!1)})},100)}),c.on("click",".reset-cookie",function(){r.reset()})}]),app.factory("MyShopService",["$q","$log","$http","LocalStorage",function(e,t,n,a){t=t.getInstance("MyShopService");var r="/ajax/myshop.php",i="myshopid",o="myshop",s=function(){var s=a.get(o),l=a.get(i),d=$.cookie("myRepairShop"),u=e.defer();if(d===l&&s)u.resolve(s);else{if(d)return a.set(i,d),c();n.get(r).then(function(e){t.debug("handleShopSuccess",e),200===e.status?u.resolve(e.data):u.reject()},function(e){u.reject(e)})}return u.promise},c=function(){var t=e.defer();return n.get(r).then(function(e){200===e.status?(a.set(o,e.data),t.resolve(e.data)):t.reject()},function(e){t.reject(e)}),t.promise},l=function(){$.removeCookie("myRepairShop"),$.removeCookie("myRepairShop",{path:"/"}),a.rm(i),a.rm(o)};return{get:s,reset:l}}]),app.factory("SimService",["$q","$log","AuthService2","LocalStorage","RequestService",function(e,t,n,a,r){function i(){return f}function o(e){f=e}function s(){return r.get("getSimsOrders",{status:"pending"})}function c(e,t){return r.get(["getSimsTask",e,t],{status:"pending-sims"})}function l(e,t){return m=null,r.put(["getSimsTask",e,t],null,{params:{status:"active"}})}function d(){return r.get("getSimProfiles")}function u(){return r.put("simLock")}function g(){return r.del("simLock")}function p(e){return r.post("getSimsOrders",e)}t=t.getInstance("SimService");var f,m=null,h=null,v=function(e){return r.get(["getESimDetails",n.getContract(),e.simNumber]).then(function(e){var t=e.data;return t&&t.pinpuks&&Array.isArray(t.pinpuks)&&t.pinpuks.length?t.pinpuks[0]:""})},b=function(){m=null},w=function(){var t=e.defer();return h=n.getContract(),m=r.get("getESimStatus"),m.then(function(e){k(e.data.tasks).then(t.resolve,t.reject)})["catch"](function(){t.reject}),t.promise},y=function(){var t=e.defer();return w().then(function(e){t.resolve(e.filter(function(e){return"ESIM"===e.type}))},t.reject),t.promise},k=function(n){var a=e.defer();if(n){var r=[];angular.forEach(n,function(e){angular.forEach(e.sims,function(n){t.debug("sim",n),r.push({simNumber:n.newIccid,current:n.currentIccid,status:e.status,taskId:e.taskId,type:n.simType})})}),a.resolve(r)}else a.reject("NO_ESIM_TASKS");return a.promise},C=function(n){var a=e.defer();return w().then(function(e){t.debug("hasESimStatus",e),Array.isArray(e)&&e.length&&(e.filter(function(e){return"ESIM"===e.type&&e.status===n}).length?a.resolve(!0):t.debug("NO_ESIM_WITH_STATUS:"+n))})["catch"](function(e){a.reject("NO ESIM TASKS")}),a.promise},S=function(e,t){return t=t||600,r.get(["getESimQR",n.getContract(),e.simNumber,t],null,{responseType:"arraybuffer"}).then(function(e){return"data:image/png;base64,"+$(e.data)})},$=function(e){for(var t,n,a,r,i,o="",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=new Uint8Array(e),l=c.byteLength,d=l%3,u=l-d,g=0;u>g;g+=3)i=c[g]<<16|c[g+1]<<8|c[g+2],t=(16515072&i)>>18,n=(258048&i)>>12,a=(4032&i)>>6,r=63&i,o+=s[t]+s[n]+s[a]+s[r];return 1===d?(i=c[u],t=(252&i)>>2,n=(3&i)<<4,o+=s[t]+s[n]+"=="):2===d&&(i=c[u]<<8|c[u+1],t=(64512&i)>>10,n=(1008&i)>>4,a=(15&i)<<2,o+=s[t]+s[n]+s[a]+"="),o},A=function(e,t){return r.put(["requestESimTan",n.getContract(),t],{communicationMedium:e}).then(function(e){return e.data})},M=function(e,t){return m=null,r.put(["postESimTan",n.getContract(),t],{tan:e})},I=function(e){return r.get(["getESimTanTimeout",n.getContract(),e]).then(function(e){return e.data})},L=function(e){return r.post(["sendESimTanTimeout",n.getContract,e])},T=function(){var e=a.get("selectedEsim");return r.get(["getESimTanStatus",n.getContract(),e.taskId,e.current])},D=function(){var e=a.get("selectedEsim");return r.get(["getESimRoles",n.getContract(),e.taskId]).then(function(e){return e.data.infoLabel})};return{requestTaskPending:s,requestSimsPending:c,requestSimProfiles:d,postOrderSim:p,simLock:u,simUnlock:g,activateReplacementSim:l,isUseAlternateAddress:i,setUseAlternateAddress:o,getSimStatus:w,getESimStatus:y,hasESimStatus:C,getESimDetails:v,getESimTanStatus:T,clearESimStatus:b,getSimQRCode:S,requestTan:A,confirmTan:M,getSmsTanTimeout:I,postSmsTanTimeout:L,getESimRoles:D}}]),app.controller("TerminationCtrl",["$log","$scope","$location","addressService","RequestService","ErrorService","WizardHandler",function(e,t,n,a,r,i,o){function s(){t.providers=_.filter(l,function(e){return""===e.net||e.net===c})}var c,l;t.providers=[],t.errorMessage=i.getMessage(n.search().code),t.formData={},t.isLoading=!0,r.get("/ajax/providerAddress.json").then(function(e){l=e.data},function(t){e.error(t)})["finally"](function(){t.isLoading=!1}),t.checkTowns=function(e){t.isLoadingTowns=!0,a.checkTowns(e).then(function(e){t.townList=e,t.isLoadingTowns=!1})},t.checkStreets=function(e){t.isLoadingStreets=!0,a.checkStreets(e).then(function(e){t.streetList=e,t.isLoadingStreets=!1})},t.changeNet=function(e){c=e,s()},t.saveForm=function(n){n.$name||e.error("Form has no name",n);var a={};angular.forEach(n,function(e,t){-1===t.indexOf("$")&&(a[t]=e)}),t.formData[n.$name]=a,o.wizard().next()},t.sendForm=function(){var e=$("form[name=terminationFormAuthorization]");e.attr("method","POST"),window.location.href.indexOf("/kuendigung/andere-anbieter")>-1?e.attr("action","/ajax/contracttermination.php"):e.attr("action","/ajax/prepaidtermination.php"),e.submit()},t.onProviderChange=function(e,t){e.terminationFormProvider.address||(e.terminationFormProvider.address={}),"none"!==t.name&&(e.terminationFormProvider.address.postalCode=t.code,e.terminationFormProvider.address.city=t.city,e.terminationFormProvider.address.street=t.street,e.terminationFormProvider.address.streetNr=t.nr,e.terminationFormProvider.address.prefix=t.mailbox)},t.backToStart=function(){n.path("/service/vertrag-und-konditionen/rufnummernmitnahme/prepaid/")}}]),app.factory("TwylaService",["$log",function(e){e=e.getInstance("TwylaService");var t="twyla-widget-script",n={"data-hook-url":"https://api.canvas.twyla.ai/widget-hook/capita/e1BYnr","data-api-key":"ircGlYyOPWZ0sgBs4J0q0PgCB8E","data-primary-color":"#84BC34","data-language":"de","data-avatar":"https://assets.canvas.twyla.ai/Capita/MD%20Avatar%201.png","data-trigger-image":"https://assets.canvas.twyla.ai/Capita/MD%20Avatar%201.png","data-title":"virtueller Assistent","data-subtitle":"Für Fragen rund um Rechnungen und Adressänderung","data-greeting-bubble-text":"Mobi hier. Dein virtueller Assistent!","data-greeting-button-label":"Chat starten"},a=function(){return document.getElementById(t)},r=function(){if(!a()){var e=document.getElementsByTagName("head")[0],r=document.createElement("script");r.id=t,r.type="text/javascript",r.src="https://widget.chat.twyla.ai/twyla-widget.js",_.each(n,function(e,t){r.setAttribute(t,e)}),r.onload=function(){try{window.dispatchEvent(new Event("load"))}catch(e){}},e.appendChild(r)}},i=function(){a()&&document.getElementById(t).remove()},o=function(e){r(),e&&"function"==typeof e.$on&&e.$on("$destroy",s)},s=function(){i()};return{start:o,stop:s}}]),app.controller("verificationAGBCtrl",["$scope","$location","$log","ErrorService","verificationAGBService",function(e,t,n,a,r){e.isLoading=!0,e.agbVerification=!1,e.agbVerificationSuccess=!1,e.askForWbk=!1,e.isNorton=!1,e.defaultError=!1,e.tokenExpired=!1,e.customerId="",e.verificationData={},e.verificationCode=t.search().verificationCode,$.cookie&&$.cookie("iab_purposes")&&(r.verifyNow(e).then(function(t){if(n.debug(t),t)if(e.isLoading=!1,t.code)switch(t.code){case 50001:e.tokenExpired=!0;break;default:e.defaultError=!0}else t.error?e.errorMessage=a.getMessage(503):(n.debug(t),t.followUpType&&(e.agbVerification=!0,e.customerId=t.customerId,e.productName=t.productName,e.productId=t.productId,e.contractTerm=t.productLaufzeit,e.monthlyFee=parseInt(t.productMonthlyFee)/100,e.verificationCodeAGB=t.followUpValue,e.productName.match(/(Norton)/i)&&(e.isNorton=!0)));else e.isLoading=!1,e.errorMessage=a.getMessage(503)}),e.verifyNowAGB=function(){window.scrollTo(0,0),e.isLoading=!0,"VOICE"===e.verificationData.hasMarketingPermit&&(e.askForWbk=!0),r.verifyNowAGB(e).then(function(t){if(n.debug(t),t)if(e.isLoading=!1,delete e.errorMessage,e.tokenExpired=!1,e.defaultError=!1,t.code)switch(t.code){case 50001:e.tokenExpired=!0;break;default:e.defaultError=!0}else t.error?e.errorMessage=a.getMessage(503):e.agbVerificationSuccess=!0;else e.isLoading=!1,e.errorMessage=a.getMessage(503)})})}]),app.factory("verificationAGBService",["$http","UrlService",function(e,t){function n(n,a){var r="agb"===a?"agbVerification":"emailVerification";return e.post(t.getUrl(r),n,{headers:{"Content-Type":"application/json"}})}return{verifyNow:function(e){var t={verificationCode:e.verificationCode};return n(t,"email").then(function(e){return e.data},function(e){return e.data})},verifyNowAGB:function(e){var t={verificationCode:e.verificationCodeAGB,customerId:e.customerId,voice:e.verificationData.hasMarketingPermit?"TRUE":"FALSE",nonvoice:"FALSE"};return n(t,"agb").then(function(e){return e.data},function(e){return e.data})}}}]),app.controller("VerificationEmailCtrl",["$scope","$location","$log","$window","WizardHandler","AuthService2","ErrorService","verificationEmailService",function(e,t,n,a,r,i,o,s){e.isLoading=!0,e.contractFlow=!0,e.agbVerification=!1,e.agbVerificationSuccess=!1,e.askForWbk=!1,e.isNorton=!1,e.defaultError=!1,e.tokenExpired=!1,e.customerId="",e.verificationData={},e.agbVerification=!1,e.msisdnVerification=!1,e.emailVerificationSuccess=!1,e.userLoggedIn=i.isLoggedIn(),e.location=t,e.verifydata={},e.setBreadcrumb([{url:"#/aktivierung-email/:verificationCode",title:"E-Mail Aktivierung"}]),$.cookie&&$.cookie("iab_purposes")&&(s.verifyNow(e).then(function(r){if(n.debug(r),e.isLoading=!1,r)if(r.code)$(".progressbar, .data-container, .obligation, .progressbar-container").css("display","none"),e.errorMessage=o.getMessage(r.code);else if(n.debug(r),r.followUpType)switch(e.followUpType=r.followUpType,r.followUpType){case"mobileNumber":e.msisdnVerification=!0,e.followUpTypeText=" und Rufnummer",e.msisdn=r.followUpValue;break;case"AGB":e.agbVerification=!0,e.followUpTypeText=" und AGB",e.agb=r.followUpValue,e.customerId=r.customerId,e.productName=r.productName,e.productId=r.productId,e.contractTerm=r.productLaufzeit,e.monthlyFee=parseInt(r.productMonthlyFee)/100,e.verificationCodeAGB=r.followUpValue,e.productName.match(/(Norton)/i)&&(e.isNorton=!0)}else e.userLoggedIn?t.path("/meine-daten").search({emc:"emc"}).replace():(e.isLoading=!1,$(".progressbar, .data-container, .obligation, .progressbar-container").css("display","none"),e.emailVerificationSuccess=!0,e.newEmail=r.verifiedValue,a.setTimeout(function(){a.location.href="/lp/willkommen"},7e3));else $(".progressbar, .data-container, .obligation, .progressbar-container").css("display","none"),e.errorMessage=o.getMessage(503)}),e["switch"]=function(t){switch(t){case"AGB":e.verifyNowAGB();break;case"mobileNumber":e.verifyNowMsisdn()}},e.verifyNowMsisdn=function(){s.verifyNowMsisdn(e).then(function(t){n.debug(t),e.isLoading=!1,t?(delete e.errorMessage,t.code?(r.wizard().previous(),e.errorMessage=o.getMessage(t.code)):r.wizard().next()):e.errorMessage=o.getMessage(503)})},e.verifyNowAGB=function(){e.isLoading=!0,"VOICE"===e.verificationData.hasMarketingPermit&&(e.askForWbk=!0),s.verifyNowAGB(e).then(function(t){if(n.debug(t),t){if(e.isLoading=!1,delete e.errorMessage,e.tokenExpired=!1,e.defaultError=!1,t.code)switch(t.code){case 50001:e.tokenExpired=!0;break;default:e.defaultError=!0}else t.error?e.errorMessage=o.getMessage(503):e.agbVerificationSuccess=!0;r.wizard().next()}else e.isLoading=!1,e.errorMessage=o.getMessage(503)})})}]),app.factory("verificationEmailService",["$http","UrlService",function(e,t){function n(n,a){var r="agb"===a?"agbVerification":"emailVerification";return e.post(t.getUrl(r),n,{headers:{"Content-Type":"application/json"}})}function a(n,a){return e.post(t.getUrl("msisdnVerification",a),n,{headers:{"Content-Type":"application/json"}})}return{verifyNow:function(e){var t=e.location.path().split("/")[2],a={verificationCode:t};return n(a,"email").then(function(e){return e.data},function(e){return e.data})},verifyNowMsisdn:function(e){var t={verificationCode:e.verifydata.verificationCode};return a(t,e.msisdn).then(function(e){return e.data},function(e){return e.data})},verifyNowAGB:function(e){var t={verificationCode:e.verificationCodeAGB,customerId:e.customerId,voice:e.verificationData.hasMarketingPermit?"TRUE":"FALSE",nonvoice:"FALSE"};return n(t,"agb").then(function(e){return e.data},function(e){return e.data})}}}]),app.controller("VerificationMsisdnCtrl",["$scope","$location","$log","ErrorService","verificationMsisdnService","WizardHandler",function(e,t,n,a,r,i){e.isLoading=!1,e.contractFlow=!0,e.location=t,e.verifydata={},e.setBreadcrumb([{url:"#/aktivierung-msisdn/:verificationCode",title:"Rufnummer Aktivierung"}]),e.resetErrorCode=function(){e.errorMessage="",i.wizard().next()},e.verifyNowMsisdn=function(){r.verifyNowMsisdn(e).then(function(t){n.debug(t),e.isLoading=!1,t?t.code?e.errorMessage=a.getMessage(t.code):(e.success=!0,i.wizard().next()):e.errorMessage=a.getMessage(t.code)})}}]),app.factory("verificationMsisdnService",["$http","UrlService",function(e,t){function n(n,a){return e.post(t.getUrl("msisdnVerification",a),n,{headers:{"Content-Type":"application/json"}})}return{verifyNowMsisdn:function(e){var t={verificationCode:e.verifydata.verificationCode},a=!1;return n(t,e.verifydata.msisdn).then(function(e){return e.verificationResult?a=!0:e.data})}}}]),app.controller("VerificationNewUserCtrl",["$scope","$log","$route","ErrorService","WizardHandler","AuthService2","verificationNewUserService",function(e,t,n,a,r,i,o){var s=n.current.params.identifyer,c=n.current.params.msisdn,l=n.current.params.verificationCode;e.isLoading=!0,e.contractFlow=!0,e.requiresPerson=!1,e.requiresIban=!1,e.requiresZipCode=!1,e.additionalData={},e.businessUser=i.isBusiness(),e.setBreadcrumb([{url:n.current.params.msisdn?"#/vertragsinhaber-aktivierung/:uuid/:verificationCode":"#/vertragsinhaber-aktivierung/:uuid/:msisdn/:verificationCode",title:"Aktivierung"}]),$.cookie&&$.cookie("iab_purposes")&&(o.getOptions(e,s,c).then(function(n){t.debug("data",i.getUser()),e.isLoading=!1,n.code?e.errorMessage=a.getMessage(n.code):(n.requiresPerson===!0&&(e.isLoading=!1,e.requiresPerson=!0),n.requiresIban===!0&&(e.isLoading=!1,e.requiresIban=!0),n.requiresZipCode===!0&&(e.isLoading=!1,e.requiresZipCode=!0),e.requiresPerson||e.requiresIban||e.requiresZipCode||(e.isLoading=!0,e.verifyNow()))},function(){e.isLoading=!1,e.errorMessage=a.getMessage(503)}),e.logout=function(e){i.logout(e)},e.verifyNow=function(){return s&&l?void o.verifyNow(s,l,e.additionalData).then(function(n){if(t.debug("response",n),delete e.errorMessage,$(".progressbar, .data-container, .obligation, .progressbar-container").css("display","none"),r.wizard().goTo(2),n.data.length>0){var a=i.getUser();t.debug("verifyNow",a),a.isNewUser=!1,a.partyIds=n.data,e.contractsAdded=!1,e.isLoading=!1}},function(t){e.isLoading=!1,10027===t.data.code?(r.wizard().goTo(0),e.requiresPerson=!0):e.errorMessage=a.getMessage(t.data.code)}):void t.debug("verifyNow => cancelling. no identifier AND/OR no verificationCode")})}]),app.factory("verificationNewUserService",["$log","$http","UrlService","RequestService",function(e,t,n,a){function r(t,n){return t||e.debug("requestVerification => no params given"),a.post(["newUserConfirm",t],n,{flush:!1})}function i(t,n,r){var i={};return r&&(i.invoiceMsisdn=r),a.get(["addContract",n],i).then(function(e){return e.data},function(t){return e.error("adding Contract failed:",t.data),t.data})}function o(e,t,n){return n.identificationCode=t,r(e,n)}return e=e.getInstance("verificationNewUserService"),{getOptions:i,verifyNow:o}}]),app.controller("VerificationUsernameCtrl",["$rootScope","$scope","$location","$log","$window","AuthService2","ErrorService","verificationUsernameService",function(e,t,n,a,r,i,o,s){t.isLoading=!0,t.location=n,t.setBreadcrumb([{url:"#/meine-daten/aktivierung-benutzername/:id/:verificationCode",title:"Aktivierung Benutzername"}]),$.cookie&&$.cookie("iab_purposes")&&s.verifyNow(t).then(function(r){r?r.data.error?(t.isLoading=!1,t.errorMessage=o.getMessage(r.error.data.code)):r.data.code?(t.isLoading=!1,t.errorMessage=o.getMessage(r.data.code)):(t.isLoading=!1,dataLayer.push({event:"virtual_page_view",virtualPageURL:"online-service/meine-daten/aktivierung-benutzername/"+window.location.search,virtualPageTitle:t.$root.siteTitle}),i.isLoggedIn()?(a.debug("logout"),e.loginMsgData="newUsername",i.logout("newUsername")):(a.debug("logout::redirect to login"),e.loginMsgData="newUsername",n.path("/login/newUsername"))):204===r.status?(t.isLoading=!1,initializeBackgroundLogout(),i.isLoggedIn()?(a.debug("logout"),e.loginMsgData="newUsername",i.logout("newUsername")):(a.debug("logout::redirect to login"),e.loginMsgData="newUsername",n.path("/login/newUsername"))):r.status?(t.isLoading=!1,t.errorMessage=o.getMessage(503)):(t.isLoading=!1,t.errorMessage=o.getMessage(503))})}]),app.factory("verificationUsernameService",["$http","UrlService",function(e,t){function n(n){return e.put(t.getUrl("setUsername"),n,{headers:{"Content-Type":"application/json"}})}return{verifyNow:function(e){var t=e.location.path().split("/")[3],a=e.location.path().split("/")[4],r={id:t,verificationToken:a};return n(r).then(function(e){return e.success?e:e},function(e){return e})}}}]),app.controller("VerificationCtrl",["$scope","$location","$window","$log","$route","AuthService2","OidcService","ErrorService","verificationService","WizardHandler",function(e,t,n,a,r,i,o,s,c,l){a=a.getInstance("VerificationCtrl");var d=r.current.params.uuid,u=r.current.params.verificationCode;e.isLoading=!0,e.isWizardRequired=!1,e.location=t,e.verificationData={smsCode:null},e.setBreadcrumb([{url:"#/aktivierung/:uuid/:verificationCode",title:"Aktivierung"}]);var g=function(t){a.debug("verifySuccess",t),t?(a.debug("Sending wizard to step 1"),e.isWizardRequired=!0,l.wizard().goTo(1)):window.location.href=o.createPckeRequest(!0,!1,!1),dataLayer.push({event:"VirtualPageView",virtualPageURL:"/aktivierung/",virtualPageTitle:e.$root.siteTitle})},p=function(t){a.error("verifyNow",t),t&&t.data&&t.data.code?(e.isLoading=!1,e.errorMessage=t.data.code+": "+s.getMessage(t.data.code)):0===t.status?(e.isLoading=!1,e.errorMessage=s.getMessage(0)):(e.isLoading=!1,e.errorMessage=s.getMessage(503))};$.cookie&&$.cookie("iab_purposes")&&c.verifyNow(d,u).then(g,p)["finally"](function(){e.isLoading=!1}),e.sendSMSCode=function(){e.isLoading=!0,e.errorMessage=!1,c.verifySMS(e.verificationData.smsCode).then(function(){l.wizard().goTo(2)},function(t){a.debug("sms code error",t),e.errorMessage=t})["finally"](function(){e.isLoading=!1})}}]),app.factory("verificationService",["$q","$log","$http","api","$timeout","RequestService","AuthService2","ENVIRONMENT",function(e,t,n,a,r,i,o,s){t=t.getInstance("verificationService");var c,l,d,u,g=function(e){var t=localStorage.getItem("idProvider"),a="oidc"===t?s.xApiKeyOidc:s.xApiKeyAuth0,r={headers:{"X-API-KEY":a,"CF-Access-Client-Id":"593e2798c0d2e2541a55704e3d451d3f.access","CF-Access-Client-Secret":"bcdbdb8fd7b0c778b89d3dd793881d4d1c1c3514d4188935212a540776c999bb"},withCredentials:!1,timeout:15e3};return delete n.defaults.headers.common.Authorization,i.post("verify",e,r).then(function(e){return f(e)})},p=function(e,t){return c={id:e,verificationToken:t},g(c)},f=function(e){return t.debug("_handleVerificationResponse",e),204===e.status?!1:200===e.status?(u=e.data.msisdn,d=e.data.otp,!0):!1},m=function(n,r){t.debug("_handleOidcResponseSuccess",n);var o=e.defer();return l=n.data,a.init(l.access_token),i.post({url:"newConfirmation",params:{API:s.apiUrl,identifier:u}},{identificationCode:r},{withCredentials:!0}).then(function(){o.resolve()},o.reject),o.promise},h=function(t){var a=e.defer();return delete n.defaults.headers.common.Authorization,i.post("otpLogin",{user_id:c.id,otp:d},{headers:{"X-API-KEY":"5KTK6oNTjrQa4yeWg6eTpxtyyasjbMq3","CF-Access-Client-Id":"593e2798c0d2e2541a55704e3d451d3f.access","CF-Access-Client-Secret":"bcdbdb8fd7b0c778b89d3dd793881d4d1c1c3514d4188935212a540776c999bb"},withCredentials:!1}).then(function(e){m(e,t).then(a.resolve,a.reject,a.notify)},a.reject),a.promise};return{verifyNow:p,verifySMS:h}}]),app.controller("voiceLpModalController",["$q","$log","$scope","close","AuthService2","RequestService","contractsService","marketingService",function(e,t,n,a,r,i,o,s){function c(){p.isLoggedIn()?(n.step=2,u()):n.step=1}function l(){var n=e.defer();return r.getCustomerData().then(function(e){t.debug("getCustomerData response",e),g=e,o.getDetails().then(function(e){g.msisdn=e.msisdn,n.resolve()})},n.reject),n.promise}function d(){var e={salutation:g.name.salutation,firstname:g.name.firstName,lastname:g.name.lastName,msisdn:g.msisdn,email:g.email};i.post("/ajax/voice-landingpage.php",e)}function u(){n.isPromise=!0,l().then(function(){g.marketingPermit&&"VOICE"===g.marketingPermit.value?n.step=4:n.step=2},function(e){n.errorMessage=e})["finally"](function(){n.isPromise=!1})}var g,p=r.getUser();n.step=1,n.buttonText="Login",n.formObject={},$("body").on("click",".modal-content #btnLoginModal",function(){n.login()}),t=t.getInstance("voiceLpModalController"),n.login=function(){t.debug("login"),n.isPromise=!0,r.login(n.formObject,"none").then(u,function(e){n.isPromise=!1,e.error?n.errorMessage=e.error:n.errorMessage=e})},n.sendPermit=function(){n.errorMessage=!1,n.isPromise=!0,s.setMarketingInfo("VOICE",{promotionCode:"BKMAktionB5"}).then(function(){d(),n.step=3},function(e){t.debug("setMarketingInfo",e),e&&e.data&&e.data.message?n.errorMessage=e.data.message:n.errorMessage=e})["finally"](function(){n.isPromise=!1})},n.closeModal=function(){a()},c()}]),app.controller("voiceLpController",["$log","$scope","ModalService",function(e,t,n){var a=this;a.onButtonClick=function(){n.showModal({templateUrl:"/partials/modal-voice-landingpage.html",controller:"voiceLpModalController",controllerAs:"vm"}).then(function(e){jqCustom.Modal.show(e.element)},function(t){e.debug("showModal -> error",t)})}}]),angular.bootstrap(document,["md"]),jQuery("body").trigger("app:initialized");
//# sourceMappingURL=md.min.js.map